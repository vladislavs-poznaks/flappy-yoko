{"version":3,"sources":["../src/kaboom.ts","../src/utils.ts","../src/math.ts","../src/fps.ts","../src/timer.ts","main.js"],"names":["PIPE_GAP","height","highScore","loadSprite","scene","score","add","sprite","width","scoreText","text","player","pos","area","scale","body","loop","offset","rand","passed","flipY","origin","action","pipe","move","x","collides","go","y","onKeyPress","jump"],"mappings":"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KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,IACpD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,IACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,IACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,IACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,IACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,IAAM,KAAK,EAAE,GACnD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,GAAK,KAAK,EAAE,GAClD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,GAAK,KAAK,EAAE,GAClD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,GAAK,KAAK,EAAE,GAClD,EAAM,KAAK,EAAE,GAAK,KAAK,EAAE,IAAM,KAAK,EAAE,GAAK,KAAK,EAAE,GAClD,EAAM,KAAK,EAAE,GA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","file":"main.660dc905.js","sourceRoot":"../src","sourcesContent":["import {\n\tvec2,\n\tvec3,\n\tVec3,\n\tRect,\n\tLine,\n\tCircle,\n\tColor,\n\tVec2,\n\tMat4,\n\tQuad,\n\tRNG,\n\tquad,\n\trgb,\n\thsl2rgb,\n\trng,\n\trand,\n\trandi,\n\trandSeed,\n\tchance,\n\tchoose,\n\tclamp,\n\tlerp,\n\tmap,\n\tmapc,\n\twave,\n\ttestAreaRect,\n\ttestAreaLine,\n\ttestAreaCircle,\n\ttestAreaPolygon,\n\ttestAreaPoint,\n\ttestAreaArea,\n\ttestLineLineT,\n\ttestRectRect2,\n\ttestLineLine,\n\ttestRectRect,\n\ttestRectLine,\n\ttestRectPoint,\n\ttestPolygonPoint,\n\ttestLinePolygon,\n\ttestPolygonPolygon,\n\ttestCircleCircle,\n\ttestCirclePoint,\n\ttestRectPolygon,\n\tminkDiff,\n\tdeg2rad,\n\trad2deg,\n} from \"./math\";\n\nimport {\n\tIDList,\n\tdownloadURL,\n\tdownloadBlob,\n\tuid,\n\tdeprecate,\n\tdeprecateMsg,\n\tisDataURL,\n\tdeepEq,\n} from \"./utils\";\n\nimport {\n\tGfxShader,\n\tGfxFont,\n\tTexFilter,\n\tRenderProps,\n\tCharTransform,\n\tCharTransformFunc,\n\tTexWrap,\n\tFormattedText,\n\tFormattedChar,\n\tDrawRectOpt,\n\tDrawLineOpt,\n\tDrawLinesOpt,\n\tDrawTriangleOpt,\n\tDrawPolygonOpt,\n\tDrawCircleOpt,\n\tDrawEllipseOpt,\n\tDrawUVQuadOpt,\n\tVertex,\n\tSpriteData,\n\tSoundData,\n\tFontData,\n\tShaderData,\n\tSpriteLoadSrc,\n\tSpriteLoadOpt,\n\tSpriteAtlasData,\n\tFontLoadOpt,\n\tGfxTexData,\n\tKaboomCtx,\n\tKaboomOpt,\n\tAudioPlay,\n\tAudioPlayOpt,\n\tDrawSpriteOpt,\n\tDrawTextOpt,\n\tGameObj,\n\tEventCanceller,\n\tSceneID,\n\tSceneDef,\n\tCompList,\n\tComp,\n\tTag,\n\tKey,\n\tMouseButton,\n\tTouchID,\n\tCollision,\n\tPosComp,\n\tScaleComp,\n\tRotateComp,\n\tColorComp,\n\tOpacityComp,\n\tOrigin,\n\tOriginComp,\n\tLayerComp,\n\tZComp,\n\tFollowComp,\n\tMoveComp,\n\tOutviewCompOpt,\n\tOutviewComp,\n\tCleanupCompOpt,\n\tCleanupComp,\n\tAreaCompOpt,\n\tAreaComp,\n\tArea,\n\tSpriteComp,\n\tSpriteCompOpt,\n\tGfxTexture,\n\tSpriteAnimPlayOpt,\n\tTextComp,\n\tTextCompOpt,\n\tRectComp,\n\tRectCompOpt,\n\tUVQuadComp,\n\tCircleComp,\n\tOutlineComp,\n\tTimerComp,\n\tBodyComp,\n\tBodyCompOpt,\n\tUniform,\n\tShaderComp,\n\tSolidComp,\n\tFixedComp,\n\tStayComp,\n\tHealthComp,\n\tLifespanComp,\n\tLifespanCompOpt,\n\tStateComp,\n\tDebug,\n\tKaboomPlugin,\n\tMergeObj,\n\tLevel,\n\tLevelOpt,\n\tCursor,\n\tRecording,\n\tKaboom,\n} from \"./types\";\n\nimport FPSCounter from \"./fps\";\nimport Timer from \"./timer\";\n\n// @ts-ignore\nimport apl386Src from \"./assets/apl386.png\";\n// @ts-ignore\nimport apl386oSrc from \"./assets/apl386o.png\";\n// @ts-ignore\nimport sinkSrc from \"./assets/sink.png\";\n// @ts-ignore\nimport sinkoSrc from \"./assets/sinko.png\";\n// @ts-ignore\nimport beanSrc from \"./assets/bean.png\";\n// @ts-ignore\nimport burpBytes from \"./assets/burp.mp3\";\n// @ts-ignore\nimport kaSrc from \"./assets/ka.png\";\n// @ts-ignore\nimport boomSrc from \"./assets/boom.png\";\n\ntype ButtonState =\n\t\"up\"\n\t| \"pressed\"\n\t| \"rpressed\"\n\t| \"down\"\n\t| \"released\"\n\t;\n\ntype DrawTextureOpt = RenderProps & {\n\ttex: GfxTexture,\n\twidth?: number,\n\theight?: number,\n\ttiled?: boolean,\n\tflipX?: boolean,\n\tflipY?: boolean,\n\tquad?: Quad,\n\torigin?: Origin | Vec2,\n}\n\ninterface GfxTexOpt {\n\tfilter?: TexFilter,\n\twrap?: TexWrap,\n}\n\n// translate these key names to a simpler version\nconst KEY_ALIAS = {\n\t\"ArrowLeft\": \"left\",\n\t\"ArrowRight\": \"right\",\n\t\"ArrowUp\": \"up\",\n\t\"ArrowDown\": \"down\",\n\t\" \": \"space\",\n};\n\n// according to https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/button\nconst MOUSE_BUTTONS = [\n\t\"left\",\n\t\"middle\",\n\t\"right\",\n\t\"back\",\n\t\"forward\",\n];\n\n// don't trigger browser default event when these keys are pressed\nconst PREVENT_DEFAULT_KEYS = [\n\t\"space\",\n\t\"left\",\n\t\"right\",\n\t\"up\",\n\t\"down\",\n\t\"tab\",\n\t\"f1\",\n\t\"f2\",\n\t\"f3\",\n\t\"f4\",\n\t\"f5\",\n\t\"f6\",\n\t\"f7\",\n\t\"f8\",\n\t\"f9\",\n\t\"f10\",\n\t\"f11\",\n\t\"s\",\n];\n\n// some default charsets for loading bitmap fonts\nconst ASCII_CHARS = \" !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\";\nconst CP437_CHARS = \" ☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\\\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■\";\n\n// audio gain range\nconst MIN_GAIN = 0;\nconst MAX_GAIN = 3;\n\n// audio speed range\nconst MIN_SPEED = 0;\nconst MAX_SPEED = 3;\n\n// audio detune range\nconst MIN_DETUNE = -1200;\nconst MAX_DETUNE = 1200;\n\nconst DEF_ORIGIN = \"topleft\";\nconst DEF_GRAVITY = 1600;\nconst QUEUE_COUNT = 65536;\nconst BG_GRID_SIZE = 64;\n\nconst DEF_FONT = \"apl386o\";\nconst DBG_FONT = \"sink\";\n\n// vertex format stride (vec3 pos, vec2 uv, vec4 color)\nconst STRIDE = 9;\n\n// vertex shader template, replace {{user}} with user vertex shader code\nconst VERT_TEMPLATE = `\nattribute vec3 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n`;\n\n// fragment shader template, replace {{user}} with user fragment shader code\nconst FRAG_TEMPLATE = `\nprecision mediump float;\n\nvarying vec3 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n`;\n\n// default {{user}} vertex shader code\nconst DEF_VERT = `\nvec4 vert(vec3 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n`;\n\n// default {{user}} fragment shader code\nconst DEF_FRAG = `\nvec4 frag(vec3 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n`;\n\nconst COMP_DESC = new Set([\n\t\"id\",\n\t\"require\",\n]);\n\nconst COMP_EVENTS = new Set([\n\t\"add\",\n\t\"load\",\n\t\"update\",\n\t\"draw\",\n\t\"destroy\",\n\t\"inspect\",\n]);\n\n// transform the button state to the next state\n// e.g. a button might become \"pressed\" one frame, and it should become \"down\" next frame\nfunction processButtonState(s: ButtonState): ButtonState {\n\tif (s === \"pressed\" || s === \"rpressed\") {\n\t\treturn \"down\";\n\t}\n\tif (s === \"released\") {\n\t\treturn \"up\";\n\t}\n\treturn s;\n}\n\n// wrappers around full screen functions to work across browsers\nfunction enterFullscreen(el: HTMLElement) {\n\tif (el.requestFullscreen) el.requestFullscreen();\n\t// @ts-ignore\n\telse if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();\n};\n\nfunction exitFullscreen() {\n\tif (document.exitFullscreen) document.exitFullscreen();\n\t// @ts-ignore\n\telse if (document.webkitExitFullScreen) document.webkitExitFullScreen();\n};\n\nfunction getFullscreenElement(): Element | void {\n\treturn document.fullscreenElement\n\t\t// @ts-ignore\n\t\t|| document.webkitFullscreenElement\n\t\t;\n};\n\n// convert origin string to a vec2 offset\nfunction originPt(orig: Origin | Vec2): Vec2 {\n\tswitch (orig) {\n\t\tcase \"topleft\": return vec2(-1, -1);\n\t\tcase \"top\": return vec2(0, -1);\n\t\tcase \"topright\": return vec2(1, -1);\n\t\tcase \"left\": return vec2(-1, 0);\n\t\tcase \"center\": return vec2(0, 0);\n\t\tcase \"right\": return vec2(1, 0);\n\t\tcase \"botleft\": return vec2(-1, 1);\n\t\tcase \"bot\": return vec2(0, 1);\n\t\tcase \"botright\": return vec2(1, 1);\n\t\tdefault: return orig;\n\t}\n}\n\nfunction createEmptyAudioBuffer() {\n\treturn new AudioBuffer({\n\t\tlength: 1,\n\t\tnumberOfChannels: 1,\n\t\tsampleRate: 44100\n\t});\n}\n\n// only exports one kaboom() which contains all the state\nexport default (gopt: KaboomOpt = {}): KaboomCtx => {\n\nconst app = (() => {\n\n\tconst root = gopt.root ?? document.body;\n\n\t// if root is not defined (which falls back to <body>) we assume user is using kaboom on a clean page, and modify <body> to better fit a full screen canvas\n\tif (root === document.body) {\n\t\tdocument.body.style[\"width\"] = \"100%\";\n\t\tdocument.body.style[\"height\"] = \"100%\";\n\t\tdocument.body.style[\"margin\"] = \"0px\";\n\t\tdocument.documentElement.style[\"width\"] = \"100%\";\n\t\tdocument.documentElement.style[\"height\"] = \"100%\";\n\t}\n\n\t// create a <canvas> if user didn't provide one\n\tconst canvas = gopt.canvas ?? (() => {\n\t\tconst canvas = document.createElement(\"canvas\");\n\t\troot.appendChild(canvas);\n\t\treturn canvas;\n\t})();\n\n\t// global pixel scale\n\tconst gscale = gopt.scale ?? 1;\n\n\t// adjust canvas size according to user size / viewport settings\n\tif (gopt.width && gopt.height && !gopt.stretch && !gopt.letterbox) {\n\t\tcanvas.width = gopt.width * gscale;\n\t\tcanvas.height = gopt.height * gscale;\n\t} else {\n\t\tcanvas.width = canvas.parentElement.offsetWidth;\n\t\tcanvas.height = canvas.parentElement.offsetHeight;\n\t}\n\n\t// canvas css styles\n\tconst styles = [\n\t\t\"outline: none\",\n\t\t\"cursor: default\",\n\t];\n\n\tif (gopt.crisp) {\n\t\tstyles.push(\"image-rendering: pixelated\");\n\t\tstyles.push(\"image-rendering: crisp-edges\");\n\t}\n\n\t// TODO: .style is supposed to be readonly? alternative?\n\t// @ts-ignore\n\tcanvas.style = styles.join(\";\");\n\n\t// make canvas focusable\n\tcanvas.setAttribute(\"tabindex\", \"0\");\n\n\t// create webgl context\n\tconst gl = canvas\n\t\t.getContext(\"webgl\", {\n\t\t\tantialias: true,\n\t\t\tdepth: true,\n\t\t\tstencil: true,\n\t\t\talpha: true,\n\t\t\tpreserveDrawingBuffer: true,\n\t\t});\n\n\treturn {\n\n\t\tcanvas: canvas,\n\t\tscale: gscale,\n\t\tgl: gl,\n\n\t\t// keep track of all button states\n\t\tkeyStates: {} as Record<Key, ButtonState>,\n\t\tmouseStates: {} as Record<MouseButton, ButtonState>,\n\n\t\t// input states from last frame, should reset every frame\n\t\tcharInputted: [],\n\t\tisMouseMoved: false,\n\t\tisKeyPressed: false,\n\t\tisKeyPressedRepeat: false,\n\t\tisKeyReleased: false,\n\t\tmousePos: vec2(0, 0),\n\t\tmouseDeltaPos: vec2(0, 0),\n\n\t\t// total time elapsed\n\t\ttime: 0,\n\t\t// real total time elapsed (including paused time)\n\t\trealTime: 0,\n\t\t// if we should skip next dt, to prevent the massive dt surge if user switch to another tab for a while and comeback\n\t\tskipTime: false,\n\t\t// how much time last frame took\n\t\tdt: 0.0,\n\t\t// total frames elapsed\n\t\tnumFrames: 0,\n\n\t\t// if we're on a touch device\n\t\tisTouch: (\"ontouchstart\" in window) || navigator.maxTouchPoints > 0,\n\n\t\t// requestAnimationFrame id\n\t\tloopID: null,\n\t\t// if our game loop is currently stopped / paused\n\t\tstopped: false,\n\t\tpaused: false,\n\n\t\t// TODO: take fps counter out pure\n\t\tfpsCounter: new FPSCounter(),\n\n\t\t// if we finished loading all assets\n\t\tloaded: false,\n\n\t};\n\n})();\n\nconst gfx = (() => {\n\n\tconst gl = app.gl;\n\tconst defShader = makeShader(DEF_VERT, DEF_FRAG);\n\n\t// a 1x1 white texture to draw raw shapes like rectangles and polygons\n\t// we use a texture for those so we can use only 1 pipeline for drawing sprites + shapes\n\tconst emptyTex = makeTex(\n\t\tnew ImageData(new Uint8ClampedArray([ 255, 255, 255, 255, ]), 1, 1)\n\t);\n\n\tconst c = gopt.background ?? rgb(0, 0, 0);\n\n\tif (gopt.background) {\n\t\tconst c = Color.fromArray(gopt.background);\n\t\tgl.clearColor(c.r / 255, c.g / 255, c.b / 255, 1);\n\t}\n\n\tgl.enable(gl.BLEND);\n\tgl.enable(gl.SCISSOR_TEST);\n\tgl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n\n\t// we only use one vertex and index buffer that batches all draw calls\n\tconst vbuf = gl.createBuffer();\n\n\tgl.bindBuffer(gl.ARRAY_BUFFER, vbuf);\n\t// vec3 pos\n\tgl.vertexAttribPointer(0, 3, gl.FLOAT, false, STRIDE * 4, 0);\n\tgl.enableVertexAttribArray(0);\n\t// vec2 uv\n\tgl.vertexAttribPointer(1, 2, gl.FLOAT, false, STRIDE * 4, 12);\n\tgl.enableVertexAttribArray(1);\n\t// vec4 color\n\tgl.vertexAttribPointer(2, 4, gl.FLOAT, false, STRIDE * 4, 20);\n\tgl.enableVertexAttribArray(2);\n\tgl.bufferData(gl.ARRAY_BUFFER, QUEUE_COUNT * 4, gl.DYNAMIC_DRAW);\n\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\n\tconst ibuf = gl.createBuffer();\n\n\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, ibuf);\n\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, QUEUE_COUNT * 2, gl.DYNAMIC_DRAW);\n\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n\t// a checkerboard texture used for the default background\n\tconst bgTex = makeTex(\n\t\tnew ImageData(new Uint8ClampedArray([\n\t\t\t128, 128, 128, 255,\n\t\t\t190, 190, 190, 255,\n\t\t\t190, 190, 190, 255,\n\t\t\t128, 128, 128, 255,\n\t\t]), 2, 2), {\n\t\t\twrap: \"repeat\",\n\t\t\tfilter: \"nearest\",\n\t\t},\n\t);\n\n\treturn {\n\n\t\t// keep track of how many draw calls we're doing this frame\n\t\tdrawCalls: 0,\n\t\t// how many draw calls we're doing last frame, this is the number we give to users\n\t\tlastDrawCalls: 0,\n\n\t\t// gfx states\n\t\tdefShader: defShader,\n\t\tcurShader: defShader,\n\t\tdefTex: emptyTex,\n\t\tcurTex: emptyTex,\n\t\tcurUniform: {},\n\t\tvbuf: vbuf,\n\t\tibuf: ibuf,\n\n\t\t// local vertex / index buffer queue\n\t\tvqueue: [],\n\t\tiqueue: [],\n\n\t\ttransform: new Mat4(),\n\t\ttransformStack: [],\n\n\t\tbgTex: bgTex,\n\n\t\twidth: gopt.width,\n\t\theight: gopt.height,\n\n\t\tviewport: {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: gl.drawingBufferWidth,\n\t\t\theight: gl.drawingBufferHeight,\n\t\t},\n\n\t};\n\n})();\n\nupdateViewport();\n\nconst audio = (() => {\n\n\t// TODO: handle when audio context is unavailable\n\tconst ctx = new (window.AudioContext || (window as any).webkitAudioContext)() as AudioContext\n\tconst masterNode = ctx.createGain();\n\tmasterNode.connect(ctx.destination);\n\n\t// by default browsers can only load audio async, we don't deal with that and just start with an empty audio buffer\n\tconst burpSnd = {\n\t\tbuf: createEmptyAudioBuffer(),\n\t};\n\n\t// load that burp sound\n\tctx.decodeAudioData(burpBytes.buffer.slice(0), (buf) => {\n\t\tburpSnd.buf = buf;\n\t}, () => {\n\t\tthrow new Error(\"Failed to load burp.\")\n\t});\n\n\treturn {\n\t\tctx,\n\t\tmasterNode,\n\t\tburpSnd,\n\t};\n\n})();\n\nconst assets = {\n\n\t// keep track of how many assets are loading / loaded, for calculaating progress\n\tnumLoading: 0,\n\tnumLoaded: 0,\n\n\t// prefix for when loading from a url\n\turlPrefix: \"\",\n\n\t// asset holders\n\tsprites: {},\n\tsounds: {},\n\tshaders: {},\n\tfonts: {},\n\n};\n\nconst game = {\n\n\t// event callbacks\n\tevents: {},\n\tobjEvents: {},\n\n\t// root game object\n\t// these transforms are used as camera\n\troot: make([]),\n\n\ttimers: new IDList<Timer>(),\n\n\t// misc\n\tlayers: {},\n\tdefLayer: null,\n\tgravity: DEF_GRAVITY,\n\ton<F>(ev: string, cb: F): EventCanceller {\n\t\tif (!this.events[ev]) {\n\t\t\tthis.events[ev] = new IDList();\n\t\t}\n\t\treturn this.events[ev].pushd(cb);\n\t},\n\ttrigger(ev: string, ...args) {\n\t\tif (this.events[ev]) {\n\t\t\tthis.events[ev].forEach((cb) => cb(...args));\n\t\t}\n\t},\n\tscenes: {},\n\n\t// on screen log\n\tlogs: [],\n\n\t// camera\n\tcam: {\n\t\tpos: center(),\n\t\tscale: vec2(1),\n\t\tangle: 0,\n\t\tshake: 0,\n\t\ttransform: new Mat4(),\n\t},\n\n}\n\n// wrap individual loaders with global loader counter, for stuff like progress bar\nfunction load<T>(prom: Promise<T>): Promise<T> {\n\n\tassets.numLoading++;\n\n\t// wrapping another layer of promise because we are catching errors here internally and we also want users be able to catch errors, however only one catch is allowed per promise chain\n\treturn new Promise((resolve, reject) => {\n\t\tprom\n\t\t\t.then(resolve)\n\t\t\t.catch((err) => {\n\t\t\t\tdebug.error(err);\n\t\t\t\treject(err);\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tassets.numLoading--;\n\t\t\t\tassets.numLoaded++;\n\t\t\t});\n\t}) as Promise<T>;\n\n}\n\n// get current load progress\nfunction loadProgress(): number {\n\treturn assets.numLoaded / (assets.numLoading + assets.numLoaded);\n}\n\n// global load path prefix\nfunction loadRoot(path?: string): string {\n\tif (path !== undefined) {\n\t\tassets.urlPrefix = path;\n\t}\n\treturn assets.urlPrefix;\n}\n\n// wrapper around fetch() that applies urlPrefix and basic error handling\nfunction fetchURL(path: string) {\n\tconst url = assets.urlPrefix + path;\n\treturn fetch(url)\n\t\t.then((res) => {\n\t\t\tif (!res.ok) {\n\t\t\t\tthrow new Error(`Failed to fetch ${url}`);\n\t\t\t}\n\t\t\treturn res;\n\t\t});\n}\n\n// wrapper around image loader to get a Promise\nfunction loadImg(src: string): Promise<HTMLImageElement> {\n\tconst img = new Image();\n\timg.src = isDataURL(src) ? src : assets.urlPrefix + src;\n\timg.crossOrigin = \"anonymous\";\n\treturn new Promise<HTMLImageElement>((resolve, reject) => {\n\t\timg.onload = () => resolve(img);\n\t\t// TODO: truncate for long dataurl src\n\t\timg.onerror = () => reject(`Failed to load image from \"${src}\"`);\n\t});\n}\n\n// TODO: support SpriteLoadSrc\nfunction loadFont(\n\tname: string | null,\n\tsrc: string,\n\tgw: number,\n\tgh: number,\n\topt: FontLoadOpt = {},\n): Promise<FontData> {\n\treturn load(loadImg(src)\n\t\t.then((img) => {\n\t\t\tconst font = makeFont(\n\t\t\t\tmakeTex(img, opt),\n\t\t\t\tgw,\n\t\t\t\tgh,\n\t\t\t\topt.chars ?? ASCII_CHARS\n\t\t\t);\n\t\t\tif (name) {\n\t\t\t\tassets.fonts[name] = font;\n\t\t\t}\n\t\t\treturn font;\n\t\t})\n\t);\n}\n\nfunction getSprite(name: string): SpriteData | null {\n\treturn assets.sprites[name] ?? null;\n}\n\nfunction getSound(name: string): SoundData | null {\n\treturn assets.sounds[name] ?? null;\n}\n\nfunction getFont(name: string): FontData | null {\n\treturn assets.fonts[name] ?? null;\n}\n\nfunction getShader(name: string): ShaderData | null {\n\treturn assets.shaders[name] ?? null;\n}\n\n// get an array of frames based on configuration on how to slice the image\nfunction slice(x = 1, y = 1, dx = 0, dy = 0, w = 1, h = 1): Quad[] {\n\tconst frames = [];\n\tconst qw = w / x;\n\tconst qh = h / y;\n\tfor (let j = 0; j < y; j++) {\n\t\tfor (let i = 0; i < x; i++) {\n\t\t\tframes.push(new Quad(\n\t\t\t\tdx + i * qw,\n\t\t\t\tdy + j * qh,\n\t\t\t\tqw,\n\t\t\t\tqh,\n\t\t\t));\n\t\t}\n\t}\n\treturn frames;\n}\n\nfunction loadSpriteAtlas(\n\tsrc: SpriteLoadSrc,\n\tdata: SpriteAtlasData | string\n): Promise<Record<string, SpriteData>> {\n\tif (typeof data === \"string\") {\n\t\t// TODO: this adds a new loader asyncly\n\t\treturn load(fetchURL(data)\n\t\t\t.then((res) => res.json())\n\t\t\t.then((data2) => loadSpriteAtlas(src, data2)));\n\t}\n\treturn load(loadSprite(null, src).then((atlas) => {\n\t\tconst map = {};\n\t\tconst w = atlas.tex.width;\n\t\tconst h = atlas.tex.height;\n\t\tfor (const name in data) {\n\t\t\tconst info = data[name];\n\t\t\tconst spr = {\n\t\t\t\ttex: atlas.tex,\n\t\t\t\tframes: slice(info.sliceX, info.sliceY, info.x / w, info.y / h, info.width / w, info.height / h),\n\t\t\t\tanims: info.anims,\n\t\t\t}\n\t\t\tassets.sprites[name] = spr;\n\t\t\tmap[name] = spr;\n\t\t}\n\t\treturn map;\n\t}));\n}\n\n// synchronously load sprite from local pixel data\nfunction loadRawSprite(\n\tname: string | null,\n\tsrc: GfxTexData,\n\topt: SpriteLoadOpt = {}\n) {\n\n\tconst tex = makeTex(src, opt);\n\tconst frames = slice(opt.sliceX || 1, opt.sliceY || 1);\n\n\tconst sprite = {\n\t\ttex: tex,\n\t\tframes: frames,\n\t\tanims: opt.anims || {},\n\t};\n\n\tif (name) {\n\t\tassets.sprites[name] = sprite;\n\t}\n\n\treturn sprite;\n\n}\n\n// load a sprite to asset manager\nfunction loadSprite(\n\tname: string | null,\n\tsrc: SpriteLoadSrc,\n\topt: SpriteLoadOpt = {\n\t\tsliceX: 1,\n\t\tsliceY: 1,\n\t\tanims: {},\n\t},\n): Promise<SpriteData> {\n\n\treturn load(new Promise<SpriteData>((resolve, reject) => {\n\n\t\tif (!src) {\n\t\t\treturn reject(`Expected sprite src for \"${name}\"`);\n\t\t}\n\n\t\t// from url\n\t\tif (typeof(src) === \"string\") {\n\t\t\tloadImg(src)\n\t\t\t\t.then((img) => resolve(loadRawSprite(name, img, opt)))\n\t\t\t\t.catch(reject);\n\t\t} else {\n\t\t\tresolve(loadRawSprite(name, src, opt));\n\t\t}\n\n\t}));\n\n}\n\n// TODO: accept raw json\nfunction loadPedit(name: string, src: string): Promise<SpriteData> {\n\n\treturn load(new Promise<SpriteData>((resolve, reject) => {\n\n\t\tfetchURL(src)\n\t\t\t.then((res) => res.json())\n\t\t\t.then(async (data) => {\n\n\t\t\t\tconst images = await Promise.all(data.frames.map(loadImg));\n\t\t\t\tconst canvas = document.createElement(\"canvas\");\n\t\t\t\tcanvas.width = data.width;\n\t\t\t\tcanvas.height = data.height * data.frames.length;\n\n\t\t\t\tconst ctx = canvas.getContext(\"2d\");\n\n\t\t\t\timages.forEach((img: HTMLImageElement, i) => {\n\t\t\t\t\tctx.drawImage(img, 0, i * data.height);\n\t\t\t\t});\n\n\t\t\t\treturn loadSprite(name, canvas, {\n\t\t\t\t\tsliceY: data.frames.length,\n\t\t\t\t\tanims: data.anims,\n\t\t\t\t});\n\t\t\t})\n\t\t\t.then(resolve)\n\t\t\t.catch(reject)\n\t\t\t;\n\n\t}));\n\n}\n\n// TODO: accept raw json\nfunction loadAseprite(\n\tname: string | null,\n\timgSrc: SpriteLoadSrc,\n\tjsonSrc: string\n): Promise<SpriteData> {\n\n\treturn load(new Promise<SpriteData>((resolve, reject) => {\n\n\t\tloadSprite(name, imgSrc)\n\t\t\t.then((sprite: SpriteData) => {\n\t\t\t\tfetchURL(jsonSrc)\n\t\t\t\t\t.then((res) => res.json())\n\t\t\t\t\t.then((data) => {\n\t\t\t\t\t\tconst size = data.meta.size;\n\t\t\t\t\t\tsprite.frames = data.frames.map((f: any) => {\n\t\t\t\t\t\t\treturn new Quad(\n\t\t\t\t\t\t\t\tf.frame.x / size.w,\n\t\t\t\t\t\t\t\tf.frame.y / size.h,\n\t\t\t\t\t\t\t\tf.frame.w / size.w,\n\t\t\t\t\t\t\t\tf.frame.h / size.h,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t\tfor (const anim of data.meta.frameTags) {\n\t\t\t\t\t\t\tif (anim.from === anim.to) {\n\t\t\t\t\t\t\t\tsprite.anims[anim.name] = anim.from\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tsprite.anims[anim.name] = {\n\t\t\t\t\t\t\t\t\tfrom: anim.from,\n\t\t\t\t\t\t\t\t\tto: anim.to,\n\t\t\t\t\t\t\t\t\t// TODO: let users define these\n\t\t\t\t\t\t\t\t\tspeed: 10,\n\t\t\t\t\t\t\t\t\tloop: true,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tresolve(sprite);\n\t\t\t\t\t})\n\t\t\t\t\t.catch(reject)\n\t\t\t\t\t;\n\t\t\t})\n\t\t\t.catch(reject);\n\n\t}));\n\n}\n\nfunction loadShader(\n\tname: string | null,\n\tvert?: string,\n\tfrag?: string,\n\tisUrl: boolean = false,\n): Promise<ShaderData> {\n\n\tfunction loadRawShader(\n\t\tname: string | null,\n\t\tvert: string | null,\n\t\tfrag: string | null,\n\t): ShaderData {\n\t\tconst shader = makeShader(vert, frag);\n\t\tif (name) {\n\t\t\tassets.shaders[name] = shader;\n\t\t}\n\t\treturn shader;\n\t}\n\n\treturn load(new Promise<ShaderData>((resolve, reject) => {\n\n\t\tif (!vert && !frag) {\n\t\t\treturn reject(\"no shader\");\n\t\t}\n\n\t\tfunction resolveUrl(url?: string) {\n\t\t\treturn url ?\n\t\t\t\tfetchURL(url)\n\t\t\t\t\t.then((res) => res.text())\n\t\t\t\t\t.catch(reject)\n\t\t\t\t: new Promise((r) => r(null));\n\t\t}\n\n\t\tif (isUrl) {\n\t\t\tPromise.all([resolveUrl(vert), resolveUrl(frag)])\n\t\t\t\t.then(([vcode, fcode]: [string | null, string | null]) => {\n\t\t\t\t\tresolve(loadRawShader(name, vcode, fcode));\n\t\t\t\t})\n\t\t\t\t.catch(reject);\n\t\t} else {\n\t\t\ttry {\n\t\t\t\tresolve(loadRawShader(name, vert, frag));\n\t\t\t} catch (err) {\n\t\t\t\treject(err);\n\t\t\t}\n\t\t}\n\n\t}));\n\n}\n\n// TODO: accept dataurl\n// load a sound to asset manager\nfunction loadSound(\n\tname: string | null,\n\tsrc: string,\n): Promise<SoundData> {\n\n\treturn load(new Promise<SoundData>((resolve, reject) => {\n\n\t\tif (!src) {\n\t\t\treturn reject(`expected sound src for \"${name}\"`);\n\t\t}\n\n\t\t// from url\n\t\tif (typeof(src) === \"string\") {\n\t\t\tfetchURL(src)\n\t\t\t\t.then((res) => res.arrayBuffer())\n\t\t\t\t.then((data) => {\n\t\t\t\t\treturn new Promise((resolve2, reject2) =>\n\t\t\t\t\t\taudio.ctx.decodeAudioData(data, resolve2, reject2)\n\t\t\t\t\t);\n\t\t\t\t})\n\t\t\t\t.then((buf: AudioBuffer) => {\n\t\t\t\t\tconst snd = {\n\t\t\t\t\t\tbuf: buf,\n\t\t\t\t\t}\n\t\t\t\t\tif (name) {\n\t\t\t\t\t\tassets.sounds[name] = snd;\n\t\t\t\t\t}\n\t\t\t\t\tresolve(snd);\n\t\t\t\t})\n\t\t\t\t.catch(reject);\n\t\t}\n\n\t}));\n\n}\n\nfunction loadBean(name: string = \"bean\"): Promise<SpriteData> {\n\treturn loadSprite(name, beanSrc);\n}\n\n// get / set master volume\nfunction volume(v?: number): number {\n\tif (v !== undefined) {\n\t\taudio.masterNode.gain.value = clamp(v, MIN_GAIN, MAX_GAIN);\n\t}\n\treturn audio.masterNode.gain.value;\n}\n\n// plays a sound, returns a control handle\nfunction play(\n\tsrc: SoundData | string,\n\topt: AudioPlayOpt = {\n\t\tloop: false,\n\t\tvolume: 1,\n\t\tspeed: 1,\n\t\tdetune: 0,\n\t\tseek: 0,\n\t},\n): AudioPlay {\n\n\t// TODO: clean?\n\tif (typeof src === \"string\") {\n\n\t\tconst pb = play({\n\t\t\tbuf: createEmptyAudioBuffer(),\n\t\t});\n\n\t\tonLoad(() => {\n\t\t\tconst snd = assets.sounds[src];\n\t\t\tif (!snd) {\n\t\t\t\tthrow new Error(`Sound not found: \"${src}\"`);\n\t\t\t}\n\t\t\tconst pb2 = play(snd, opt);\n\t\t\tfor (const k in pb2) {\n\t\t\t\tpb[k] = pb2[k];\n\t\t\t}\n\t\t});\n\n\t\treturn pb;\n\n\t}\n\n\tconst ctx = audio.ctx;\n\tlet stopped = false;\n\tlet srcNode = ctx.createBufferSource();\n\n\tsrcNode.buffer = src.buf;\n\tsrcNode.loop = opt.loop ? true : false;\n\n\tconst gainNode = ctx.createGain();\n\n\tsrcNode.connect(gainNode);\n\tgainNode.connect(audio.masterNode);\n\n\tconst pos = opt.seek ?? 0;\n\n\tsrcNode.start(0, pos);\n\n\tlet startTime = ctx.currentTime - pos;\n\tlet stopTime: number | null = null;\n\n\tconst handle = {\n\n\t\tstop() {\n\t\t\tif (stopped) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.pause();\n\t\t\tstartTime = ctx.currentTime;\n\t\t},\n\n\t\tplay(seek?: number) {\n\n\t\t\tif (!stopped) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst oldNode = srcNode;\n\n\t\t\tsrcNode = ctx.createBufferSource();\n\t\t\tsrcNode.buffer = oldNode.buffer;\n\t\t\tsrcNode.loop = oldNode.loop;\n\t\t\tsrcNode.playbackRate.value = oldNode.playbackRate.value;\n\n\t\t\tif (srcNode.detune) {\n\t\t\t\tsrcNode.detune.value = oldNode.detune.value;\n\t\t\t}\n\n\t\t\tsrcNode.connect(gainNode);\n\n\t\t\tconst pos = seek ?? this.time();\n\n\t\t\tsrcNode.start(0, pos);\n\t\t\tstartTime = ctx.currentTime - pos;\n\t\t\tstopped = false;\n\t\t\tstopTime = null;\n\n\t\t},\n\n\t\tpause() {\n\t\t\tif (stopped) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tsrcNode.stop();\n\t\t\tstopped = true;\n\t\t\tstopTime = ctx.currentTime;\n\t\t},\n\n\t\tisPaused(): boolean {\n\t\t\treturn stopped;\n\t\t},\n\n\t\tpaused(): boolean {\n\t\t\tdeprecateMsg(\"paused()\", \"isPaused()\");\n\t\t\treturn this.isPaused();\n\t\t},\n\n\t\tisStopped(): boolean {\n\t\t\treturn stopped;\n\t\t},\n\n\t\tstopped(): boolean {\n\t\t\tdeprecateMsg(\"stopped()\", \"isStopped()\");\n\t\t\treturn this.isStopped();\n\t\t},\n\n\t\t// TODO: affect time()\n\t\tspeed(val?: number): number {\n\t\t\tif (val !== undefined) {\n\t\t\t\tsrcNode.playbackRate.value = clamp(val, MIN_SPEED, MAX_SPEED);\n\t\t\t}\n\t\t\treturn srcNode.playbackRate.value;\n\t\t},\n\n\t\tdetune(val?: number): number {\n\t\t\tif (!srcNode.detune) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\tif (val !== undefined) {\n\t\t\t\tsrcNode.detune.value = clamp(val, MIN_DETUNE, MAX_DETUNE);\n\t\t\t}\n\t\t\treturn srcNode.detune.value;\n\t\t},\n\n\t\tvolume(val?: number): number {\n\t\t\tif (val !== undefined) {\n\t\t\t\tgainNode.gain.value = clamp(val, MIN_GAIN, MAX_GAIN);\n\t\t\t}\n\t\t\treturn gainNode.gain.value;\n\t\t},\n\n\t\tloop() {\n\t\t\tsrcNode.loop = true;\n\t\t},\n\n\t\tunloop() {\n\t\t\tsrcNode.loop = false;\n\t\t},\n\n\t\tduration(): number {\n\t\t\treturn src.buf.duration;\n\t\t},\n\n\t\ttime(): number {\n\t\t\tif (stopped) {\n\t\t\t\treturn stopTime - startTime;\n\t\t\t} else {\n\t\t\t\treturn ctx.currentTime - startTime;\n\t\t\t}\n\t\t},\n\n\t};\n\n\thandle.speed(opt.speed);\n\thandle.detune(opt.detune);\n\thandle.volume(opt.volume);\n\n\treturn handle;\n\n}\n\n// core kaboom logic\nfunction burp(opt?: AudioPlayOpt): AudioPlay {\n\treturn play(audio.burpSnd, opt);\n}\n\n// TODO: take these webgl structures out pure\nfunction makeTex(\n\tdata: GfxTexData,\n\topt: GfxTexOpt = {}\n): GfxTexture {\n\n\tconst gl = app.gl;\n\tconst id = gl.createTexture();\n\n\tgl.bindTexture(gl.TEXTURE_2D, id);\n\tgl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n\n\tconst filter = (() => {\n\t\tswitch (opt.filter ?? gopt.texFilter) {\n\t\t\tcase \"linear\": return gl.LINEAR;\n\t\t\tcase \"nearest\": return gl.NEAREST;\n\t\t\tdefault: return gl.NEAREST;\n\t\t}\n\t})();\n\n\tconst wrap = (() => {\n\t\tswitch (opt.wrap) {\n\t\t\tcase \"repeat\": return gl.REPEAT;\n\t\t\tcase \"clampToEdge\": return gl.CLAMP_TO_EDGE;\n\t\t\tdefault: return gl.CLAMP_TO_EDGE;\n\t\t}\n\t})();\n\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap);\n\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap);\n\tgl.bindTexture(gl.TEXTURE_2D, null);\n\n\treturn {\n\t\twidth: data.width,\n\t\theight: data.height,\n\t\tbind() {\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, id);\n\t\t},\n\t\tunbind() {\n\t\t\tgl.bindTexture(gl.TEXTURE_2D, null);\n\t\t},\n\t};\n\n}\n\nfunction makeShader(\n\tvertSrc: string | null = DEF_VERT,\n\tfragSrc: string | null = DEF_FRAG,\n): GfxShader {\n\n\tconst gl = app.gl;\n\tlet msg;\n\tconst vcode = VERT_TEMPLATE.replace(\"{{user}}\", vertSrc ?? DEF_VERT);\n\tconst fcode = FRAG_TEMPLATE.replace(\"{{user}}\", fragSrc ?? DEF_FRAG);\n\tconst vertShader = gl.createShader(gl.VERTEX_SHADER);\n\tconst fragShader = gl.createShader(gl.FRAGMENT_SHADER);\n\n\tgl.shaderSource(vertShader, vcode);\n\tgl.shaderSource(fragShader, fcode);\n\tgl.compileShader(vertShader);\n\tgl.compileShader(fragShader);\n\n\tif ((msg = gl.getShaderInfoLog(vertShader))) {\n\t\tthrow new Error(msg);\n\t}\n\n\tif ((msg = gl.getShaderInfoLog(fragShader))) {\n\t\tthrow new Error(msg);\n\t}\n\n\tconst id = gl.createProgram();\n\n\tgl.attachShader(id, vertShader);\n\tgl.attachShader(id, fragShader);\n\n\tgl.bindAttribLocation(id, 0, \"a_pos\");\n\tgl.bindAttribLocation(id, 1, \"a_uv\");\n\tgl.bindAttribLocation(id, 2, \"a_color\");\n\n\tgl.linkProgram(id);\n\n\tif ((msg = gl.getProgramInfoLog(id))) {\n\t\t// for some reason on safari it always has a \"\\n\" msg\n\t\tif (msg !== \"\\n\") {\n\t\t\tthrow new Error(msg);\n\t\t}\n\t}\n\n\treturn {\n\n\t\tbind() {\n\t\t\tgl.useProgram(id);\n\t\t},\n\n\t\tunbind() {\n\t\t\tgl.useProgram(null);\n\t\t},\n\n\t\tsend(uniform: Uniform) {\n\t\t\tthis.bind();\n\t\t\tfor (const name in uniform) {\n\t\t\t\tconst val = uniform[name];\n\t\t\t\tconst loc = gl.getUniformLocation(id, name);\n\t\t\t\tif (typeof val === \"number\") {\n\t\t\t\t\tgl.uniform1f(loc, val);\n\t\t\t\t} else if (val instanceof Mat4) {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tgl.uniformMatrix4fv(loc, false, new Float32Array(val.m));\n\t\t\t\t} else if (val instanceof Color) {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tgl.uniform4f(loc, val.r, val.g, val.b, val.a);\n\t\t\t\t} else if (val instanceof Vec3) {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tgl.uniform3f(loc, val.x, val.y, val.z);\n\t\t\t\t} else if (val instanceof Vec2) {\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tgl.uniform2f(loc, val.x, val.y);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.unbind();\n\t\t},\n\n\t};\n\n}\n\nfunction makeFont(\n\ttex: GfxTexture,\n\tgw: number,\n\tgh: number,\n\tchars: string,\n): GfxFont {\n\n\tconst cols = tex.width / gw;\n\tconst rows = tex.height / gh;\n\tconst qw = 1.0 / cols;\n\tconst qh = 1.0 / rows;\n\tconst map: Record<string, Vec2> = {};\n\tconst charMap = chars.split(\"\").entries();\n\n\tfor (const [i, ch] of charMap) {\n\t\tmap[ch] = vec2(\n\t\t\t(i % cols) * qw,\n\t\t\tMath.floor(i / cols) * qh,\n\t\t);\n\t}\n\n\treturn {\n\t\ttex: tex,\n\t\tmap: map,\n\t\tqw: qw,\n\t\tqh: qh,\n\t};\n\n}\n\n// TODO: expose\nfunction drawRaw(\n\tverts: Vertex[],\n\tindices: number[],\n\tfixed: boolean,\n\ttex: GfxTexture = gfx.defTex,\n\tshader: GfxShader = gfx.defShader,\n\tuniform: Uniform = {},\n) {\n\n\ttex = tex ?? gfx.defTex;\n\tshader = shader ?? gfx.defShader;\n\n\t// flush on texture / shader change and overflow\n\tif (\n\t\ttex !== gfx.curTex\n\t\t|| shader !== gfx.curShader\n\t\t|| !deepEq(gfx.curUniform, uniform)\n\t\t|| gfx.vqueue.length + verts.length * STRIDE > QUEUE_COUNT\n\t\t|| gfx.iqueue.length + indices.length > QUEUE_COUNT\n\t) {\n\t\tflush();\n\t}\n\n\tfor (const v of verts) {\n\n\t\t// TODO: cache camTransform * gfxTransform?\n\t\tconst transform = fixed ? gfx.transform : game.cam.transform.mult(gfx.transform);\n\n\t\t// normalized world space coordinate [-1.0 ~ 1.0]\n\t\tconst pt = screen2ndc(transform.multVec2(v.pos.xy()));\n\n\t\tgfx.vqueue.push(\n\t\t\tpt.x, pt.y, v.pos.z,\n\t\t\tv.uv.x, v.uv.y,\n\t\t\tv.color.r / 255, v.color.g / 255, v.color.b / 255, v.opacity,\n\t\t);\n\n\t}\n\n\tfor (const i of indices) {\n\t\tgfx.iqueue.push(i + gfx.vqueue.length / STRIDE - verts.length);\n\t}\n\n\tgfx.curTex = tex;\n\tgfx.curShader = shader;\n\tgfx.curUniform = uniform;\n\n}\n\n// draw all batched shapes\nfunction flush() {\n\n\tif (\n\t\t!gfx.curTex\n\t\t|| !gfx.curShader\n\t\t|| gfx.vqueue.length === 0\n\t\t|| gfx.iqueue.length === 0\n\t) {\n\t\treturn;\n\t}\n\n\tconst gl = app.gl;\n\n\tgfx.curShader.send(gfx.curUniform);\n\tgl.bindBuffer(gl.ARRAY_BUFFER, gfx.vbuf);\n\tgl.bufferSubData(gl.ARRAY_BUFFER, 0, new Float32Array(gfx.vqueue));\n\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, gfx.ibuf);\n\tgl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, 0, new Uint16Array(gfx.iqueue));\n\tgfx.curShader.bind();\n\tgfx.curTex.bind();\n\tgl.drawElements(gl.TRIANGLES, gfx.iqueue.length, gl.UNSIGNED_SHORT, 0);\n\tgfx.curTex.unbind();\n\tgfx.curShader.unbind();\n\tgl.bindBuffer(gl.ARRAY_BUFFER, null);\n\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null);\n\n\tgfx.iqueue = [];\n\tgfx.vqueue = [];\n\n\tgfx.drawCalls++;\n\n}\n\n// start a rendering frame, reset some states\nfunction frameStart() {\n\n\tapp.gl.clear(app.gl.COLOR_BUFFER_BIT);\n\n\tif (!gopt.background) {\n\t\tdrawUVQuad({\n\t\t\twidth: width(),\n\t\t\theight: height(),\n\t\t\tquad: new Quad(\n\t\t\t\t0,\n\t\t\t\t0,\n\t\t\t\twidth() * app.scale / BG_GRID_SIZE,\n\t\t\t\theight() * app.scale / BG_GRID_SIZE,\n\t\t\t),\n\t\t\ttex: gfx.bgTex,\n\t\t\tfixed: true,\n\t\t})\n\t}\n\n\tgfx.drawCalls = 0;\n\tgfx.transformStack = [];\n\tgfx.transform = new Mat4();\n\n}\n\nfunction frameEnd() {\n\tflush();\n\tgfx.lastDrawCalls = gfx.drawCalls;\n}\n\nfunction drawCalls() {\n\treturn gfx.lastDrawCalls;\n}\n\n// convert a screen space coordinate to webgl normalized device coordinate\nfunction screen2ndc(pt: Vec2): Vec2 {\n\treturn vec2(\n\t\tpt.x / width() * 2 - 1,\n\t\t-pt.y / height() * 2 + 1,\n\t);\n}\n\n// convert a webgl normalied device coordinate to screen space coordinate\nfunction ndc2screen(pt: Vec2): Vec2 {\n\treturn vec2(\n\t\t(pt.x + 1) / 2 * width(),\n\t\t-(pt.y - 1) / 2 * height(),\n\t);\n}\n\nfunction applyMatrix(m: Mat4) {\n\tgfx.transform = m.clone();\n}\n\nfunction pushTranslate(...args) {\n\tif (args[0] === undefined) return;\n\tconst p = vec2(...args);\n\tif (p.x === 0 && p.y === 0) return;\n\tgfx.transform = gfx.transform.translate(p);\n}\n\nfunction pushScale(...args) {\n\tif (args[0] === undefined) return;\n\tconst p = vec2(...args);\n\tif (p.x === 1 && p.y === 1) return;\n\tgfx.transform = gfx.transform.scale(p);\n}\n\nfunction pushRotateX(a: number) {\n\tif (!a) {\n\t\treturn;\n\t}\n\tgfx.transform = gfx.transform.rotateX(a);\n}\n\nfunction pushRotateY(a: number) {\n\tif (!a) {\n\t\treturn;\n\t}\n\tgfx.transform = gfx.transform.rotateY(a);\n}\n\nfunction pushRotateZ(a: number) {\n\tif (!a) {\n\t\treturn;\n\t}\n\tgfx.transform = gfx.transform.rotateZ(a);\n}\n\nfunction pushTransform() {\n\tgfx.transformStack.push(gfx.transform.clone());\n}\n\nfunction popTransform() {\n\tif (gfx.transformStack.length > 0) {\n\t\tgfx.transform = gfx.transformStack.pop();\n\t}\n}\n\n// draw a uv textured quad\nfunction drawUVQuad(opt: DrawUVQuadOpt) {\n\n\tif (opt.width === undefined || opt.height === undefined) {\n\t\tthrow new Error(\"drawUVQuad() requires property \\\"width\\\" and \\\"height\\\".\");\n\t}\n\n\tif (opt.width <= 0 || opt.height <= 0) {\n\t\treturn;\n\t}\n\n\tconst w = opt.width;\n\tconst h = opt.height;\n\tconst origin = originPt(opt.origin || DEF_ORIGIN);\n\tconst offset = origin.scale(vec2(w, h).scale(-0.5));\n\tconst q = opt.quad || new Quad(0, 0, 1, 1);\n\tconst color = opt.color || rgb(255, 255, 255);\n\tconst opacity = opt.opacity ?? 1;\n\n\tpushTransform();\n\tpushTranslate(opt.pos);\n\tpushRotateZ(opt.angle);\n\tpushScale(opt.scale);\n\tpushTranslate(offset);\n\n\tdrawRaw([\n\t\t{\n\t\t\tpos: vec3(-w / 2, h / 2, 0),\n\t\t\tuv: vec2(opt.flipX ? q.x + q.w : q.x, opt.flipY ? q.y : q.y + q.h),\n\t\t\tcolor: color,\n\t\t\topacity: opacity,\n\t\t},\n\t\t{\n\t\t\tpos: vec3(-w / 2, -h / 2, 0),\n\t\t\tuv: vec2(opt.flipX ? q.x + q.w : q.x, opt.flipY ? q.y + q.h : q.y),\n\t\t\tcolor: color,\n\t\t\topacity: opacity,\n\t\t},\n\t\t{\n\t\t\tpos: vec3(w / 2, -h / 2, 0),\n\t\t\tuv: vec2(opt.flipX ? q.x : q.x + q.w, opt.flipY ? q.y + q.h : q.y),\n\t\t\tcolor: color,\n\t\t\topacity: opacity,\n\t\t},\n\t\t{\n\t\t\tpos: vec3(w / 2, h / 2, 0),\n\t\t\tuv: vec2(opt.flipX ? q.x : q.x + q.w, opt.flipY ? q.y : q.y + q.h),\n\t\t\tcolor: color,\n\t\t\topacity: opacity,\n\t\t},\n\t], [0, 1, 3, 1, 2, 3], opt.fixed, opt.tex, opt.shader, opt.uniform);\n\n\tpopTransform();\n\n}\n\n// TODO: clean\nfunction drawTexture(opt: DrawTextureOpt) {\n\n\tif (!opt.tex) {\n\t\tthrow new Error(\"drawTexture() requires property \\\"tex\\\".\");\n\t}\n\n\tconst q = opt.quad ?? new Quad(0, 0, 1, 1);\n\tconst w = opt.tex.width * q.w;\n\tconst h = opt.tex.height * q.h;\n\tconst scale = vec2(1);\n\n\tif (opt.tiled) {\n\n\t\t// TODO: draw fract\n\t\tconst repX = Math.ceil((opt.width || w) / w);\n\t\tconst repY = Math.ceil((opt.height || h) / h);\n\t\tconst origin = originPt(opt.origin || DEF_ORIGIN).add(vec2(1, 1)).scale(0.5);\n\t\tconst offset = origin.scale(repX * w, repY * h);\n\n\t\t// TODO: rotation\n\t\tfor (let i = 0; i < repX; i++) {\n\t\t\tfor (let j = 0; j < repY; j++) {\n\t\t\t\tdrawUVQuad({\n\t\t\t\t\t...opt,\n\t\t\t\t\tpos: (opt.pos || vec2(0)).add(vec2(w * i, h * j)).sub(offset),\n\t\t\t\t\t// @ts-ignore\n\t\t\t\t\tscale: scale.scale(opt.scale || vec2(1)),\n\t\t\t\t\ttex: opt.tex,\n\t\t\t\t\tquad: q,\n\t\t\t\t\twidth: w,\n\t\t\t\t\theight: h,\n\t\t\t\t\torigin: \"topleft\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t} else {\n\n\t\t// TODO: should this ignore scale?\n\t\tif (opt.width && opt.height) {\n\t\t\tscale.x = opt.width / w;\n\t\t\tscale.y = opt.height / h;\n\t\t} else if (opt.width) {\n\t\t\tscale.x = opt.width / w;\n\t\t\tscale.y = scale.x;\n\t\t} else if (opt.height) {\n\t\t\tscale.y = opt.height / h;\n\t\t\tscale.x = scale.y;\n\t\t}\n\n\t\tdrawUVQuad({\n\t\t\t...opt,\n\t\t\t// @ts-ignore\n\t\t\tscale: scale.scale(opt.scale || vec2(1)),\n\t\t\ttex: opt.tex,\n\t\t\tquad: q,\n\t\t\twidth: w,\n\t\t\theight: h,\n\t\t});\n\n\t}\n\n}\n\n// TODO: use native asset loader tracking\nconst loading = new Set();\n\nfunction drawSprite(opt: DrawSpriteOpt) {\n\n\tif (!opt.sprite) {\n\t\tthrow new Error(`drawSprite() requires property \"sprite\"`);\n\t}\n\n\tconst spr = findAsset(opt.sprite, assets.sprites);\n\n\tif (!spr) {\n\n\t\t// if passes a source url, we load it implicitly\n\t\tif (typeof opt.sprite === \"string\") {\n\t\t\tif (!loading.has(opt.sprite)) {\n\t\t\t\tloading.add(opt.sprite);\n\t\t\t\tloadSprite(opt.sprite, opt.sprite)\n\t\t\t\t\t.then((a) => loading.delete(opt.sprite));\n\t\t\t}\n\t\t\treturn;\n\t\t} else {\n\t\t\tthrow new Error(`sprite not found: \"${opt.sprite}\"`);\n\t\t}\n\n\t}\n\n\tconst q = spr.frames[opt.frame ?? 0];\n\n\tif (!q) {\n\t\tthrow new Error(`frame not found: ${opt.frame ?? 0}`);\n\t}\n\n\tdrawTexture({\n\t\t...opt,\n\t\ttex: spr.tex,\n\t\tquad: q.scale(opt.quad || new Quad(0, 0, 1, 1)),\n\t\tuniform: opt.uniform,\n\t});\n\n}\n\n// generate vertices to form an arc\nfunction getArcPts(\n\tpos: Vec2,\n\tradiusX: number,\n\tradiusY: number,\n\tstart: number,\n\tend: number,\n\tres: number = 1,\n): Vec2[] {\n\n\t// normalize and turn start and end angles to radians\n\tstart = deg2rad(start % 360);\n\tend = deg2rad(end % 360);\n\tif (end <= start) end += Math.PI * 2;\n\n\t// TODO: better way to get this?\n\t// the number of vertices is sqrt(r1 + r2) * 3 * res with a minimum of 16\n\tconst nverts = Math.ceil(Math.max(Math.sqrt(radiusX + radiusY) * 3 * (res || 1), 16));\n\tconst step = (end - start) / nverts;\n\tconst pts = [];\n\n\t// calculate vertices\n\tfor (let a = start; a < end; a += step) {\n\t\tpts.push(pos.add(radiusX * Math.cos(a), radiusY * Math.sin(a)));\n\t}\n\n\t// doing this on the side due to possible floating point inaccuracy\n\tpts.push(pos.add(radiusX * Math.cos(end), radiusY * Math.sin(end)));\n\n\treturn pts;\n\n}\n\nfunction drawRect(opt: DrawRectOpt) {\n\n\tif (opt.width === undefined || opt.height === undefined) {\n\t\tthrow new Error(\"drawRect() requires property \\\"width\\\" and \\\"height\\\".\");\n\t}\n\n\tif (opt.width <= 0 || opt.height <= 0) {\n\t\treturn;\n\t}\n\n\tconst w = opt.width;\n\tconst h = opt.height;\n\tconst origin = originPt(opt.origin || DEF_ORIGIN).add(1, 1);\n\tconst offset = origin.scale(vec2(w, h).scale(-0.5));\n\n\tlet pts = [\n\t\tvec2(0, 0),\n\t\tvec2(w, 0),\n\t\tvec2(w, h),\n\t\tvec2(0, h),\n\t];\n\n\t// TODO: drawPolygon should handle generic rounded corners\n\tif (opt.radius) {\n\n\t\t// maxium radius is half the shortest side\n\t\tconst r = Math.min(Math.min(w, h) / 2, opt.radius);\n\n\t\tpts = [\n\t\t\tvec2(r, 0),\n\t\t\tvec2(w - r, 0),\n\t\t\t...getArcPts(vec2(w - r, r), r, r, 270, 360),\n\t\t\tvec2(w, r),\n\t\t\tvec2(w, h - r),\n\t\t\t...getArcPts(vec2(w - r, h - r), r, r, 0, 90),\n\t\t\tvec2(w - r, h),\n\t\t\tvec2(r, h),\n\t\t\t...getArcPts(vec2(r, h - r), r, r, 90, 180),\n\t\t\tvec2(0, h - r),\n\t\t\tvec2(0, r),\n\t\t\t...getArcPts(vec2(r, r), r, r, 180, 270),\n\t\t];\n\n\t}\n\n\tdrawPolygon({ ...opt, offset, pts });\n\n}\n\nfunction drawLine(opt: DrawLineOpt) {\n\n\tconst { p1, p2 } = opt;\n\n\tif (!p1 || !p2) {\n\t\tthrow new Error(\"drawLine() requires properties \\\"p1\\\" and \\\"p2\\\".\");\n\t}\n\n\tconst w = opt.width || 1;\n\n\t// the displacement from the line end point to the corner point\n\tconst dis = p2.sub(p1).unit().normal().scale(w * 0.5);\n\n\t// calculate the 4 corner points of the line polygon\n\tconst verts = [\n\t\tp1.sub(dis),\n\t\tp1.add(dis),\n\t\tp2.add(dis),\n\t\tp2.sub(dis),\n\t].map((p) => ({\n\t\tpos: vec3(p.x, p.y, 0),\n\t\tuv: vec2(0),\n\t\tcolor: opt.color ?? Color.WHITE,\n\t\topacity: opt.opacity ?? 1,\n\t}));\n\n\tdrawRaw(verts, [0, 1, 3, 1, 2, 3], opt.fixed, gfx.defTex, opt.shader, opt.uniform);\n\n}\n\nfunction drawLines(opt: DrawLinesOpt) {\n\n\tconst pts = opt.pts;\n\n\tif (!pts) {\n\t\tthrow new Error(\"drawLines() requires property \\\"pts\\\".\");\n\t}\n\n\tif (pts.length < 2) {\n\t\treturn;\n\t}\n\n\tif (opt.radius && pts.length >= 3) {\n\n\t\t// TODO: rounded vertices for arbitury polygonic shape\n\t\tlet minLen = pts[0].dist(pts[1]);\n\n\t\tfor (let i = 1; i < pts.length - 1; i++) {\n\t\t\tminLen = Math.min(pts[i].dist(pts[i + 1]), minLen);\n\t\t}\n\n\t\tconst radius = Math.min(opt.radius, minLen / 2);\n\n\t\tdrawLine({ ...opt, p1: pts[0], p2: pts[1], });\n\n\t\tfor (let i = 1; i < pts.length - 2; i++) {\n\t\t\tconst p1 = pts[i];\n\t\t\tconst p2 = pts[i + 1];\n\t\t\tdrawLine({\n\t\t\t\t...opt,\n\t\t\t\tp1: p1,\n\t\t\t\tp2: p2,\n\t\t\t});\n\t\t}\n\n\t\tdrawLine({ ...opt, p1: pts[pts.length - 2], p2: pts[pts.length - 1], });\n\n\t} else {\n\n\t\tfor (let i = 0; i < pts.length - 1; i++) {\n\t\t\tdrawLine({\n\t\t\t\t...opt,\n\t\t\t\tp1: pts[i],\n\t\t\t\tp2: pts[i + 1],\n\t\t\t});\n\t\t}\n\n\t}\n\n}\n\nfunction drawTriangle(opt: DrawTriangleOpt) {\n\tif (!opt.p1 || !opt.p2 || !opt.p3) {\n\t\tthrow new Error(\"drawPolygon() requires properties \\\"p1\\\", \\\"p2\\\" and \\\"p3\\\".\");\n\t}\n\treturn drawPolygon({\n\t\t...opt,\n\t\tpts: [opt.p1, opt.p2, opt.p3],\n\t});\n}\n\n// TODO: origin\nfunction drawCircle(opt: DrawCircleOpt) {\n\n\tif (!opt.radius) {\n\t\tthrow new Error(\"drawCircle() requires property \\\"radius\\\".\");\n\t}\n\n\tif (opt.radius === 0) {\n\t\treturn;\n\t}\n\n\tdrawEllipse({\n\t\t...opt,\n\t\tradiusX: opt.radius,\n\t\tradiusY: opt.radius,\n\t\tangle: 0,\n\t});\n\n}\n\n// TODO: use fan-like triangulation\nfunction drawEllipse(opt: DrawEllipseOpt) {\n\n\tif (opt.radiusX === undefined || opt.radiusY === undefined) {\n\t\tthrow new Error(\"drawEllipse() requires properties \\\"radiusX\\\" and \\\"radiusY\\\".\");\n\t}\n\n\tif (opt.radiusX === 0 || opt.radiusY === 0) {\n\t\treturn;\n\t}\n\n\tdrawPolygon({\n\t\t...opt,\n\t\tpts: getArcPts(\n\t\t\tvec2(0),\n\t\t\topt.radiusX,\n\t\t\topt.radiusY,\n\t\t\topt.start ?? 0,\n\t\t\topt.end ?? 360,\n\t\t\topt.resolution\n\t\t),\n\t\tradius: 0,\n\t});\n\n}\n\nfunction drawPolygon(opt: DrawPolygonOpt) {\n\n\tif (!opt.pts) {\n\t\tthrow new Error(\"drawPolygon() requires property \\\"pts\\\".\");\n\t}\n\n\tconst npts = opt.pts.length;\n\n\tif (npts < 3) {\n\t\treturn;\n\t}\n\n\tpushTransform();\n\tpushTranslate(opt.pos);\n\tpushScale(opt.scale);\n\tpushRotateZ(opt.angle);\n\tpushTranslate(opt.offset);\n\n\tif (opt.fill !== false) {\n\n\t\tconst color = opt.color ?? Color.WHITE;\n\n\t\tconst verts = opt.pts.map((pt) => ({\n\t\t\tpos: vec3(pt.x, pt.y, 0),\n\t\t\tuv: vec2(0, 0),\n\t\t\tcolor: color,\n\t\t\topacity: opt.opacity ?? 1,\n\t\t}));\n\n\t\t// TODO: better triangulation\n\t\tconst indices = [...Array(npts - 2).keys()]\n\t\t\t.map((n) => [0, n + 1, n + 2])\n\t\t\t.flat();\n\n\t\tdrawRaw(verts, opt.indices ?? indices, opt.fixed, gfx.defTex, opt.shader, opt.uniform);\n\n\t}\n\n\tif (opt.outline) {\n\t\tdrawLines({\n\t\t\tpts: [ ...opt.pts, opt.pts[0] ],\n\t\t\tradius: opt.radius,\n\t\t\twidth: opt.outline.width,\n\t\t\tcolor: opt.outline.color,\n\t\t\tuniform: opt.uniform,\n\t\t\tfixed: opt.fixed,\n\t\t});\n\t}\n\n\tpopTransform();\n\n}\n\nfunction applyCharTransform(fchar: FormattedChar, tr: CharTransform) {\n\tif (tr.pos) fchar.pos = fchar.pos.add(tr.pos);\n\tif (tr.scale) fchar.scale = fchar.scale.scale(vec2(tr.scale));\n\tif (tr.angle) fchar.angle += tr.angle;\n\tif (tr.color) fchar.color = fchar.color.mult(tr.color);\n\tif (tr.opacity) fchar.opacity *= tr.opacity;\n}\n\n// TODO: escape\nconst TEXT_STYLE_RE = /\\[(?<text>[^\\]]*)\\]\\.(?<style>[\\w\\.]+)+/g;\n\nfunction compileStyledText(text: string): {\n\tcharStyleMap: Record<number, {\n\t\tlocalIdx: number,\n\t\tstyles: string[],\n\t}>,\n\ttext: string,\n} {\n\n\tconst charStyleMap = {};\n\t// get the text without the styling syntax\n\tconst renderText = text.replace(TEXT_STYLE_RE, \"$1\");\n\tlet idxOffset = 0;\n\n\t// put each styled char index into a map for easy access when iterating each char\n\tfor (const match of text.matchAll(TEXT_STYLE_RE)) {\n\t\tconst styles = match.groups.style.split(\".\");\n\t\tconst origIdx = match.index - idxOffset;\n\t\tfor (\n\t\t\tlet i = origIdx;\n\t\t\ti < match.index + match.groups.text.length;\n\t\t\ti++\n\t\t) {\n\t\t\tcharStyleMap[i] = {\n\t\t\t\tlocalIdx: i - origIdx,\n\t\t\t\tstyles: styles,\n\t\t\t};\n\t\t}\n\t\t// omit \"[\", \"]\", \".\" and the style text in the format string when calculating index\n\t\tidxOffset += 3 + match.groups.style.length;\n\t}\n\n\treturn {\n\t\tcharStyleMap: charStyleMap,\n\t\ttext: renderText,\n\t};\n\n}\n\nfunction findAsset<T>(src: string | T, lib: Record<string, T>, def?: string): T | undefined {\n\tif (src) {\n\t\treturn typeof src === \"string\" ? lib[src] : src;\n\t} else if (def) {\n\t\treturn lib[def];\n\t}\n}\n\n// format text and return a list of chars with their calculated position\nfunction formatText(opt: DrawTextOpt): FormattedText {\n\n\tif (opt.text === undefined) {\n\t\tthrow new Error(\"formatText() requires property \\\"text\\\".\");\n\t}\n\n\tconst font = findAsset(opt.font ?? gopt.font, assets.fonts, DEF_FONT);\n\n\tif (!font) {\n\t\tthrow new Error(`Font not found: ${opt.font}`);\n\t}\n\n\tconst { charStyleMap, text } = compileStyledText(opt.text + \"\");\n\tconst chars = text.split(\"\");\n\tconst gw = font.qw * font.tex.width;\n\tconst gh = font.qh * font.tex.height;\n\tconst size = opt.size || gh;\n\tconst scale = vec2(size / gh).scale(vec2(opt.scale || 1));\n\tconst cw = scale.x * gw + (opt.letterSpacing ?? 0);\n\tconst ch = scale.y * gh + (opt.lineSpacing ?? 0);\n\tlet curX = 0;\n\tlet th = ch;\n\tlet tw = 0;\n\tconst flines = [];\n\tlet curLine = [];\n\tlet lastSpace = null;\n\tlet cursor = 0;\n\n\twhile (cursor < chars.length) {\n\n\t\tlet char = chars[cursor];\n\n\t\t// check new line\n\t\tif (char === \"\\n\") {\n\t\t\t// always new line on '\\n'\n\t\t\tth += ch;\n\t\t\tcurX = 0;\n\t\t\tlastSpace = null;\n\t\t\tcurLine.push(char);\n\t\t\tflines.push(curLine);\n\t\t\tcurLine = [];\n\t\t} else if ((opt.width ? (curX + cw > opt.width) : false)) {\n\t\t\t// new line on last word if width exceeds\n\t\t\tth += ch;\n\t\t\tcurX = 0;\n\t\t\tif (lastSpace != null) {\n\t\t\t\tcursor -= curLine.length - lastSpace;\n\t\t\t\tchar = chars[cursor];\n\t\t\t\tcurLine = curLine.slice(0, lastSpace);\n\t\t\t}\n\t\t\tlastSpace = null;\n\t\t\tflines.push(curLine);\n\t\t\tcurLine = [];\n\t\t}\n\n\t\t// push char\n\t\tif (char !== \"\\n\") {\n\t\t\tcurLine.push(char);\n\t\t\tcurX += cw;\n\t\t\tif (char === \" \") {\n\t\t\t\tlastSpace = curLine.length;\n\t\t\t}\n\t\t}\n\n\t\ttw = Math.max(tw, curX);\n\t\tcursor++;\n\n\t}\n\n\tflines.push(curLine);\n\n\tif (opt.width) {\n\t\ttw = opt.width;\n\t}\n\n\t// whole text offset\n\tconst fchars = [];\n\tconst pos = vec2(opt.pos || 0);\n\tconst offset = originPt(opt.origin || DEF_ORIGIN).scale(0.5);\n\t// this math is complicated i forgot how it works instantly\n\tconst ox = -offset.x * cw - (offset.x + 0.5) * (tw - cw);\n\tconst oy = -offset.y * ch - (offset.y + 0.5) * (th - ch);\n\tlet idx = 0;\n\n\tflines.forEach((line, ln) => {\n\n\t\t// line offset\n\t\tconst oxl = (tw - line.length * cw) * (offset.x + 0.5);\n\n\t\tline.forEach((char, cn) => {\n\t\t\tconst qpos = font.map[char];\n\t\t\tconst x = cn * cw;\n\t\t\tconst y = ln * ch;\n\t\t\tif (qpos) {\n\t\t\t\tconst fchar: FormattedChar = {\n\t\t\t\t\ttex: font.tex,\n\t\t\t\t\tquad: new Quad(qpos.x, qpos.y, font.qw, font.qh),\n\t\t\t\t\tch: char,\n\t\t\t\t\tpos: vec2(pos.x + x + ox + oxl, pos.y + y + oy),\n\t\t\t\t\topacity: opt.opacity,\n\t\t\t\t\tcolor: opt.color ?? rgb(255, 255, 255),\n\t\t\t\t\tscale: scale,\n\t\t\t\t\tangle: 0,\n\t\t\t\t\tuniform: opt.uniform,\n\t\t\t\t\tfixed: opt.fixed,\n\t\t\t\t}\n\t\t\t\tif (opt.transform) {\n\t\t\t\t\tconst tr = typeof opt.transform === \"function\"\n\t\t\t\t\t\t? opt.transform(idx, char)\n\t\t\t\t\t\t: opt.transform;\n\t\t\t\t\tif (tr) {\n\t\t\t\t\t\tapplyCharTransform(fchar, tr);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (charStyleMap[idx]) {\n\t\t\t\t\tconst { styles, localIdx } = charStyleMap[idx];\n\t\t\t\t\tfor (const name of styles) {\n\t\t\t\t\t\tconst style = opt.styles[name];\n\t\t\t\t\t\tconst tr = typeof style === \"function\"\n\t\t\t\t\t\t\t? style(localIdx, char)\n\t\t\t\t\t\t\t: style;\n\t\t\t\t\t\tif (tr) {\n\t\t\t\t\t\t\tapplyCharTransform(fchar, tr);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfchars.push(fchar);\n\t\t\t}\n\t\t\tidx += 1;\n\t\t});\n\t});\n\n\treturn {\n\t\twidth: tw,\n\t\theight: th,\n\t\tchars: fchars,\n\t};\n\n}\n\nfunction drawText(opt: DrawTextOpt) {\n\tdrawFormattedText(formatText(opt));\n}\n\n// TODO: rotation\nfunction drawFormattedText(ftext: FormattedText) {\n\tfor (const ch of ftext.chars) {\n\t\tdrawUVQuad({\n\t\t\ttex: ch.tex,\n\t\t\twidth: ch.tex.width * ch.quad.w,\n\t\t\theight: ch.tex.height * ch.quad.h,\n\t\t\tpos: ch.pos,\n\t\t\tscale: ch.scale,\n\t\t\tangle: ch.angle,\n\t\t\tcolor: ch.color,\n\t\t\topacity: ch.opacity,\n\t\t\tquad: ch.quad,\n\t\t\t// TODO: topleft\n\t\t\torigin: \"center\",\n\t\t\tuniform: ch.uniform,\n\t\t\tfixed: ch.fixed,\n\t\t});\n\t}\n}\n\n/**\n * Update viewport based on user setting and fullscreen state\n */\nfunction updateViewport() {\n\n\tconst gl = app.gl;\n\n\t// canvas size\n\tconst cw = gl.drawingBufferWidth;\n\tconst ch = gl.drawingBufferHeight;\n\n\t// game size\n\tconst gw = width();\n\tconst gh = height();\n\n\tif (isFullscreen()) {\n\t\t// TODO: doesn't work with letterbox\n\t\tconst ww = window.innerWidth;\n\t\tconst wh = window.innerHeight;\n\t\tconst rw = ww / wh;\n\t\tconst rc = cw / ch;\n\t\tif (rw > rc) {\n\t\t\tconst sw = window.innerHeight * rc;\n\t\t\tgfx.viewport = {\n\t\t\t\tx: (ww - sw) / 2,\n\t\t\t\ty: 0,\n\t\t\t\twidth: sw,\n\t\t\t\theight: wh,\n\t\t\t};\n\t\t} else {\n\t\t\tconst sh = window.innerWidth / rc;\n\t\t\tgfx.viewport = {\n\t\t\t\tx: 0,\n\t\t\t\ty: (wh - sh) / 2,\n\t\t\t\twidth: ww,\n\t\t\t\theight: sh,\n\t\t\t};\n\t\t}\n\t\treturn;\n\t}\n\n\tif (gopt.letterbox) {\n\n\t\tif (!gopt.width || !gopt.height) {\n\t\t\tthrow new Error(\"Letterboxing requires width and height defined.\");\n\t\t}\n\n\t\tconst rc = cw / ch;\n\t\tconst rg = gopt.width / gopt.height;\n\n\t\tif (rc > rg) {\n\t\t\tif (!gopt.stretch) {\n\t\t\t\tgfx.width = ch * rg;\n\t\t\t\tgfx.height = ch;\n\t\t\t}\n\t\t\tconst sw = ch * rg;\n\t\t\tconst sh = ch;\n\t\t\tconst x = (cw - sw) / 2;\n\t\t\tgl.scissor(x, 0, sw, sh);\n\t\t\tgl.viewport(x, 0, sw, ch);\n\t\t\tgfx.viewport = {\n\t\t\t\tx: x,\n\t\t\t\ty: 0,\n\t\t\t\twidth: sw,\n\t\t\t\theight: ch,\n\t\t\t};\n\t\t} else {\n\t\t\tif (!gopt.stretch) {\n\t\t\t\tgfx.width = cw;\n\t\t\t\tgfx.height = cw / rg;\n\t\t\t}\n\t\t\tconst sw = cw;\n\t\t\tconst sh = cw / rg;\n\t\t\tconst y = (ch - sh) / 2;\n\t\t\tgl.scissor(0, y, sw, sh);\n\t\t\tgl.viewport(0, y, cw, sh);\n\t\t\tgfx.viewport = {\n\t\t\t\tx: 0,\n\t\t\t\ty: y,\n\t\t\t\twidth: cw,\n\t\t\t\theight: sh,\n\t\t\t};\n\t\t}\n\n\t\treturn;\n\n\t}\n\n\tif (gopt.stretch) {\n\n\t\tif (!gopt.width || !gopt.height) {\n\t\t\tthrow new Error(\"Stretching requires width and height defined.\");\n\t\t}\n\n\t\tgl.viewport(0, 0, cw, ch);\n\n\t\tgfx.viewport = {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: cw,\n\t\t\theight: ch,\n\t\t};\n\n\t\treturn;\n\t}\n\n\tgfx.width = cw / app.scale;\n\tgfx.height = ch / app.scale;\n\tgl.viewport(0, 0, cw, ch);\n\n\tgfx.viewport = {\n\t\tx: 0,\n\t\ty: 0,\n\t\twidth: cw,\n\t\theight: ch,\n\t};\n\n}\n\n// get game width\nfunction width(): number {\n\treturn gfx.width;\n}\n\n// get game height\nfunction height(): number {\n\treturn gfx.height;\n}\n\n// TODO: support remove events\napp.canvas.addEventListener(\"mousemove\", (e) => {\n\tapp.mousePos = vec2(\n\t\t(e.offsetX - gfx.viewport.x) * width() / gfx.viewport.width,\n\t\t(e.offsetY - gfx.viewport.y) * height() / gfx.viewport.height,\n\t);\n\tapp.mouseDeltaPos = vec2(e.movementX, e.movementY).scale(1 / app.scale);\n\tapp.isMouseMoved = true;\n});\n\napp.canvas.addEventListener(\"mousedown\", (e) => {\n\tconst m = MOUSE_BUTTONS[e.button];\n\tif (m) {\n\t\tapp.mouseStates[m] = \"pressed\";\n\t}\n});\n\napp.canvas.addEventListener(\"mouseup\", (e) => {\n\tconst m = MOUSE_BUTTONS[e.button];\n\tif (m) {\n\t\tapp.mouseStates[m] = \"released\";\n\t}\n});\n\napp.canvas.addEventListener(\"keydown\", (e) => {\n\n\tconst k = KEY_ALIAS[e.key] || e.key.toLowerCase();\n\n\tif (PREVENT_DEFAULT_KEYS.includes(k)) {\n\t\te.preventDefault();\n\t}\n\n\tif (k.length === 1) {\n\t\tapp.charInputted.push(e.key);\n\t}\n\n\tif (k === \"space\") {\n\t\tapp.charInputted.push(\" \");\n\t}\n\n\tif (e.repeat) {\n\t\tapp.isKeyPressedRepeat = true;\n\t\tapp.keyStates[k] = \"rpressed\";\n\t} else {\n\t\tapp.isKeyPressed = true;\n\t\tapp.keyStates[k] = \"pressed\";\n\t}\n\n});\n\napp.canvas.addEventListener(\"keyup\", (e: KeyboardEvent) => {\n\tconst k = KEY_ALIAS[e.key] || e.key.toLowerCase();\n\tapp.keyStates[k] = \"released\";\n\tapp.isKeyReleased = true;\n});\n\napp.canvas.addEventListener(\"touchstart\", (e) => {\n\tif (!gopt.touchToMouse) return;\n\t// disable long tap context menu\n\te.preventDefault();\n\tconst t = e.touches[0];\n\tapp.mousePos = vec2(t.clientX, t.clientY).scale(1 / app.scale);\n\tapp.mouseStates[\"left\"] = \"pressed\";\n});\n\napp.canvas.addEventListener(\"touchmove\", (e) => {\n\tif (!gopt.touchToMouse) return;\n\t// disable scrolling\n\te.preventDefault();\n\tconst t = e.touches[0];\n\tapp.mousePos = vec2(t.clientX, t.clientY).scale(1 / app.scale);\n\tapp.isMouseMoved = true;\n});\n\napp.canvas.addEventListener(\"touchend\", (e) => {\n\tif (!gopt.touchToMouse) return;\n\tapp.mouseStates[\"left\"] = \"released\";\n});\n\napp.canvas.addEventListener(\"touchcancel\", (e) => {\n\tif (!gopt.touchToMouse) return;\n\tapp.mouseStates[\"left\"] = \"released\";\n});\n\napp.canvas.addEventListener(\"touchstart\", (e) => {\n\t[...e.changedTouches].forEach((t) => {\n\t\tgame.trigger(\"onTouchStart\", t.identifier, vec2(t.clientX, t.clientY).scale(1 / app.scale));\n\t});\n});\n\napp.canvas.addEventListener(\"touchmove\", (e) => {\n\t[...e.changedTouches].forEach((t) => {\n\t\tgame.trigger(\"onTouchMove\", t.identifier, vec2(t.clientX, t.clientY).scale(1 / app.scale));\n\t});\n});\n\napp.canvas.addEventListener(\"touchend\", (e) => {\n\t[...e.changedTouches].forEach((t) => {\n\t\tgame.trigger(\"onTouchEnd\", t.identifier, vec2(t.clientX, t.clientY).scale(1 / app.scale));\n\t});\n});\n\napp.canvas.addEventListener(\"contextmenu\", function (e) {\n\te.preventDefault();\n});\n\ndocument.addEventListener(\"visibilitychange\", () => {\n\tswitch (document.visibilityState) {\n\t\tcase \"visible\":\n\t\t\t// prevent a surge of dt() when switch back after the tab being hidden for a while\n\t\t\tapp.skipTime = true;\n\t\t\t// TODO: don't resume if debug.paused\n\t\t\taudio.ctx.resume();\n\t\t\tbreak;\n\t\tcase \"hidden\":\n\t\t\taudio.ctx.suspend();\n\t\t\tbreak;\n\t}\n});\n\n// TODO: not quite working\n// window.addEventListener(\"resize\", () => {\n// \tif (!(gopt.width && gopt.height && !gopt.stretch)) {\n// \t\tapp.canvas.width = app.canvas.parentElement.offsetWidth;\n// \t\tapp.canvas.height = app.canvas.parentElement.offsetHeight;\n// \t}\n// });\n\nfunction mousePos(): Vec2 {\n\treturn app.mousePos.clone();\n}\n\nfunction mouseDeltaPos(): Vec2 {\n\treturn app.mouseDeltaPos.clone();\n}\n\nfunction isMousePressed(m = \"left\"): boolean {\n\treturn app.mouseStates[m] === \"pressed\";\n}\n\nfunction isMouseDown(m = \"left\"): boolean {\n\treturn app.mouseStates[m] === \"pressed\" || app.mouseStates[m] === \"down\";\n}\n\nfunction isMouseReleased(m = \"left\"): boolean {\n\treturn app.mouseStates[m] === \"released\";\n}\n\nfunction isMouseMoved(): boolean {\n\treturn app.isMouseMoved;\n}\n\nfunction isKeyPressed(k?: string): boolean {\n\tif (k === undefined) {\n\t\treturn app.isKeyPressed;\n\t} else {\n\t\treturn app.keyStates[k] === \"pressed\";\n\t}\n}\n\nfunction isKeyPressedRepeat(k: string): boolean {\n\tif (k === undefined) {\n\t\treturn app.isKeyPressedRepeat;\n\t} else {\n\t\treturn app.keyStates[k] === \"pressed\" || app.keyStates[k] === \"rpressed\";\n\t}\n}\n\nfunction isKeyDown(k: string): boolean {\n\treturn app.keyStates[k] === \"pressed\"\n\t\t|| app.keyStates[k] === \"rpressed\"\n\t\t|| app.keyStates[k] === \"down\";\n}\n\nfunction isKeyReleased(k?: string): boolean {\n\tif (k === undefined) {\n\t\treturn app.isKeyReleased;\n\t} else {\n\t\treturn app.keyStates[k] === \"released\";\n\t}\n}\n\nfunction charInputted(): string[] {\n\treturn [...app.charInputted];\n}\n\nfunction time(): number {\n\treturn app.time;\n}\n\n// get a base64 png image of canvas\nfunction screenshot(): string {\n\treturn app.canvas.toDataURL();\n}\n\n// TODO: custom cursor\nfunction cursor(c?: Cursor): Cursor {\n\tif (c) {\n\t\tapp.canvas.style.cursor = c;\n\t}\n\treturn app.canvas.style.cursor;\n}\n\nfunction fullscreen(f: boolean = true) {\n\tif (f) {\n\t\tenterFullscreen(app.canvas);\n\t} else {\n\t\texitFullscreen();\n\t}\n}\n\nfunction isFullscreen(): boolean {\n\treturn Boolean(getFullscreenElement());\n}\n\nfunction quit() {\n\tcancelAnimationFrame(app.loopID);\n\tapp.stopped = true;\n}\n\nconst debug: Debug = {\n\tinspect: false,\n\ttimeScale: 1,\n\tshowLog: true,\n\tfps: () => app.fpsCounter.fps,\n\tobjCount(): number {\n\t\t// TODO: recursive count\n\t\treturn game.root.children.length;\n\t},\n\tstepFrame: updateFrame,\n\tdrawCalls: () => gfx.drawCalls,\n\tclearLog: () => game.logs = [],\n\tlog: (msg) => game.logs.unshift(`[${time().toFixed(2)}].time [${msg}].info`),\n\terror: (msg) => game.logs.unshift(`[${time().toFixed(2)}].time [${msg}].error`),\n\tcurRecording: null,\n\tget paused() {\n\t\treturn app.paused;\n\t},\n\tset paused(v) {\n\t\tapp.paused = v;\n\t\tif (v) {\n\t\t\taudio.ctx.suspend();\n\t\t} else {\n\t\t\taudio.ctx.resume();\n\t\t}\n\t}\n};\n\nfunction dt() {\n\treturn app.dt * debug.timeScale;\n}\n\nfunction mouseWorldPos(): Vec2 {\n\tdeprecateMsg(\"mouseWorldPos()\", \"toWorld(mousePos())\");\n\treturn toWorld(mousePos());\n}\n\ntype Camera = {\n\tpos: Vec2,\n\tscale: Vec2,\n\tangle: number,\n\tshake: number,\n};\n\ntype Layer = {\n\torder: number,\n}\n\ntype TaggedEvent = {\n\ttag: string,\n\tcb: (...args) => void,\n};\n\ntype KeyEvent = {\n\tkey: string,\n\tcb(),\n};\n\ntype MouseInputEvent = {\n\tcb(),\n};\n\ntype LoadEvent = () => void;\ntype NextFrameEvent = () => void;\ntype MouseEvent = () => void;\ntype CharEvent = (ch: string) => void;\n\nfunction layers(list: string[], def?: string) {\n\n\tlist.forEach((name, idx) => {\n\t\tgame.layers[name] = idx + 1;\n\t});\n\n\tif (def) {\n\t\tgame.defLayer = def;\n\t}\n\n}\n\nfunction camPos(...pos): Vec2 {\n\tif (pos.length > 0) {\n\t\tgame.cam.pos = vec2(...pos);\n\t}\n\treturn game.cam.pos.clone();\n}\n\nfunction camScale(...scale): Vec2 {\n\tif (scale.length > 0) {\n\t\tgame.cam.scale = vec2(...scale);\n\t}\n\treturn game.cam.scale.clone();\n}\n\nfunction camRot(angle: number): number {\n\tif (angle !== undefined) {\n\t\tgame.cam.angle = angle;\n\t}\n\treturn game.cam.angle;\n}\n\nfunction shake(intensity: number = 12) {\n\tgame.cam.shake = intensity;\n}\n\nfunction toScreen(p: Vec2): Vec2 {\n\treturn game.cam.transform.multVec2(p);\n}\n\nfunction toWorld(p: Vec2): Vec2 {\n\treturn game.cam.transform.invert().multVec2(p);\n}\n\nfunction make<T>(comps: CompList<T>): GameObj<T> {\n\n\tconst compStates = new Map();\n\tconst customState = {};\n\tlet events = {};\n\n\tconst obj = {\n\n\t\t_id: uid(),\n\t\thidden: false,\n\t\tpaused: false,\n\t\tchildren: [],\n\t\tparent: null,\n\n\t\t// TODO: accept gameobj\n\t\tadd<T2>(comps: CompList<T2>): GameObj<T2> {\n\t\t\tif (this !== game.root) {\n\t\t\t\tthrow new Error(\"Children game object not supported yet\");\n\t\t\t}\n\t\t\tconst obj = make(comps);\n\t\t\tobj.parent = this;\n\t\t\tobj.trigger(\"add\");\n\t\t\tonLoad(() => obj.trigger(\"load\"));\n\t\t\tthis.children.push(obj);\n\t\t\treturn obj;\n\t\t},\n\n\t\t// TODO: use add()\n\t\treadd(obj: GameObj): GameObj {\n\t\t\tthis.remove(obj);\n\t\t\tthis.children.push(obj);\n\t\t\treturn obj;\n\t\t},\n\n\t\tremove(obj: GameObj): void {\n\t\t\tconst idx = this.children.indexOf(obj);\n\t\t\tif (idx !== -1) {\n\t\t\t\tobj.parent = null;\n\t\t\t\tobj.trigger(\"destroy\");\n\t\t\t\tthis.children.splice(idx, 1);\n\t\t\t}\n\t\t},\n\n\t\tremoveAll(tag: Tag) {\n\t\t\tthis.every(tag, (obj) => this.remove(obj));\n\t\t},\n\n\t\tupdate() {\n\t\t\tif (this.paused) return;\n\t\t\tthis.revery((child) => child.update());\n\t\t\tthis.trigger(\"update\");\n\t\t},\n\n\t\tdraw() {\n\t\t\tif (this.hidden) return;\n\t\t\tpushTransform();\n\t\t\tpushTranslate(this.pos);\n\t\t\tpushScale(this.scale);\n\t\t\tpushRotateZ(this.angle);\n\t\t\tthis.every((child) => child.draw());\n\t\t\tthis.trigger(\"draw\");\n\t\t\tpopTransform();\n\t\t},\n\n\t\t// use a comp, or tag\n\t\tuse(comp: Comp | Tag) {\n\n\t\t\tif (!comp) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// tag\n\t\t\tif (typeof comp === \"string\") {\n\t\t\t\treturn this.use({\n\t\t\t\t\tid: comp\n\t\t\t\t});\n\t\t\t}\n\n\t\t\t// clear if overwrite\n\t\t\tif (comp.id) {\n\t\t\t\tthis.unuse(comp.id);\n\t\t\t\tcompStates.set(comp.id, {});\n\t\t\t}\n\n\t\t\t// state source location\n\t\t\tconst state = comp.id ? compStates.get(comp.id) : customState;\n\n\t\t\tstate.cleanups = [];\n\n\t\t\tfor (const k in comp) {\n\n\t\t\t\tif (COMP_DESC.has(k)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// event / custom method\n\t\t\t\tif (typeof comp[k] === \"function\") {\n\t\t\t\t\tconst func = comp[k].bind(this);\n\t\t\t\t\tif (COMP_EVENTS.has(k)) {\n\t\t\t\t\t\tstate.cleanups.push(this.on(k, func));\n\t\t\t\t\t\tstate[k] = func;\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tstate[k] = func;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tstate[k] = comp[k];\n\t\t\t\t}\n\n\t\t\t\tif (this[k] === undefined) {\n\t\t\t\t\t// assign comp fields to game obj\n\t\t\t\t\tObject.defineProperty(this, k, {\n\t\t\t\t\t\tget: () => state[k],\n\t\t\t\t\t\tset: (val) => state[k] = val,\n\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst checkDeps = () => {\n\t\t\t\tif (!comp.require) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tfor (const dep of comp.require) {\n\t\t\t\t\tif (!this.c(dep)) {\n\t\t\t\t\t\tthrow new Error(`comp '${comp.id}' requires comp '${dep}'`);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// check deps or run add event\n\t\t\tif (this.exists()) {\n\t\t\t\tif (comp.add) {\n\t\t\t\t\tcomp.add.call(this);\n\t\t\t\t}\n\t\t\t\tif (comp.load) {\n\t\t\t\t\tonLoad(() => comp.load.call(this));\n\t\t\t\t}\n\t\t\t\tcheckDeps();\n\t\t\t} else {\n\t\t\t\tif (comp.require) {\n\t\t\t\t\tstate.cleanups.push(this.on(\"add\", checkDeps));\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\n\t\tunuse(id: Tag) {\n\t\t\tif (compStates.has(id)) {\n\t\t\t\tconst comp = compStates.get(id);\n\t\t\t\tcomp.cleanups.forEach((f) => f());\n\t\t\t\tfor (const k in comp) {\n\t\t\t\t\tdelete comp[k];\n\t\t\t\t}\n\t\t\t}\n\t\t\tcompStates.delete(id);\n\t\t},\n\n\t\tc(id: Tag): Comp {\n\t\t\treturn compStates.get(id);\n\t\t},\n\n\t\t// TODO: a recursive variant\n\t\tget(t?: Tag | Tag[]): GameObj[] {\n\t\t\treturn this.children\n\t\t\t\t.filter((child) => t ? child.is(t) : true)\n\t\t\t\t.sort((o1, o2) => {\n\t\t\t\t\t// TODO: layers are deprecated\n\t\t\t\t\tconst l1 = game.layers[o1.layer ?? game.defLayer] ?? 0;\n\t\t\t\t\tconst l2 = game.layers[o2.layer ?? game.defLayer] ?? 0;\n\t\t\t\t\t// if on same layer, use \"z\" comp to decide which is on top, if given\n\t\t\t\t\tif (l1 == l2) {\n\t\t\t\t\t\treturn (o1.z ?? 0) - (o2.z ?? 0);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn l1 - l2;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t},\n\n\t\tevery<T>(t: Tag | Tag[] | ((obj: GameObj) => T), f?: (obj: GameObj) => T) {\n\t\t\tif (typeof t === \"function\" && f === undefined) {\n\t\t\t\treturn this.get().forEach((obj) => t(obj));\n\t\t\t} else if (typeof t === \"string\" || Array.isArray(t)) {\n\t\t\t\treturn this.get(t).forEach((obj) => f(obj));\n\t\t\t}\n\t\t},\n\n\t\trevery<T>(t: Tag | Tag[] | ((obj: GameObj) => T), f?: (obj: GameObj) => T) {\n\t\t\tif (typeof t === \"function\" && f === undefined) {\n\t\t\t\treturn this.get().reverse().forEach((obj) => t(obj));\n\t\t\t} else if (typeof t === \"string\" || Array.isArray(t)) {\n\t\t\t\treturn this.get(t).reverse().forEach((obj) => f(obj));\n\t\t\t}\n\t\t},\n\n\t\texists(): boolean {\n\t\t\tif (this.parent === game.root) {\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn this.parent?.exists();\n\t\t\t}\n\t\t},\n\n\t\tis(tag: Tag | Tag[]): boolean {\n\t\t\tif (tag === \"*\") {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\tif (Array.isArray(tag)) {\n\t\t\t\tfor (const t of tag) {\n\t\t\t\t\tif (!this.c(t)) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn this.c(tag) != null;\n\t\t\t}\n\t\t},\n\n\t\ton(ev: string, cb): EventCanceller {\n\t\t\tif (!events[ev]) {\n\t\t\t\tevents[ev] = new IDList();\n\t\t\t}\n\t\t\treturn events[ev].pushd(cb);\n\t\t},\n\n\t\taction(...args): EventCanceller {\n\t\t\tconsole.warn(\"action() is deprecated. Use onUpdate() instead\")\n\t\t\treturn this.onUpdate(...args);\n\t\t},\n\n\t\ttrigger(ev: string, ...args): void {\n\n\t\t\tif (events[ev]) {\n\t\t\t\tevents[ev].forEach((cb) => cb.call(this, ...args));\n\t\t\t}\n\n\t\t\tconst gEvents = game.objEvents[ev];\n\n\t\t\tif (gEvents) {\n\t\t\t\tgEvents.forEach((e) => {\n\t\t\t\t\tif (this.is(e.tag)) {\n\t\t\t\t\t\te.cb(this, ...args);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\n\t\t},\n\n\t\tdestroy() {\n\t\t\tthis.parent?.remove(this);\n\t\t},\n\n\t\tinspect() {\n\t\t\tconst info = {};\n\t\t\tfor (const [tag, comp] of compStates) {\n\t\t\t\tinfo[tag] = comp.inspect ? comp.inspect() : null;\n\t\t\t}\n\t\t\treturn info;\n\t\t},\n\n\t\tonUpdate(cb: () => void): EventCanceller {\n\t\t\treturn this.on(\"update\", cb);\n\t\t},\n\n\t\tonDraw(cb: () => void): EventCanceller {\n\t\t\treturn this.on(\"draw\", cb);\n\t\t},\n\n\t\tonDestroy(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"destroy\", action);\n\t\t},\n\n\t\tclearEvents() {\n\t\t\tevents = {}\n\t\t},\n\n\t};\n\n\tfor (const comp of comps) {\n\t\tobj.use(comp);\n\t}\n\n\treturn obj as unknown as GameObj<T>;\n\n}\n\n// add an event to a tag\nfunction on(event: string, tag: Tag, cb: (obj: GameObj, ...args) => void): EventCanceller {\n\tif (!game.objEvents[event]) {\n\t\tgame.objEvents[event] = new IDList();\n\t}\n\treturn game.objEvents[event].pushd({\n\t\ttag: tag,\n\t\tcb: cb,\n\t});\n}\n\n// add update event to a tag or global update\nfunction onUpdate(tag: Tag | (() => void), cb?: (obj: GameObj) => void): EventCanceller {\n\tif (typeof tag === \"function\" && cb === undefined) {\n\t\treturn game.root.onUpdate(tag);\n\t} else if (typeof tag === \"string\") {\n\t\treturn on(\"update\", tag, cb);\n\t}\n}\n\n// add draw event to a tag or global draw\nfunction onDraw(tag: Tag | (() => void), cb?: (obj: GameObj) => void) {\n\tif (typeof tag === \"function\" && cb === undefined) {\n\t\treturn game.root.onDraw(tag);\n\t} else if (typeof tag === \"string\") {\n\t\treturn on(\"draw\", tag, cb);\n\t}\n}\n\n// add an event that runs with objs with t1 collides with objs with t2\nfunction onCollide(\n\tt1: Tag,\n\tt2: Tag,\n\tf: (a: GameObj, b: GameObj, col?: Collision) => void,\n): EventCanceller {\n\tconst e1 = on(\"collide\", t1, (a, b, col) => b.is(t2) && f(a, b, col));\n\tconst e2 = on(\"collide\", t2, (a, b, col) => b.is(t1) && f(b, a, col));\n\tconst e3 = onUpdate(t1, (o1: GameObj) => {\n\t\tif (!o1.area) {\n\t\t\tthrow new Error(\"onCollide() requires the object to have area() component\");\n\t\t}\n\t\to1._checkCollisions(t2, (o2) => {\n\t\t\tf(o1, o2);\n\t\t});\n\t});\n\treturn () => [e1, e2, e3].forEach((f) => f());\n}\n\n// add an event that runs when objs with tag t is clicked\nfunction onClick(tag: Tag | (() => void), cb?: (obj: GameObj) => void): EventCanceller {\n\tif (typeof tag === \"function\") {\n\t\treturn onMousePress(tag);\n\t} else {\n\t\treturn onUpdate(tag, (o: GameObj) => {\n\t\t\tif (!o.area) throw new Error(\"onClick() requires the object to have area() component\");\n\t\t\tif (o.isClicked()) {\n\t\t\t\tcb(o);\n\t\t\t}\n\t\t});\n\t}\n}\n\n// add an event that runs when objs with tag t is hovered\nfunction onHover(t: string, onHover: (obj: GameObj) => void, onNotHover?: (obj: GameObj) => void): EventCanceller {\n\treturn onUpdate(t, (o: GameObj) => {\n\t\tif (!o.area) throw new Error(\"onHover() requires the object to have area() component\");\n\t\tif (o.isHovering()) {\n\t\t\tonHover(o);\n\t\t} else {\n\t\t\tif (onNotHover) {\n\t\t\t\tonNotHover(o);\n\t\t\t}\n\t\t}\n\t});\n}\n\n// add an event that'd be run after t\nfunction wait(t: number, f?: () => void): Promise<void> {\n\treturn new Promise((resolve) => {\n\t\tgame.timers.push(new Timer(t, () => {\n\t\t\tif (f) f();\n\t\t\tresolve();\n\t\t}))\n\t});\n}\n\n// add an event that's run every t seconds\nfunction loop(t: number, f: () => void): EventCanceller {\n\n\tlet stopped = false;\n\n\tconst newF = () => {\n\t\tif (stopped) {\n\t\t\treturn;\n\t\t}\n\t\tf();\n\t\twait(t, newF);\n\t};\n\n\tnewF();\n\n\treturn () => stopped = true;\n\n}\n\n// input callbacks\nfunction onKeyDown(k: Key | Key[], f: () => void): EventCanceller {\n\tif (Array.isArray(k)) {\n\t\tconst cancellers = k.map((key) => onKeyDown(key, f));\n\t\treturn () => cancellers.forEach((cb) => cb());\n\t} {\n\t\treturn game.on(\"input\", () => isKeyDown(k) && f());\n\t}\n}\n\nfunction onKeyPress(k: Key | Key[] | (() => void), f?: () => void): EventCanceller {\n\tif (Array.isArray(k)) {\n\t\tconst cancellers = k.map((key) => onKeyPress(key, f));\n\t\treturn () => cancellers.forEach((cb) => cb());\n\t} else if (typeof k === \"function\") {\n\t\treturn game.on(\"input\", () => isKeyPressed() && k());\n\t} else {\n\t\treturn game.on(\"input\", () => isKeyPressed(k) && f());\n\t}\n}\n\nfunction onKeyPressRepeat(k: Key | Key[] | (() => void), f?: () => void): EventCanceller {\n\tif (Array.isArray(k)) {\n\t\tconst cancellers = k.map((key) => onKeyPressRepeat(key, f));\n\t\treturn () => cancellers.forEach((cb) => cb());\n\t} else if (typeof k === \"function\") {\n\t\treturn game.on(\"input\", () => isKeyPressed() && k());\n\t} else {\n\t\treturn game.on(\"input\", () => isKeyPressedRepeat(k) && f());\n\t}\n}\n\nfunction onKeyRelease(k: Key | Key[] | (() => void), f?: () => void): EventCanceller {\n\tif (Array.isArray(k)) {\n\t\tconst cancellers = k.map((key) => onKeyRelease(key, f));\n\t\treturn () => cancellers.forEach((cb) => cb());\n\t} else if (typeof k === \"function\") {\n\t\treturn game.on(\"input\", () => isKeyReleased() && k());\n\t} else {\n\t\treturn game.on(\"input\", () => isKeyReleased(k) && f());\n\t}\n}\n\nfunction onMouseDown(\n\tm: MouseButton | ((pos?: Vec2) => void),\n\taction?: (pos?: Vec2) => void\n): EventCanceller {\n\tif (typeof m === \"function\") {\n\t\treturn game.on(\"input\", () => isMouseDown() && m(mousePos()));\n\t} else {\n\t\treturn game.on(\"input\", () => isMouseDown(m) && action(mousePos()));\n\t}\n}\n\nfunction onMousePress(\n\tm: MouseButton | ((pos?: Vec2) => void),\n\taction?: (pos?: Vec2) => void\n): EventCanceller {\n\tif (typeof m === \"function\") {\n\t\treturn game.on(\"input\", () => isMousePressed() && m(mousePos()));\n\t} else {\n\t\treturn game.on(\"input\", () => isMousePressed(m) && action(mousePos()));\n\t}\n}\n\nfunction onMouseRelease(\n\tm: MouseButton | ((pos?: Vec2) => void),\n\taction?: (pos?: Vec2) => void\n): EventCanceller {\n\tif (typeof m === \"function\") {\n\t\treturn game.on(\"input\", () => isMouseReleased() && m(mousePos()));\n\t} else {\n\t\treturn game.on(\"input\", () => isMouseReleased(m) && action(mousePos()));\n\t}\n}\n\nfunction onMouseMove(f: (pos: Vec2, dpos: Vec2) => void): EventCanceller {\n\treturn game.on(\"input\", () => isMouseMoved() && f(mousePos(), mouseDeltaPos()));\n}\n\nfunction onCharInput(f: (ch: string) => void): EventCanceller {\n\treturn game.on(\"input\", () => charInputted().forEach((ch) => f(ch)));\n}\n\nfunction onTouchStart(f: (id: TouchID, pos: Vec2) => void): EventCanceller {\n\treturn game.on(\"onTouchStart\", f);\n}\n\nfunction onTouchMove(f: (id: TouchID, pos: Vec2) => void): EventCanceller {\n\treturn game.on(\"onTouchMove\", f);\n}\n\nfunction onTouchEnd(f: (id: TouchID, pos: Vec2) => void): EventCanceller {\n\treturn game.on(\"onTouchEnd\", f);\n}\n\nfunction enterDebugMode() {\n\n\tonKeyPress(\"f1\", () => {\n\t\tdebug.inspect = !debug.inspect;\n\t});\n\n\tonKeyPress(\"f2\", () => {\n\t\tdebug.clearLog();\n\t});\n\n\tonKeyPress(\"f8\", () => {\n\t\tdebug.paused = !debug.paused;\n\t});\n\n\tonKeyPress(\"f7\", () => {\n\t\tdebug.timeScale = toFixed(clamp(debug.timeScale - 0.2, 0, 2), 1);\n\t});\n\n\tonKeyPress(\"f9\", () => {\n\t\tdebug.timeScale = toFixed(clamp(debug.timeScale + 0.2, 0, 2), 1);\n\t});\n\n\tonKeyPress(\"f10\", () => {\n\t\tdebug.stepFrame();\n\t});\n\n\tonKeyPress(\"f5\", () => {\n\t\tdownloadURL(screenshot(), \"kaboom.png\");\n\t});\n\n\tonKeyPress(\"f6\", () => {\n\t\tif (debug.curRecording) {\n\t\t\tdebug.curRecording.download();\n\t\t\tdebug.curRecording = null;\n\t\t} else {\n\t\t\tdebug.curRecording = record();\n\t\t}\n\t});\n\n}\n\nfunction enterBurpMode() {\n\tonKeyPress(\"b\", burp);\n}\n\n// get / set gravity\nfunction gravity(g?: number): number {\n\tif (g !== undefined) {\n\t\tgame.gravity = g;\n\t}\n\treturn game.gravity;\n}\n\nfunction regCursor(c: Cursor, draw: string | ((mpos: Vec2) => void)) {\n\t// TODO\n}\n\nfunction makeCollision(target: GameObj<any>, dis: Vec2): Collision {\n\treturn {\n\t\ttarget: target,\n\t\tdisplacement: dis,\n\t\tisTop: () => dis.y > 0,\n\t\tisBottom: () => dis.y < 0,\n\t\tisLeft: () => dis.x > 0,\n\t\tisRight: () => dis.x < 0,\n\t};\n}\n\n// TODO: manage global velocity here?\nfunction pos(...args): PosComp {\n\n\treturn {\n\n\t\tid: \"pos\",\n\t\tpos: vec2(...args),\n\n\t\t// TODO: clean\n\t\tmoveBy(...args): Collision | null {\n\n\t\t\tconst p = vec2(...args);\n\t\t\tlet dx = p.x;\n\t\t\tlet dy = p.y;\n\t\t\tlet col = null;\n\n\t\t\tif (this.solid && this.area?.shape === \"rect\") {\n\n\t\t\t\tlet a1 = this.worldArea();\n\n\t\t\t\t// TODO: definitely shouln't iterate through all solid objs\n\t\t\t\tgame.root.every((other) => {\n\n\t\t\t\t\t// make sure we still exist, don't check with self, and only\n\t\t\t\t\t// check with other solid objects\n\t\t\t\t\tif (\n\t\t\t\t\t\t!this.exists()\n\t\t\t\t\t\t|| other === this\n\t\t\t\t\t\t|| !other.solid\n\t\t\t\t\t\t|| other.area?.shape !== \"rect\"\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst a2 = other.worldArea();\n\t\t\t\t\tlet md = minkDiff(a2, a1);\n\n\t\t\t\t\t// if they're already overlapping, push them away first\n\t\t\t\t\tif (testRectPoint(md, vec2(0))) {\n\n\t\t\t\t\t\tlet dist = Math.min(\n\t\t\t\t\t\t\tMath.abs(md.p1.x),\n\t\t\t\t\t\t\tMath.abs(md.p2.x),\n\t\t\t\t\t\t\tMath.abs(md.p1.y),\n\t\t\t\t\t\t\tMath.abs(md.p2.y),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tconst res = (() => {\n\t\t\t\t\t\t\tswitch (dist) {\n\t\t\t\t\t\t\t\tcase Math.abs(md.p1.x): return vec2(dist, 0);\n\t\t\t\t\t\t\t\tcase Math.abs(md.p2.x): return vec2(-dist, 0);\n\t\t\t\t\t\t\t\tcase Math.abs(md.p1.y): return vec2(0, dist);\n\t\t\t\t\t\t\t\tcase Math.abs(md.p2.y): return vec2(0, -dist);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})();\n\n\t\t\t\t\t\tthis.pos = this.pos.sub(res);\n\n\t\t\t\t\t\t// calculate new mink diff\n\t\t\t\t\t\ta1 = this.worldArea();\n\t\t\t\t\t\tmd = minkDiff(a2, a1);\n\n\t\t\t\t\t}\n\n\t\t\t\t\tconst ray = { p1: vec2(0), p2: vec2(dx, dy) };\n\t\t\t\t\tlet minT = 1;\n\t\t\t\t\tconst p1 = md.p1;\n\t\t\t\t\tconst p2 = vec2(md.p1.x, md.p2.y);\n\t\t\t\t\tconst p3 = md.p2;\n\t\t\t\t\tconst p4 = vec2(md.p2.x, md.p1.y);\n\t\t\t\t\tlet numCols = 0;\n\t\t\t\t\tconst lines = {\n\t\t\t\t\t\t\"right\": { p1: p1, p2: p2, },\n\t\t\t\t\t\t\"top\": { p1: p2, p2: p3, },\n\t\t\t\t\t\t\"left\": { p1: p3, p2: p4, },\n\t\t\t\t\t\t\"bottom\": { p1: p4, p2: p1, },\n\t\t\t\t\t};\n\n\t\t\t\t\tfor (const s in lines) {\n\t\t\t\t\t\tconst line = lines[s];\n\t\t\t\t\t\t// if moving along a side, we forgive\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t(dx === 0 && line.p1.x === 0 && line.p2.x === 0)\n\t\t\t\t\t\t\t||\n\t\t\t\t\t\t\t(dy === 0 && line.p1.y === 0 && line.p2.y === 0)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tminT = 1;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst t = testLineLineT(ray, line);\n\t\t\t\t\t\tif (t != null) {\n\t\t\t\t\t\t\tnumCols++;\n\t\t\t\t\t\t\tif (t < minT) {\n\t\t\t\t\t\t\t\tminT = t;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// if moving away, we forgive\n\t\t\t\t\tif (\n\t\t\t\t\t\tminT < 1\n\t\t\t\t\t\t&& !(minT === 0 && numCols == 1 && !testRectPoint(md, vec2(dx, dy)))\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst dis = vec2(-dx * (1 - minT), -dy * (1 - minT));\n\t\t\t\t\t\tdx *= minT;\n\t\t\t\t\t\tdy *= minT;\n\t\t\t\t\t\tcol = makeCollision(other, dis);\n\t\t\t\t\t}\n\n\t\t\t\t});\n\n\t\t\t}\n\n\t\t\tthis.pos.x += dx;\n\t\t\tthis.pos.y += dy;\n\n\t\t\tif (col) {\n\t\t\t\tthis.trigger(\"collide\", col.target, col);\n\t\t\t\tcol.target.trigger(\"collide\", this, makeCollision(this, col.displacement.scale(-1)));\n\t\t\t}\n\n\t\t\treturn col;\n\n\t\t},\n\n\t\t// move with velocity (pixels per second)\n\t\tmove(...args): Collision | null {\n\t\t\treturn this.moveBy(vec2(...args).scale(dt()));\n\t\t},\n\n\t\t// move to a destination, with optional speed\n\t\tmoveTo(...args) {\n\t\t\tif (typeof args[0] === \"number\" && typeof args[1] === \"number\") {\n\t\t\t\treturn this.moveTo(vec2(args[0], args[1]), args[2]);\n\t\t\t}\n\t\t\tconst dest = args[0];\n\t\t\tconst speed = args[1];\n\t\t\tif (speed === undefined) {\n\t\t\t\tthis.pos = vec2(dest);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst diff = dest.sub(this.pos);\n\t\t\tif (diff.len() <= speed * dt()) {\n\t\t\t\tthis.pos = vec2(dest);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis.move(diff.unit().scale(speed));\n\t\t},\n\n\t\t// TODO\n\t\t// get the screen position (transformed by camera)\n\t\tscreenPos(): Vec2 {\n\t\t\tif (this.fixed) {\n\t\t\t\treturn this.pos;\n\t\t\t} else {\n\t\t\t\treturn toScreen(this.pos);\n\t\t\t}\n\t\t},\n\n\t\tinspect() {\n\t\t\treturn `(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`;\n\t\t},\n\n\t};\n\n};\n\n// TODO: allow single number assignment\nfunction scale(...args): ScaleComp {\n\tif (args.length === 0) {\n\t\treturn scale(1);\n\t}\n\treturn {\n\t\tid: \"scale\",\n\t\tscale: vec2(...args),\n\t\tscaleTo(...args) {\n\t\t\tthis.scale = vec2(...args);\n\t\t},\n\t\tinspect() {\n\t\t\tif (typeof this.scale === \"number\") {\n\t\t\t\treturn `${toFixed(this.scale, 2)}`;\n\t\t\t} else {\n\t\t\t\treturn `(${toFixed(this.scale.x, 2)}, ${toFixed(this.scale.y, 2)})`;\n\t\t\t}\n\t\t},\n\t};\n}\n\nfunction rotate(r: number): RotateComp {\n\treturn {\n\t\tid: \"rotate\",\n\t\tangle: r ?? 0,\n\t\tinspect() {\n\t\t\treturn `${Math.round(this.angle)}`;\n\t\t},\n\t};\n}\n\nfunction color(...args): ColorComp {\n\treturn {\n\t\tid: \"color\",\n\t\tcolor: rgb(...args),\n\t\tinspect() {\n\t\t\treturn this.color.str();\n\t\t},\n\t};\n}\n\nfunction toFixed(n: number, f: number) {\n\treturn Number(n.toFixed(f));\n}\n\nfunction opacity(a: number): OpacityComp {\n\treturn {\n\t\tid: \"opacity\",\n\t\topacity: a ?? 1,\n\t\tinspect() {\n\t\t\treturn `${toFixed(this.opacity, 2)}`;\n\t\t},\n\t};\n}\n\nfunction origin(o: Origin | Vec2): OriginComp {\n\tif (!o) {\n\t\tthrow new Error(\"please define an origin\");\n\t}\n\treturn {\n\t\tid: \"origin\",\n\t\torigin: o,\n\t\tinspect() {\n\t\t\tif (typeof this.origin === \"string\") {\n\t\t\t\treturn this.origin;\n\t\t\t} else {\n\t\t\t\treturn this.origin.str();\n\t\t\t}\n\t\t},\n\t};\n}\n\nfunction layer(l: string): LayerComp {\n\treturn {\n\t\tid: \"layer\",\n\t\tlayer: l,\n\t\tinspect() {\n\t\t\treturn this.layer ?? game.defLayer;\n\t\t},\n\t};\n}\n\nfunction z(z: number): ZComp {\n\treturn {\n\t\tid: \"z\",\n\t\tz: z,\n\t\tinspect() {\n\t\t\treturn `${this.z}`;\n\t\t},\n\t};\n}\n\nfunction follow(obj: GameObj, offset?: Vec2): FollowComp {\n\treturn {\n\t\tid: \"follow\",\n\t\trequire: [ \"pos\", ],\n\t\tfollow: {\n\t\t\tobj: obj,\n\t\t\toffset: offset ?? vec2(0),\n\t\t},\n\t\tadd() {\n\t\t\tif (obj.exists()) {\n\t\t\t\tthis.pos = this.follow.obj.pos.add(this.follow.offset);\n\t\t\t}\n\t\t},\n\t\tupdate() {\n\t\t\tif (obj.exists()) {\n\t\t\t\tthis.pos = this.follow.obj.pos.add(this.follow.offset);\n\t\t\t}\n\t\t},\n\t};\n}\n\nfunction move(dir: number | Vec2, speed: number): MoveComp {\n\tconst d = typeof dir === \"number\" ? Vec2.fromAngle(dir) : dir.unit();\n\treturn {\n\t\tid: \"move\",\n\t\trequire: [ \"pos\", ],\n\t\tupdate() {\n\t\t\tthis.move(d.scale(speed));\n\t\t},\n\t};\n}\n\nfunction outview(opt: OutviewCompOpt = {}): OutviewComp {\n\tlet timer = 0;\n\tlet isOut = false;\n\treturn {\n\t\tid: \"outview\",\n\t\trequire: [ \"pos\", \"area\", ],\n\t\tisOutOfView(): boolean {\n\t\t\tconst offset = vec2(opt.offset ?? 0);\n\t\t\tconst screenRect = new Rect(\n\t\t\t\tvec2(0, 0).sub(offset),\n\t\t\t\tvec2(width(), height()).add(offset),\n\t\t\t);\n\t\t\treturn !testAreaRect(this.screenArea(), screenRect);\n\t\t},\n\t\tonExitView(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"exitView\", action);\n\t\t},\n\t\tonEnterView(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"enterView\", action);\n\t\t},\n\t\tupdate() {\n\t\t\tif (this.isOutOfView()) {\n\t\t\t\tif (!isOut) {\n\t\t\t\t\tthis.trigger(\"exitView\");\n\t\t\t\t\tisOut = true;\n\t\t\t\t}\n\t\t\t\tif (opt.delay) {\n\t\t\t\t\ttimer += dt();\n\t\t\t\t\tif (timer < opt.delay) return\n\t\t\t\t}\n\t\t\t\tif (opt.hide) this.hidden = true;\n\t\t\t\tif (opt.pause) this.paused = true;\n\t\t\t\tif (opt.destroy) this.destroy();\n\t\t\t} else {\n\t\t\t\tif (isOut) {\n\t\t\t\t\tthis.trigger(\"enterView\");\n\t\t\t\t\tisOut = false;\n\t\t\t\t}\n\t\t\t\ttimer = 0;\n\t\t\t\tif (opt.hide) this.hidden = false;\n\t\t\t\tif (opt.pause) this.paused = false;\n\t\t\t}\n\t\t},\n\t\tinspect() {\n\t\t\treturn this.isOutOfView();\n\t\t},\n\t};\n}\n\nfunction cleanup(opt: (number | undefined) | CleanupCompOpt = {}): CleanupComp {\n\tif (typeof opt === \"number\") {\n\t\tdeprecateMsg(\"clean(time)\", \"cleanup({ delay: time })\");\n\t\treturn {\n\t\t\t...outview({\n\t\t\t\tdestroy: true,\n\t\t\t\tdelay: opt,\n\t\t\t}),\n\t\t\tid: \"cleanup\",\n\t\t};\n\t}\n\treturn {\n\t\t...outview({\n\t\t\tdestroy: true,\n\t\t\tonExitView: opt.onCleanup,\n\t\t\toffset: opt.offset,\n\t\t\tdelay: opt.delay,\n\t\t}),\n\t\tid: \"cleanup\",\n\t};\n}\n\nfunction area(opt: AreaCompOpt = {}): AreaComp {\n\n\tconst colliding = {};\n\n\treturn {\n\n\t\tid: \"area\",\n\n\t\tadd() {\n\t\t\tif (this.area.cursor) {\n\t\t\t\t// TODO: collect\n\t\t\t\tthis.onHover(() => cursor(this.area.cursor));\n\t\t\t}\n\t\t},\n\n\t\tarea: {\n\t\t\tshape: \"rect\",\n\t\t\toffset: opt.offset ?? vec2(0),\n\t\t\twidth: opt.width,\n\t\t\theight: opt.height,\n\t\t\tscale: opt.scale ?? vec2(1),\n\t\t\tcursor: opt.cursor,\n\t\t},\n\n\t\tisClicked(): boolean {\n\t\t\treturn isMousePressed() && this.isHovering();\n\t\t},\n\n\t\tisHovering() {\n\t\t\tconst mpos = this.fixed ? mousePos() : toWorld(mousePos());\n\t\t\treturn this.hasPoint(mpos);\n\t\t},\n\n\t\tisColliding(other) {\n\t\t\tif (!other.area || !other.exists()) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\tconst a1 = this.worldArea();\n\t\t\tconst a2 = other.worldArea();\n\t\t\treturn testAreaArea(a1, a2);\n\t\t},\n\n\t\tisTouching(other) {\n\t\t\tif (!other.area || !other.exists()) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t// TODO: support other shapes\n\t\t\tconst a1 = this.worldArea();\n\t\t\tconst a2 = other.worldArea();\n\t\t\treturn testRectRect2(a1, a2);\n\t\t},\n\n\t\tonClick(f: () => void): EventCanceller {\n\t\t\treturn this.onUpdate(() => {\n\t\t\t\tif (this.isClicked()) {\n\t\t\t\t\tf();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tonHover(onHover: () => void, onNotHover: () => void): EventCanceller {\n\t\t\treturn this.onUpdate(() => {\n\t\t\t\tif (this.isHovering()) {\n\t\t\t\t\tonHover();\n\t\t\t\t} else {\n\t\t\t\t\tif (onNotHover) {\n\t\t\t\t\t\tonNotHover();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tonCollide(tag: Tag, f: (o: GameObj, col?: Collision) => void): EventCanceller {\n\t\t\tconst e1 = this.onUpdate(() => this._checkCollisions(tag, f));\n\t\t\tconst e2 = this.on(\"collide\", (obj, col) => obj.is(tag) && f(obj, col));\n\t\t\treturn () => [e1, e2].forEach((f) => f());\n\t\t},\n\n\t\tclicks(...args) {\n\t\t\tdeprecateMsg(\"clicks()\", \"onClick()\");\n\t\t\treturn this.onClick(...args);\n\t\t},\n\n\t\thovers(...args) {\n\t\t\tdeprecateMsg(\"hovers()\", \"onHover()\");\n\t\t\treturn this.onHover(...args);\n\t\t},\n\n\t\tcollides(...args) {\n\t\t\tdeprecateMsg(\"collides()\", \"onCollide()\");\n\t\t\treturn this.onCollide(...args);\n\t\t},\n\n\t\thasPoint(pt: Vec2): boolean {\n\t\t\treturn testAreaPoint(this.worldArea(), pt);\n\t\t},\n\n\t\t// push an obj out of another if they're overlapped\n\t\tpushOut(obj: GameObj): Vec2 | null {\n\n\t\t\tif (obj === this) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\t// TODO: support other shapes\n\t\t\tif (obj.area?.shape !== \"rect\") {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst a1 = this.worldArea();\n\t\t\tconst a2 = obj.worldArea();\n\t\t\tconst md = minkDiff(a1, a2);\n\n\t\t\tif (!testRectPoint(md, vec2(0))) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tlet dist = Math.min(\n\t\t\t\tMath.abs(md.p1.x),\n\t\t\t\tMath.abs(md.p2.x),\n\t\t\t\tMath.abs(md.p1.y),\n\t\t\t\tMath.abs(md.p2.y),\n\t\t\t);\n\n\t\t\tconst res = (() => {\n\t\t\t\tswitch (dist) {\n\t\t\t\t\tcase Math.abs(md.p1.x): return vec2(dist, 0);\n\t\t\t\t\tcase Math.abs(md.p2.x): return vec2(-dist, 0);\n\t\t\t\t\tcase Math.abs(md.p1.y): return vec2(0, dist);\n\t\t\t\t\tcase Math.abs(md.p2.y): return vec2(0, -dist);\n\t\t\t\t}\n\t\t\t})();\n\n\t\t\tthis.pos = this.pos.add(res);\n\n\t\t},\n\n\t\t// push object out of other solid objects\n\t\tpushOutAll() {\n\t\t\tgame.root.every(this.pushOut);\n\t\t},\n\n\t\t// @ts-ignore\n\t\t_checkCollisions(tag: Tag) {\n\n\t\t\tgame.root.every(tag, (obj) => {\n\n\t\t\t\tif (this === obj || !this.exists() || colliding[obj._id]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this.isColliding(obj)) {\n\t\t\t\t\tthis.trigger(\"collide\", obj, null);\n\t\t\t\t\tcolliding[obj._id] = obj;\n\t\t\t\t}\n\n\t\t\t});\n\n\t\t\tfor (const id in colliding) {\n\t\t\t\tconst obj = colliding[id];\n\t\t\t\tif (!this.isColliding(obj)) {\n\t\t\t\t\tdelete colliding[id];\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\n\t\t// TODO: doesn't work with nested parent transforms\n\t\t// TODO: cache\n\t\t// TODO: use matrix mult for more accuracy and rotation?\n\t\tworldArea(): Area {\n\n\t\t\tlet w = this.area.width ?? this.width;\n\t\t\tlet h = this.area.height ?? this.height;\n\n\t\t\tif (w == null || h == null) {\n\t\t\t\tthrow new Error(\"failed to get area dimension\");\n\t\t\t}\n\n\t\t\tconst scale = vec2(this.scale ?? 1).scale(this.area.scale);\n\n\t\t\tw *= scale.x;\n\t\t\th *= scale.y;\n\n\t\t\tconst orig = originPt(this.origin || DEF_ORIGIN);\n\t\t\tconst pos = (this.pos ?? vec2(0))\n\t\t\t\t.add(this.area.offset)\n\t\t\t\t.sub(orig.add(1, 1).scale(0.5).scale(w, h));\n\n\t\t\treturn {\n\t\t\t\tshape: \"rect\",\n\t\t\t\tp1: pos,\n\t\t\t\tp2: vec2(pos.x + w, pos.y + h),\n\t\t\t};\n\n\t\t},\n\n\t\tscreenArea(): Area {\n\t\t\tconst area = this.worldArea();\n\t\t\tif (this.fixed) {\n\t\t\t\treturn area;\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tshape: \"rect\",\n\t\t\t\t\tp1: toScreen(area.p1),\n\t\t\t\t\tp2: toScreen(area.p2),\n\t\t\t\t};\n\t\t\t}\n\t\t},\n\n\t};\n\n}\n\n// make the list of common render properties from the \"pos\", \"scale\", \"color\", \"opacity\", \"rotate\", \"origin\", \"outline\", and \"shader\" components of a character\nfunction getRenderProps(obj: GameObj<any>) {\n\treturn {\n\t\tcolor: obj.color,\n\t\topacity: obj.opacity,\n\t\torigin: obj.origin,\n\t\toutline: obj.outline,\n\t\tfixed: obj.fixed,\n\t\tshader: assets.shaders[obj.shader],\n\t\tuniform: obj.uniform,\n\t};\n}\n\ninterface SpriteCurAnim {\n\tname: string,\n\ttimer: number,\n\tloop: boolean,\n\tspeed: number,\n\tpingpong: boolean,\n\tonEnd: () => void,\n}\n\n// TODO: clean\nfunction sprite(id: string | SpriteData, opt: SpriteCompOpt = {}): SpriteComp {\n\n\tlet spr = null;\n\tlet curAnim: SpriteCurAnim | null = null;\n\n\tfunction calcTexScale(tex: GfxTexture, q: Quad, w?: number, h?: number): Vec2 {\n\t\tconst scale = vec2(1, 1);\n\t\tif (w && h) {\n\t\t\tscale.x = w / (tex.width * q.w);\n\t\t\tscale.y = h / (tex.height * q.h);\n\t\t} else if (w) {\n\t\t\tscale.x = w / (tex.width * q.w);\n\t\t\tscale.y = scale.x;\n\t\t} else if (h) {\n\t\t\tscale.y = h / (tex.height * q.h);\n\t\t\tscale.x = scale.y;\n\t\t}\n\t\treturn scale;\n\t}\n\n\treturn {\n\n\t\tid: \"sprite\",\n\t\t// TODO: allow update\n\t\twidth: 0,\n\t\theight: 0,\n\t\tframe: opt.frame || 0,\n\t\tquad: opt.quad || new Quad(0, 0, 1, 1),\n\t\tanimSpeed: opt.animSpeed ?? 1,\n\n\t\tload() {\n\n\t\t\tif (typeof id === \"string\") {\n\t\t\t\tspr = assets.sprites[id];\n\t\t\t} else {\n\t\t\t\tspr = id;\n\t\t\t}\n\n\t\t\tif (!spr) {\n\t\t\t\tthrow new Error(`sprite not found: \"${id}\"`);\n\t\t\t}\n\n\t\t\tlet q = spr.frames[0].clone();\n\n\t\t\tif (opt.quad) {\n\t\t\t\tq = q.scale(opt.quad);\n\t\t\t}\n\n\t\t\tconst scale = calcTexScale(spr.tex, q, opt.width, opt.height);\n\n\t\t\tthis.width = spr.tex.width * q.w * scale.x;\n\t\t\tthis.height = spr.tex.height * q.h * scale.y;\n\n\t\t\tif (opt.anim) {\n\t\t\t\tthis.play(opt.anim);\n\t\t\t}\n\n\t\t},\n\n\t\tdraw() {\n\t\t\tdrawSprite({\n\t\t\t\t...getRenderProps(this),\n\t\t\t\tsprite: spr,\n\t\t\t\tframe: this.frame,\n\t\t\t\tquad: this.quad,\n\t\t\t\tflipX: opt.flipX,\n\t\t\t\tflipY: opt.flipY,\n\t\t\t\ttiled: opt.tiled,\n\t\t\t\twidth: opt.width,\n\t\t\t\theight: opt.height,\n\t\t\t});\n\t\t},\n\n\t\tupdate() {\n\n\t\t\tif (!curAnim) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst anim = spr.anims[curAnim.name];\n\n\t\t\tif (typeof anim === \"number\") {\n\t\t\t\tthis.frame = anim;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (anim.speed === 0) {\n\t\t\t\tthrow new Error(\"sprite anim speed cannot be 0\");\n\t\t\t}\n\n\t\t\tcurAnim.timer += dt() * this.animSpeed;\n\n\t\t\tif (curAnim.timer >= (1 / curAnim.speed)) {\n\t\t\t\tcurAnim.timer = 0;\n\t\t\t\t// TODO: clean up\n\t\t\t\tif (anim.from > anim.to) {\n\t\t\t\t\tthis.frame--;\n\t\t\t\t\tif (this.frame < anim.to) {\n\t\t\t\t\t\tif (curAnim.loop) {\n\t\t\t\t\t\t\tthis.frame = anim.from;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.frame++;\n\t\t\t\t\t\t\tcurAnim.onEnd();\n\t\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.frame++;\n\t\t\t\t\tif (this.frame > anim.to) {\n\t\t\t\t\t\tif (curAnim.loop) {\n\t\t\t\t\t\t\tthis.frame = anim.from;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.frame--;\n\t\t\t\t\t\t\tcurAnim.onEnd();\n\t\t\t\t\t\t\tthis.stop();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t},\n\n\t\t// TODO: this opt should be used instead of the sprite data opt, if given\n\t\tplay(name: string, opt: SpriteAnimPlayOpt = {}) {\n\n\t\t\tif (!spr) {\n\t\t\t\tonLoad(() => {\n\t\t\t\t\tthis.play(name);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst anim = spr.anims[name];\n\n\t\t\tif (anim == null) {\n\t\t\t\tthrow new Error(`anim not found: ${name}`);\n\t\t\t}\n\n\t\t\tif (curAnim) {\n\t\t\t\tthis.stop();\n\t\t\t}\n\n\t\t\tcurAnim = {\n\t\t\t\tname: name,\n\t\t\t\ttimer: 0,\n\t\t\t\tloop: opt.loop ?? anim.loop ?? false,\n\t\t\t\tpingpong: opt.pingpong ?? anim.pingpong ?? false,\n\t\t\t\tspeed: opt.speed ?? anim.speed ?? 10,\n\t\t\t\tonEnd: opt.onEnd ?? (() => {}),\n\t\t\t};\n\n\t\t\tif (typeof anim === \"number\") {\n\t\t\t\tthis.frame = anim;\n\t\t\t} else {\n\t\t\t\tthis.frame = anim.from;\n\t\t\t}\n\n\t\t\t// TODO: \"animPlay\" is deprecated\n\t\t\tthis.trigger(\"animPlay\", name);\n\t\t\tthis.trigger(\"animStart\", name);\n\n\t\t},\n\n\t\tstop() {\n\t\t\tif (!curAnim) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst prevAnim = curAnim.name;\n\t\t\tcurAnim = null;\n\t\t\tthis.trigger(\"animEnd\", prevAnim);\n\t\t},\n\n\t\tnumFrames() {\n\t\t\tif (!spr) {\n\t\t\t\treturn 0;\n\t\t\t}\n\t\t\treturn spr.frames.length;\n\t\t},\n\n\t\tcurAnim() {\n\t\t\treturn curAnim?.name;\n\t\t},\n\n\t\tflipX(b: boolean) {\n\t\t\topt.flipX = b;\n\t\t},\n\n\t\tflipY(b: boolean) {\n\t\t\topt.flipY = b;\n\t\t},\n\n\t\tonAnimEnd(name: string, action: () => void): EventCanceller {\n\t\t\treturn this.on(\"animEnd\", (anim) => {\n\t\t\t\tif (anim === name) {\n\t\t\t\t\taction();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tonAnimStart(name: string, action: () => void): EventCanceller {\n\t\t\treturn this.on(\"animStart\", (anim) => {\n\t\t\t\tif (anim === name) {\n\t\t\t\t\taction();\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tinspect() {\n\t\t\tlet msg = \"\";\n\t\t\tif (typeof id === \"string\") {\n\t\t\t\tmsg += JSON.stringify(id);\n\t\t\t} else {\n\t\t\t\tmsg += \"[blob]\";\n\t\t\t}\n\t\t\treturn msg;\n\t\t},\n\n\t};\n\n}\n\nfunction text(t: string, opt: TextCompOpt = {}): TextComp {\n\n\tfunction update(obj: GameObj<TextComp | any>) {\n\n\t\tconst ftext = formatText({\n\t\t\t...getRenderProps(obj),\n\t\t\ttext: obj.text + \"\",\n\t\t\tsize: obj.textSize,\n\t\t\tfont: obj.font,\n\t\t\twidth: opt.width && obj.width,\n\t\t\tletterSpacing: obj.letterSpacing,\n\t\t\tlineSpacing: obj.lineSpacing,\n\t\t\ttransform: obj.transform,\n\t\t\tstyles: obj.styles,\n\t\t});\n\n\t\tobj.width = ftext.width / (obj.scale?.x || 1);\n\t\tobj.height = ftext.height / (obj.scale?.y || 1);\n\n\t\treturn ftext;\n\n\t};\n\n\treturn {\n\n\t\tid: \"text\",\n\t\ttext: t,\n\t\ttextSize: opt.size,\n\t\tfont: opt.font,\n\t\twidth: opt.width,\n\t\theight: 0,\n\t\tlineSpacing: opt.lineSpacing,\n\t\tletterSpacing: opt.letterSpacing,\n\t\ttransform: opt.transform,\n\t\tstyles: opt.styles,\n\n\t\tload() {\n\t\t\tupdate(this);\n\t\t},\n\n\t\tdraw() {\n\t\t\tdrawFormattedText(update(this));\n\t\t},\n\n\t};\n\n}\n\nfunction rect(w: number, h: number, opt: RectCompOpt = {}): RectComp {\n\treturn {\n\t\tid: \"rect\",\n\t\twidth: w,\n\t\theight: h,\n\t\tradius: opt.radius || 0,\n\t\tdraw() {\n\t\t\tdrawRect({\n\t\t\t\t...getRenderProps(this),\n\t\t\t\twidth: this.width,\n\t\t\t\theight: this.height,\n\t\t\t\tradius: this.radius,\n\t\t\t});\n\t\t},\n\t\tinspect() {\n\t\t\treturn `${Math.ceil(this.width)}, ${Math.ceil(this.height)}`;\n\t\t},\n\t};\n}\n\nfunction uvquad(w: number, h: number): UVQuadComp {\n\treturn {\n\t\tid: \"rect\",\n\t\twidth: w,\n\t\theight: h,\n\t\tdraw() {\n\t\t\tdrawUVQuad({\n\t\t\t\t...getRenderProps(this),\n\t\t\t\twidth: this.width,\n\t\t\t\theight: this.height,\n\t\t\t});\n\t\t},\n\t\tinspect() {\n\t\t\treturn `${Math.ceil(this.width)}, ${Math.ceil(this.height)}`;\n\t\t},\n\t};\n}\n\nfunction circle(radius: number): CircleComp {\n\treturn {\n\t\tid: \"circle\",\n\t\tradius: radius,\n\t\tdraw() {\n\t\t\tdrawCircle({\n\t\t\t\t...getRenderProps(this),\n\t\t\t\tradius: this.radius,\n\t\t\t});\n\t\t},\n\t\tinspect() {\n\t\t\treturn `${Math.ceil(this.radius)}`;\n\t\t},\n\t};\n}\n\nfunction outline(width: number = 1, color: Color = rgb(0, 0, 0)): OutlineComp {\n\treturn {\n\t\tid: \"outline\",\n\t\toutline: {\n\t\t\twidth,\n\t\t\tcolor,\n\t\t},\n\t};\n}\n\nfunction timer(time?: number, action?: () => void): TimerComp {\n\tconst timers: IDList<Timer> = new IDList();\n\tif (time && action) {\n\t\ttimers.pushd(new Timer(time, action));\n\t}\n\treturn {\n\t\tid: \"timer\",\n\t\twait(time: number, action: () => void): EventCanceller {\n\t\t\treturn timers.pushd(new Timer(time, action));\n\t\t},\n\t\tupdate() {\n\t\t\ttimers.forEach((timer, id) => {\n\t\t\t\tif (timer.tick(dt())) {\n\t\t\t\t\ttimers.delete(id);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\t};\n}\n\n// maximum y velocity with body()\nconst DEF_JUMP_FORCE = 640;\nconst MAX_VEL = 65536;\n\n// TODO: land on wall\nfunction body(opt: BodyCompOpt = {}): BodyComp {\n\n\tlet velY = 0;\n\tlet curPlatform: GameObj | null = null;\n\tlet lastPlatformPos = null;\n\tlet canDouble = true;\n\n\treturn {\n\n\t\tid: \"body\",\n\t\trequire: [ \"pos\", \"area\", ],\n\t\tjumpForce: opt.jumpForce ?? DEF_JUMP_FORCE,\n\t\tweight: opt.weight ?? 1,\n\t\tsolid: opt.solid ?? true,\n\n\t\tupdate() {\n\n\t\t\tlet justFall = false;\n\n\t\t\t// check if loses current platform\n\t\t\tif (curPlatform) {\n\n\t\t\t\tconst a1 = this.worldArea();\n\t\t\t\tconst a2 = curPlatform.worldArea();\n\t\t\t\tconst y1 = a1.p2.y;\n\t\t\t\tconst y2 = a2.p1.y;\n\t\t\t\tconst x1 = a1.p1.x;\n\t\t\t\tconst x2 = a1.p2.x;\n\t\t\t\tconst x3 = a2.p1.x;\n\t\t\t\tconst x4 = a2.p2.x;\n\n\t\t\t\tif (\n\t\t\t\t\t!curPlatform.exists()\n\t\t\t\t\t|| y1 !== y2\n\t\t\t\t\t|| x2 < x3\n\t\t\t\t\t|| x1 > x4\n\t\t\t\t) {\n\t\t\t\t\tthis.trigger(\"fall\", curPlatform);\n\t\t\t\t\tcurPlatform = null;\n\t\t\t\t\tlastPlatformPos = null;\n\t\t\t\t\tjustFall = true;\n\t\t\t\t} else {\n\t\t\t\t\tif (lastPlatformPos && curPlatform.pos) {\n\t\t\t\t\t\t// TODO: moveBy?\n\t\t\t\t\t\t// sticky platform\n\t\t\t\t\t\tthis.pos = this.pos.add(curPlatform.pos.sub(lastPlatformPos));\n\t\t\t\t\t\tlastPlatformPos = curPlatform.pos.clone();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!curPlatform) {\n\n\t\t\t\tconst col = this.move(0, velY);\n\n\t\t\t\t// check if grounded to a new platform\n\t\t\t\tif (col) {\n\t\t\t\t\tif (col.isBottom()) {\n\t\t\t\t\t\tcurPlatform = col.target;\n\t\t\t\t\t\tconst oy = velY;\n\t\t\t\t\t\tvelY = 0;\n\t\t\t\t\t\tif (curPlatform.pos) {\n\t\t\t\t\t\t\tlastPlatformPos = curPlatform.pos.clone();\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (!justFall) {\n\t\t\t\t\t\t\tthis.trigger(\"ground\", curPlatform);\n\t\t\t\t\t\t\tcanDouble = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (col.isTop()) {\n\t\t\t\t\t\tvelY = 0;\n\t\t\t\t\t\tthis.trigger(\"headbutt\", col.target);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tvelY += gravity() * this.weight * dt();\n\t\t\t\tvelY = Math.min(velY, opt.maxVel ?? MAX_VEL);\n\n\t\t\t}\n\n\t\t},\n\n\t\tcurPlatform(): GameObj | null {\n\t\t\treturn curPlatform;\n\t\t},\n\n\t\tisGrounded() {\n\t\t\treturn curPlatform !== null;\n\t\t},\n\n\t\tgrounded(): boolean {\n\t\t\tdeprecateMsg(\"grounded()\", \"isGrounded()\");\n\t\t\treturn this.isGrounded();\n\t\t},\n\n\t\tisFalling(): boolean {\n\t\t\treturn velY > 0;\n\t\t},\n\n\t\tfalling(): boolean {\n\t\t\tdeprecateMsg(\"falling()\", \"isFalling()\");\n\t\t\treturn this.isFalling();\n\t\t},\n\n\t\tjump(force: number) {\n\t\t\tcurPlatform = null;\n\t\t\tlastPlatformPos = null;\n\t\t\tvelY = -force || -this.jumpForce;\n\t\t},\n\n\t\tdoubleJump(force: number) {\n\t\t\tif (this.isGrounded()) {\n\t\t\t\tthis.jump(force);\n\t\t\t} else if (canDouble) {\n\t\t\t\tcanDouble = false;\n\t\t\t\tthis.jump(force);\n\t\t\t\tthis.trigger(\"doubleJump\");\n\t\t\t}\n\t\t},\n\n\t\tonGround(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"ground\", action);\n\t\t},\n\n\t\tonFall(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"fall\", action);\n\t\t},\n\n\t\tonHeadbutt(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"headbutt\", action);\n\t\t},\n\n\t\tonDoubleJump(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"doubleJump\", action);\n\t\t},\n\n\t};\n\n}\n\nfunction shader(id: string, uniform: Uniform = {}): ShaderComp {\n\tconst shader = assets.shaders[id];\n\treturn {\n\t\tid: \"shader\",\n\t\tshader: id,\n\t\tuniform: uniform,\n\t};\n}\n\nfunction solid(): SolidComp {\n\treturn {\n\t\tid: \"solid\",\n\t\trequire: [ \"area\", ],\n\t\tsolid: true,\n\t};\n}\n\nfunction fixed(): FixedComp {\n\treturn {\n\t\tid: \"fixed\",\n\t\tfixed: true,\n\t};\n}\n\nfunction stay(): StayComp {\n\treturn {\n\t\tid: \"stay\",\n\t\tstay: true,\n\t};\n}\n\nfunction health(hp: number): HealthComp {\n\tif (hp == null) {\n\t\tthrow new Error(\"health() requires the initial amount of hp\");\n\t}\n\treturn {\n\t\tid: \"health\",\n\t\thurt(n: number = 1) {\n\t\t\tthis.setHP(hp - n);\n\t\t\tthis.trigger(\"hurt\");\n\t\t},\n\t\theal(n: number = 1) {\n\t\t\tthis.setHP(hp + n);\n\t\t\tthis.trigger(\"heal\");\n\t\t},\n\t\thp(): number {\n\t\t\treturn hp;\n\t\t},\n\t\tsetHP(n: number) {\n\t\t\thp = n;\n\t\t\tif (hp <= 0) {\n\t\t\t\tthis.trigger(\"death\");\n\t\t\t}\n\t\t},\n\t\tonHurt(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"hurt\", action);\n\t\t},\n\t\tonHeal(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"heal\", action);\n\t\t},\n\t\tonDeath(action: () => void): EventCanceller {\n\t\t\treturn this.on(\"death\", action);\n\t\t},\n\t\tinspect() {\n\t\t\treturn `${hp}`;\n\t\t},\n\t};\n}\n\nfunction lifespan(time: number, opt: LifespanCompOpt = {}): LifespanComp {\n\tif (time == null) {\n\t\tthrow new Error(\"lifespan() requires time\");\n\t}\n\tlet timer = 0;\n\tconst fade = opt.fade ?? 0;\n\tconst startFade = Math.max((time - fade), 0);\n\treturn {\n\t\tid: \"lifespan\",\n\t\tupdate() {\n\t\t\ttimer += dt();\n\t\t\t// TODO: don't assume 1 as start opacity\n\t\t\tif (timer >= startFade) {\n\t\t\t\tthis.opacity = map(timer, startFade, time, 1, 0);\n\t\t\t}\n\t\t\tif (timer >= time) {\n\t\t\t\tthis.destroy();\n\t\t\t}\n\t\t},\n\t};\n}\n\nfunction state(\n\tinitState: string,\n\tstateList?: string[],\n\ttransitions?: Record<string, string | string[]>,\n): StateComp {\n\n\tif (!initState) {\n\t\tthrow new Error(\"state() requires an initial state\");\n\t}\n\n\tconst events = {};\n\n\tfunction initStateHook(state: string) {\n\t\tif (!events[state]) {\n\t\t\tevents[state] = {\n\t\t\t\tenter: [],\n\t\t\t\tleave: [],\n\t\t\t\tupdate: [],\n\t\t\t\tdraw: [],\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction on(event, state, action) {\n\t\tinitStateHook(state);\n\t\tevents[state][event].push(action);\n\t}\n\n\tfunction trigger(event, state, ...args) {\n\t\tinitStateHook(state);\n\t\tevents[state][event].forEach((action) => action(...args));\n\t}\n\n\treturn {\n\n\t\tid: \"state\",\n\t\tstate: initState,\n\n\t\tenterState(state: string, ...args) {\n\n\t\t\tif (stateList && !stateList.includes(state)) {\n\t\t\t\tthrow new Error(`State not found: ${state}`);\n\t\t\t}\n\n\t\t\tconst oldState = this.state;\n\n\t\t\tif (transitions) {\n\n\t\t\t\t// check if the transition is legal, if transition graph is defined\n\t\t\t\tif (!transitions?.[oldState]) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst available = typeof transitions[oldState] === \"string\"\n\t\t\t\t\t? [transitions[oldState]]\n\t\t\t\t\t: transitions[oldState] as string[];\n\n\t\t\t\tif (!available.includes(state)) {\n\t\t\t\t\tthrow new Error(`Cannot transition state from \"${oldState}\" to \"${state}\". Available transitions: ${available.map((s) => `\"${s}\"`).join(\", \")}`);\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttrigger(\"leave\", oldState, ...args);\n\t\t\tthis.state = state;\n\t\t\ttrigger(\"enter\", state, ...args);\n\t\t\ttrigger(\"enter\", `${oldState} -> ${state}`, ...args);\n\n\t\t},\n\n\t\tonStateTransition(from: string, to: string, action: () => void) {\n\t\t\ton(\"enter\", `${from} -> ${to}`, action);\n\t\t},\n\n\t\tonStateEnter(state: string, action: () => void) {\n\t\t\ton(\"enter\", state, action);\n\t\t},\n\n\t\tonStateUpdate(state: string, action: () => void) {\n\t\t\ton(\"update\", state, action);\n\t\t},\n\n\t\tonStateDraw(state: string, action: () => void) {\n\t\t\ton(\"draw\", state, action);\n\t\t},\n\n\t\tonStateLeave(state: string, action: () => void) {\n\t\t\ton(\"leave\", state, action);\n\t\t},\n\n\t\tupdate() {\n\t\t\ttrigger(\"update\", this.state);\n\t\t},\n\n\t\tdraw() {\n\t\t\ttrigger(\"draw\", this.state);\n\t\t},\n\n\t\tinspect() {\n\t\t\treturn this.state;\n\t\t},\n\n\t};\n\n}\n\nfunction onLoad(cb: () => void): void {\n\tif (app.loaded) {\n\t\tcb();\n\t} else {\n\t\tgame.on(\"load\", cb);\n\t}\n}\n\nfunction scene(id: SceneID, def: SceneDef) {\n\tgame.scenes[id] = def;\n}\n\nfunction go(id: SceneID, ...args) {\n\n\tif (!game.scenes[id]) {\n\t\tthrow new Error(`scene not found: ${id}`);\n\t}\n\n\tconst cancel = game.on(\"updateStart\", () => {\n\n\t\tgame.events = {};\n\n\t\tgame.objEvents = {\n\t\t\tadd: new IDList(),\n\t\t\tupdate: new IDList(),\n\t\t\tdraw: new IDList(),\n\t\t\tdestroy: new IDList(),\n\t\t};\n\n\t\tgame.root.every((obj) => {\n\t\t\tif (!obj.is(\"stay\")) {\n\t\t\t\tgame.root.remove(obj);\n\t\t\t}\n\t\t})\n\n\t\tgame.root.clearEvents();\n\t\tgame.timers = new IDList();\n\n\t\t// cam\n\t\tgame.cam = {\n\t\t\tpos: center(),\n\t\t\tscale: vec2(1),\n\t\t\tangle: 0,\n\t\t\tshake: 0,\n\t\t\ttransform: new Mat4(),\n\t\t};\n\n\t\tgame.layers = {};\n\t\tgame.defLayer = null;\n\t\tgame.gravity = DEF_GRAVITY;\n\n\t\tgame.scenes[id](...args);\n\n\t\tif (gopt.debug !== false) {\n\t\t\tenterDebugMode();\n\t\t}\n\n\t\tif (gopt.burp) {\n\t\t\tenterBurpMode();\n\t\t}\n\n\t\tcancel();\n\n\t});\n\n}\n\nfunction getData<T>(key: string, def?: T): T {\n\ttry {\n\t\treturn JSON.parse(window.localStorage[key]);\n\t} catch {\n\t\tif (def) {\n\t\t\tsetData(key, def);\n\t\t\treturn def;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n}\n\nfunction setData(key: string, data: any) {\n\twindow.localStorage[key] = JSON.stringify(data);\n}\n\nfunction plug<T>(plugin: KaboomPlugin<T>): MergeObj<T> & KaboomCtx {\n\tconst funcs = plugin(ctx);\n\tfor (const k in funcs) {\n\t\t// @ts-ignore\n\t\tctx[k] = funcs[k];\n\t\tif (gopt.global !== false) {\n\t\t\t// @ts-ignore\n\t\t\twindow[k] = funcs[k];\n\t\t}\n\t}\n\treturn ctx as unknown as MergeObj<T> & KaboomCtx;\n}\n\nfunction center(): Vec2 {\n\treturn vec2(width() / 2, height() / 2);\n}\n\nfunction grid(level: Level, p: Vec2) {\n\n\treturn {\n\n\t\tid: \"grid\",\n\t\tgridPos: p.clone(),\n\n\t\tsetGridPos(...args) {\n\t\t\tconst p = vec2(...args);\n\t\t\tthis.gridPos = p.clone();\n\t\t\tthis.pos = vec2(\n\t\t\t\tlevel.offset().x + this.gridPos.x * level.gridWidth(),\n\t\t\t\tlevel.offset().y + this.gridPos.y * level.gridHeight()\n\t\t\t);\n\t\t},\n\n\t\tmoveLeft() {\n\t\t\tthis.setGridPos(this.gridPos.add(vec2(-1, 0)));\n\t\t},\n\n\t\tmoveRight() {\n\t\t\tthis.setGridPos(this.gridPos.add(vec2(1, 0)));\n\t\t},\n\n\t\tmoveUp() {\n\t\t\tthis.setGridPos(this.gridPos.add(vec2(0, -1)));\n\t\t},\n\n\t\tmoveDown() {\n\t\t\tthis.setGridPos(this.gridPos.add(vec2(0, 1)));\n\t\t},\n\n\t};\n\n}\n\nfunction addLevel(map: string[], opt: LevelOpt): Level {\n\n\tif (!opt.width || !opt.height) {\n\t\tthrow new Error(\"Must provide level grid width & height.\");\n\t}\n\n\tconst objs: GameObj[] = [];\n\tconst offset = vec2(opt.pos || vec2(0));\n\tlet longRow = 0;\n\n\tconst level = {\n\n\t\toffset() {\n\t\t\treturn offset.clone();\n\t\t},\n\n\t\tgridWidth() {\n\t\t\treturn opt.width;\n\t\t},\n\n\t\tgridHeight() {\n\t\t\treturn opt.height;\n\t\t},\n\n\t\tgetPos(...args): Vec2 {\n\t\t\tconst p = vec2(...args);\n\t\t\treturn vec2(\n\t\t\t\toffset.x + p.x * opt.width,\n\t\t\t\toffset.y + p.y * opt.height\n\t\t\t);\n\t\t},\n\n\t\tspawn(sym: string, ...args): GameObj {\n\n\t\t\tconst p = vec2(...args);\n\n\t\t\tconst comps = (() => {\n\t\t\t\tif (opt[sym]) {\n\t\t\t\t\tif (typeof opt[sym] !== \"function\") {\n\t\t\t\t\t\tthrow new Error(\"level symbol def must be a function returning a component list\");\n\t\t\t\t\t}\n\t\t\t\t\treturn opt[sym](p);\n\t\t\t\t} else if (opt.any) {\n\t\t\t\t\treturn opt.any(sym, p);\n\t\t\t\t}\n\t\t\t})();\n\n\t\t\tif (!comps) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst posComp = vec2(\n\t\t\t\toffset.x + p.x * opt.width,\n\t\t\t\toffset.y + p.y * opt.height\n\t\t\t);\n\n\t\t\tfor (const comp of comps) {\n\t\t\t\tif (comp.id === \"pos\") {\n\t\t\t\t\tposComp.x += comp.pos.x;\n\t\t\t\t\tposComp.y += comp.pos.y;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tcomps.push(pos(posComp));\n\t\t\tcomps.push(grid(this, p));\n\n\t\t\tconst obj = game.root.add(comps);\n\n\t\t\tobjs.push(obj);\n\n\t\t\treturn obj;\n\n\t\t},\n\n\t\twidth() {\n\t\t\treturn longRow * opt.width;\n\t\t},\n\n\t\theight() {\n\t\t\treturn map.length * opt.height;\n\t\t},\n\n\t\tdestroy() {\n\t\t\tfor (const obj of objs) {\n\t\t\t\tobj.destroy();\n\t\t\t}\n\t\t},\n\n\t};\n\n\tmap.forEach((row, i) => {\n\n\t\tconst syms = row.split(\"\");\n\n\t\tlongRow = Math.max(syms.length, longRow);\n\n\t\tsyms.forEach((sym, j) => {\n\t\t\tlevel.spawn(sym, vec2(j, i));\n\t\t});\n\n\t});\n\n\treturn level;\n\n}\n\nfunction record(frameRate?): Recording {\n\n\tconst stream = app.canvas.captureStream(frameRate);\n\tconst audioDest = audio.ctx.createMediaStreamDestination();\n\n\taudio.masterNode.connect(audioDest)\n\n\tconst audioStream = audioDest.stream;\n\tconst [firstAudioTrack] = audioStream.getAudioTracks();\n\n\t// TODO: Enabling audio results in empty video if no audio received\n\t// stream.addTrack(firstAudioTrack);\n\n\tconst recorder = new MediaRecorder(stream);\n\tconst chunks = [];\n\n\trecorder.ondataavailable = (e) => {\n\t\tif (e.data.size > 0) {\n\t\t\tchunks.push(e.data);\n\t\t}\n\t};\n\n\trecorder.onerror = (e) => {\n\t\taudio.masterNode.disconnect(audioDest)\n\t\tstream.getTracks().forEach(t => t.stop());\n\t};\n\n\trecorder.start();\n\n\treturn {\n\n\t\tresume() {\n\t\t\trecorder.resume();\n\t\t},\n\n\t\tpause() {\n\t\t\trecorder.pause();\n\t\t},\n\n\t\tdownload(filename = \"kaboom.mp4\") {\n\n\t\t\trecorder.onstop = () => {\n\t\t\t\tdownloadBlob(new Blob(chunks, {\n\t\t\t\t\ttype: \"video/mp4\",\n\t\t\t\t}), filename);\n\t\t\t}\n\n\t\t\trecorder.stop();\n\t\t\t// cleanup\n\t\t\taudio.masterNode.disconnect(audioDest)\n\t\t\tstream.getTracks().forEach(t => t.stop());\n\n\t\t},\n\n\t};\n\n}\n\nfunction focus() {\n\tdeprecateMsg(\"focus()\", \"canvas.focus()\");\n\tapp.canvas.focus();\n}\n\nfunction isFocused(): boolean {\n\treturn document.activeElement === app.canvas;\n}\n\ninterface BoomOpt {\n\t/**\n\t * Animation speed.\n\t */\n\tspeed?: number,\n\t/**\n\t * Scale.\n\t */\n\tscale?: number,\n\t/**\n\t * Additional ka components.\n\t */\n\tkaComps?: () => CompList<any>,\n\t/**\n\t * Additional boom components.\n\t */\n\tboomComps?: () => CompList<any>,\n}\n\n// aliases for root game obj operations\nfunction add<T>(comps: CompList<T>): GameObj<T> {\n\treturn game.root.add(comps);\n}\n\nfunction readd<T>(obj: GameObj<T>): GameObj<T> {\n\treturn game.root.readd(obj);\n}\n\nfunction destroy(obj: GameObj) {\n\treturn game.root.remove(obj);\n}\n\nfunction destroyAll(tag: Tag) {\n\treturn game.root.removeAll(tag);\n}\n\nfunction get(...args) {\n\treturn game.root.get(...args);\n}\n\nfunction every(...args) {\n\t// @ts-ignore\n\treturn game.root.every(...args);\n}\n\nfunction revery(...args) {\n\t// @ts-ignore\n\treturn game.root.revery(...args);\n}\n\ninterface ExplodeComp extends Comp {\n}\n\nfunction explode(speed: number = 2, size: number = 1): ExplodeComp {\n\tlet time = 0;\n\treturn {\n\t\tid: \"explode\",\n\t\trequire: [ \"scale\", ],\n\t\tupdate() {\n\t\t\tconst s = Math.sin(time * speed) * size;\n\t\t\tif (s < 0) {\n\t\t\t\tdestroy(this);\n\t\t\t}\n\t\t\tthis.scale = vec2(s);\n\t\t\ttime += dt();\n\t\t},\n\t};\n}\n\nlet kaSprite = null;\nlet boomSprite = null;\n\nloadSprite(null, kaSrc).then((spr) => kaSprite = spr);\nloadSprite(null, boomSrc).then((spr) => boomSprite = spr);\n\n// TODO: use children obj\nfunction addKaboom(p: Vec2, opt: BoomOpt = {}): Kaboom {\n\n\tconst speed = (opt.speed || 1) * 5;\n\tconst s = opt.scale || 1;\n\n\tconst boom = add([\n\t\tpos(p),\n\t\tsprite(boomSprite),\n\t\tscale(0),\n\t\tstay(),\n\t\torigin(\"center\"),\n\t\texplode(speed, s),\n\t\t...(opt.boomComps ?? (() => []))(),\n\t]);\n\n\tconst ka = add([\n\t\tpos(p),\n\t\tsprite(kaSprite),\n\t\tscale(0),\n\t\tstay(),\n\t\torigin(\"center\"),\n\t\ttimer(0.4 / speed, () => ka.use(explode(speed, s))),\n\t\t...(opt.kaComps ?? (() => []))(),\n\t]);\n\n\treturn {\n\t\tdestroy() {\n\t\t\tdestroy(ka);\n\t\t\tdestroy(boom);\n\t\t},\n\t};\n\n}\n\nfunction frames() {\n\treturn app.numFrames;\n}\n\nfunction updateFrame() {\n\n\tgame.trigger(\"updateStart\");\n\n\t// update timers\n\tgame.timers.forEach((t, id) => {\n\t\tt.time -= dt();\n\t\tif (t.time <= 0) {\n\t\t\t// TODO: some timer action causes crash on FF when dt is really high, not sure why\n\t\t\tt.action();\n\t\t\tgame.timers.delete(id);\n\t\t}\n\t});\n\n\t// update every obj\n\tgame.root.update();\n\n}\n\nfunction drawFrame() {\n\n\t// calculate camera matrix\n\tconst cam = game.cam;\n\tconst shake = Vec2.fromAngle(rand(0, 360)).scale(cam.shake);\n\n\tcam.shake = lerp(cam.shake, 0, 5 * dt());\n\tcam.transform = new Mat4()\n\t\t.translate(center())\n\t\t.scale(cam.scale)\n\t\t.rotateZ(cam.angle)\n\t\t.translate(cam.pos.scale(-1).add(shake))\n\t\t;\n\n\tgame.root.draw();\n\n}\n\nfunction drawLoadScreen() {\n\n\t// if assets are not fully loaded, draw a progress bar\n\tconst progress = loadProgress();\n\n\tif (progress === 1) {\n\t\tapp.loaded = true;\n\t\tgame.trigger(\"load\");\n\t} else {\n\n\t\tconst w = width() / 2;\n\t\tconst h = 24 / app.scale;\n\t\tconst pos = vec2(width() / 2, height() / 2).sub(vec2(w / 2, h / 2));\n\n\t\tdrawRect({\n\t\t\tpos: vec2(0),\n\t\t\twidth: width(),\n\t\t\theight: height(),\n\t\t\tcolor: rgb(0, 0, 0),\n\t\t});\n\n\t\tdrawRect({\n\t\t\tpos: pos,\n\t\t\twidth: w,\n\t\t\theight: h,\n\t\t\tfill: false,\n\t\t\toutline: {\n\t\t\t\twidth: 4 / app.scale,\n\t\t\t},\n\t\t});\n\n\t\tdrawRect({\n\t\t\tpos: pos,\n\t\t\twidth: w * progress,\n\t\t\theight: h,\n\t\t});\n\n\t}\n\n}\n\nfunction drawInspectText(pos, txt) {\n\n\tconst pad = vec2(8);\n\n\tpushTransform();\n\tpushTranslate(pos);\n\tpushScale(1 / app.scale);\n\n\tconst ftxt = formatText({\n\t\ttext: txt,\n\t\tfont: assets.fonts[DBG_FONT],\n\t\tsize: 16,\n\t\tpos: pad,\n\t\tcolor: rgb(255, 255, 255),\n\t\tfixed: true,\n\t});\n\n\tconst bw = ftxt.width + pad.x * 2;\n\tconst bh = ftxt.height + pad.x * 2;\n\n\tif (pos.x + bw / app.scale >= width()) {\n\t\tpushTranslate(vec2(-bw, 0));\n\t}\n\n\tif (pos.y + bh / app.scale >= height()) {\n\t\tpushTranslate(vec2(0, -bh));\n\t}\n\n\tdrawRect({\n\t\twidth: bw,\n\t\theight: bh,\n\t\tcolor: rgb(0, 0, 0),\n\t\tradius: 4,\n\t\topacity: 0.8,\n\t\tfixed: true,\n\t});\n\n\tdrawFormattedText(ftxt);\n\tpopTransform();\n\n}\n\nfunction drawDebug() {\n\n\tif (debug.inspect) {\n\n\t\tlet inspecting = null;\n\t\tconst lcolor = Color.fromArray(gopt.inspectColor ?? [0, 0, 255]);\n\n\t\t// draw area outline\n\t\tgame.root.every((obj) => {\n\n\t\t\tif (!obj.area) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (obj.hidden) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!inspecting) {\n\t\t\t\tif (obj.isHovering()) {\n\t\t\t\t\tinspecting = obj;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst lwidth = (inspecting === obj ? 8 : 4);\n\t\t\tconst a = obj.worldArea();\n\t\t\tconst w = a.p2.x - a.p1.x;\n\t\t\tconst h = a.p2.y - a.p1.y;\n\n\t\t\tdrawRect({\n\t\t\t\tpos: a.p1,\n\t\t\t\twidth: w,\n\t\t\t\theight: h,\n\t\t\t\toutline: {\n\t\t\t\t\twidth: lwidth,\n\t\t\t\t\tcolor: lcolor,\n\t\t\t\t},\n\t\t\t\tfill: false,\n\t\t\t\tfixed: obj.fixed,\n\t\t\t});\n\n\t\t});\n\n\t\tif (inspecting) {\n\n\t\t\tconst lines = [];\n\t\t\tconst data = inspecting.inspect();\n\n\t\t\tfor (const tag in data) {\n\t\t\t\tif (data[tag]) {\n\t\t\t\t\tlines.push(`${tag}: ${data[tag]}`);\n\t\t\t\t} else {\n\t\t\t\t\tlines.push(`${tag}`);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdrawInspectText(mousePos(), lines.join(\"\\n\"));\n\n\t\t}\n\n\t\tdrawInspectText(vec2(8 / app.scale), `FPS: ${debug.fps()}`);\n\n\t}\n\n\tif (debug.paused) {\n\n\t\t// top right corner\n\t\tpushTransform();\n\t\tpushTranslate(width(), 0);\n\t\tpushScale(1 / app.scale);\n\t\tpushTranslate(-8, 8);\n\n\t\tconst size = 32;\n\n\t\t// bg\n\t\tdrawRect({\n\t\t\twidth: size,\n\t\t\theight: size,\n\t\t\torigin: \"topright\",\n\t\t\tcolor: rgb(0, 0, 0),\n\t\t\topacity: 0.8,\n\t\t\tradius: 4,\n\t\t\tfixed: true,\n\t\t});\n\n\t\t// pause icon\n\t\tfor (let i = 1; i <= 2; i++) {\n\t\t\tdrawRect({\n\t\t\t\twidth: 4,\n\t\t\t\theight: size * 0.6,\n\t\t\t\torigin: \"center\",\n\t\t\t\tpos: vec2(-size / 3 * i, size * 0.5),\n\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\tradius: 2,\n\t\t\t\tfixed: true,\n\t\t\t});\n\t\t}\n\n\t\tpopTransform();\n\n\t}\n\n\tif (debug.timeScale !== 1) {\n\n\t\t// bottom right corner\n\t\tpushTransform();\n\t\tpushTranslate(width(), height());\n\t\tpushScale(1 / app.scale);\n\t\tpushTranslate(-8, -8);\n\n\t\tconst pad = 8;\n\n\t\t// format text first to get text size\n\t\tconst ftxt = formatText({\n\t\t\ttext: debug.timeScale.toFixed(1),\n\t\t\tfont: assets.fonts[DBG_FONT],\n\t\t\tsize: 16,\n\t\t\tcolor: rgb(255, 255, 255),\n\t\t\tpos: vec2(-pad),\n\t\t\torigin: \"botright\",\n\t\t\tfixed: true,\n\t\t});\n\n\t\t// bg\n\t\tdrawRect({\n\t\t\twidth: ftxt.width + pad * 2 + pad * 4,\n\t\t\theight: ftxt.height + pad * 2,\n\t\t\torigin: \"botright\",\n\t\t\tcolor: rgb(0, 0, 0),\n\t\t\topacity: 0.8,\n\t\t\tradius: 4,\n\t\t\tfixed: true,\n\t\t});\n\n\t\t// fast forward / slow down icon\n\t\tfor (let i = 0; i < 2; i++) {\n\t\t\tconst flipped = debug.timeScale < 1;\n\t\t\tdrawTriangle({\n\t\t\t\tp1: vec2(-ftxt.width - pad * (flipped ? 2 : 3.5), -pad),\n\t\t\t\tp2: vec2(-ftxt.width - pad * (flipped ? 2 : 3.5), -pad - ftxt.height),\n\t\t\t\tp3: vec2(-ftxt.width - pad * (flipped ? 3.5 : 2), -pad - ftxt.height / 2),\n\t\t\t\tpos: vec2(-i * pad * 1 + (flipped ? -pad * 0.5 : 0), 0),\n\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\tfixed: true,\n\t\t\t});\n\t\t}\n\n\t\t// text\n\t\tdrawFormattedText(ftxt);\n\n\t\tpopTransform();\n\n\t}\n\n\tif (debug.curRecording) {\n\n\t\tpushTransform();\n\t\tpushTranslate(0, height());\n\t\tpushScale(1 / app.scale);\n\t\tpushTranslate(24, -24);\n\n\t\tdrawCircle({\n\t\t\tradius: 12,\n\t\t\tcolor: rgb(255, 0, 0),\n\t\t\topacity: wave(0, 1, time() * 4),\n\t\t\tfixed: true,\n\t\t});\n\n\t\tpopTransform();\n\n\t}\n\n\tif (debug.showLog && game.logs.length > 0) {\n\n\t\tpushTransform();\n\t\tpushTranslate(0, height());\n\t\tpushScale(1 / app.scale);\n\t\tpushTranslate(8, -8);\n\n\t\tconst pad = 8;\n\t\tconst max = gopt.logMax ?? 1;\n\n\t\tif (game.logs.length > max) {\n\t\t\tgame.logs = game.logs.slice(0, max);\n\t\t}\n\n\t\tconst ftext = formatText({\n\t\t\ttext: game.logs.join(\"\\n\"),\n\t\t\tfont: assets.fonts[DBG_FONT],\n\t\t\tpos: vec2(pad, -pad),\n\t\t\torigin: \"botleft\",\n\t\t\tsize: 16,\n\t\t\twidth: width() * app.scale * 0.6,\n\t\t\tlineSpacing: pad / 2,\n\t\t\tfixed: true,\n\t\t\tstyles: {\n\t\t\t\t\"time\": { color: rgb(127, 127, 127) },\n\t\t\t\t\"info\": { color: rgb(255, 255, 255) },\n\t\t\t\t\"error\": { color: rgb(255, 0, 127) },\n\t\t\t},\n\t\t});\n\n\t\tdrawRect({\n\t\t\twidth: ftext.width + pad * 2,\n\t\t\theight: ftext.height + pad * 2,\n\t\t\torigin: \"botleft\",\n\t\t\tcolor: rgb(0, 0, 0),\n\t\t\tradius: 4,\n\t\t\topacity: 0.8,\n\t\t\tfixed: true,\n\t\t});\n\n\t\tdrawFormattedText(ftext);\n\t\tpopTransform();\n\n\t}\n\n}\n\nif (gopt.debug !== false) {\n\tenterDebugMode();\n}\n\nif (gopt.burp) {\n\tenterBurpMode();\n}\n\nwindow.addEventListener(\"error\", (e) => {\n\tdebug.error(`Error: ${e.error.message}`);\n\tquit();\n\trun(() => {\n\t\tif (loadProgress() === 1) {\n\t\t\tframeStart();\n\t\t\tdrawDebug();\n\t\t\tframeEnd();\n\t\t}\n\t});\n});\n\nfunction run(f: () => void) {\n\n\tconst frame = (t: number) => {\n\n\t\tif (document.visibilityState !== \"visible\") {\n\t\t\tapp.loopID = requestAnimationFrame(frame);\n\t\t\treturn;\n\t\t}\n\n\t\tconst realTime = t / 1000;\n\t\tconst realDt = realTime - app.realTime;\n\n\t\tapp.realTime = realTime;\n\n\t\tif (!app.skipTime) {\n\t\t\tapp.dt = realDt;\n\t\t\tapp.time += app.dt;\n\t\t\tapp.fpsCounter.tick(app.dt);\n\t\t}\n\n\t\tapp.skipTime = false;\n\t\tapp.numFrames++;\n\n\t\tf();\n\n\t\tfor (const k in app.keyStates) {\n\t\t\tapp.keyStates[k] = processButtonState(app.keyStates[k]);\n\t\t}\n\n\t\tfor (const m in app.mouseStates) {\n\t\t\tapp.mouseStates[m] = processButtonState(app.mouseStates[m]);\n\t\t}\n\n\t\tapp.charInputted = [];\n\t\tapp.isMouseMoved = false;\n\t\tapp.isKeyPressed = false;\n\t\tapp.isKeyPressedRepeat = false;\n\t\tapp.isKeyReleased = false;\n\t\tapp.loopID = requestAnimationFrame(frame);\n\n\t};\n\n\tapp.stopped = false;\n\tapp.loopID = requestAnimationFrame(frame);\n\n}\n\n// main game loop\nrun(() => {\n\n\t// running this every frame now mainly because isFullscreen() is not updated real time when requested fullscreen\n\tupdateViewport();\n\n\tif (!app.loaded) {\n\t\tframeStart();\n\t\tdrawLoadScreen();\n\t\tframeEnd();\n\t} else {\n\n\t\t// TODO: this gives the latest mousePos in input handlers but uses cam matrix from last frame\n\t\tgame.trigger(\"input\");\n\n\t\tif (!debug.paused) {\n\t\t\tupdateFrame();\n\t\t}\n\n\t\tframeStart();\n\t\tdrawFrame();\n\n\t\tif (gopt.debug !== false) {\n\t\t\tdrawDebug();\n\t\t}\n\n\t\tframeEnd();\n\n\t}\n\n});\n\nloadFont(\n\t\"apl386\",\n\tapl386Src,\n\t45,\n\t74,\n);\n\nloadFont(\n\t\"apl386o\",\n\tapl386oSrc,\n\t45,\n\t74,\n);\n\nloadFont(\n\t\"sink\",\n\tsinkSrc,\n\t6,\n\t8,\n\t{\n\t\tchars: `█☺☻♥♦♣♠●○▪□■◘♪♫≡►◄⌂ÞÀß×¥↑↓→←◌●▼▲ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_\\`abcdefghijklmnopqrstuvwxyz{|}~Χ░▒▓ḀḁḂ│┬┤┌┐ḃḄ┼ḅḆḇḈḉḊḋḌ─├┴└┘ḍḎ⁞ḏḐḑḒḓḔḕḖḗḘ▄ḙḚḛḜ…ḝḞḟḠḡḢḣḤḥḦ▌▐ḧḨḩḪḫḬḭḮḯḰḱḲḳḴḵḶḷḸḹḺḻḼḽḾḿṀṁṂṃṄṅṆṇṈṉṊṋṌṍṎṏṐṑṒṓṔṕṖṗṘṙṚṛṜṝṞṟṠṡṢṣṤṥṦṧṨṩṪṫṬṭṮṯṰṱṲṳṴṵṶṷṸṹṺṻṼ`,\n\t}\n);\n\nloadFont(\n\t\"sinko\",\n\tsinkoSrc,\n\t8,\n\t10,\n);\n\nframeStart();\nframeEnd();\n\n// the exported ctx handle\nconst ctx: KaboomCtx = {\n\t// asset load\n\tloadRoot,\n\tloadSprite,\n\tloadSpriteAtlas,\n\tloadSound,\n\tloadFont,\n\tloadShader,\n\tloadAseprite,\n\tloadPedit,\n\tloadBean,\n\tload,\n\t// query\n\twidth,\n\theight,\n\tcenter,\n\tdt,\n\ttime,\n\tscreenshot,\n\trecord,\n\tisFocused,\n\tfocus,\n\tcursor,\n\tregCursor,\n\tfullscreen,\n\tisFullscreen,\n\tonLoad,\n\tisTouch: () => app.isTouch,\n\t// misc\n\tlayers,\n\tcamPos,\n\tcamScale,\n\tcamRot,\n\tshake,\n\ttoScreen,\n\ttoWorld,\n\tgravity,\n\t// obj\n\tadd,\n\treadd,\n\tdestroy,\n\tdestroyAll,\n\tget,\n\tevery,\n\trevery,\n\t// comps\n\tpos,\n\tscale,\n\trotate,\n\tcolor,\n\topacity,\n\torigin,\n\tlayer,\n\tarea,\n\tsprite,\n\ttext,\n\trect,\n\tcircle,\n\tuvquad,\n\toutline,\n\tbody,\n\tshader,\n\ttimer,\n\tsolid,\n\tfixed,\n\tstay,\n\thealth,\n\tlifespan,\n\tz,\n\tmove,\n\toutview,\n\tcleanup,\n\tfollow,\n\tstate,\n\t// group events\n\ton,\n\tonUpdate,\n\tonDraw,\n\tonCollide,\n\tonClick,\n\tonHover,\n\t// input\n\tonKeyDown,\n\tonKeyPress,\n\tonKeyPressRepeat,\n\tonKeyRelease,\n\tonMouseDown,\n\tonMousePress,\n\tonMouseRelease,\n\tonMouseMove,\n\tonCharInput,\n\tonTouchStart,\n\tonTouchMove,\n\tonTouchEnd,\n\tmousePos,\n\tmouseWorldPos,\n\tmouseDeltaPos,\n\tisKeyDown,\n\tisKeyPressed,\n\tisKeyPressedRepeat,\n\tisKeyReleased,\n\tisMouseDown,\n\tisMousePressed,\n\tisMouseReleased,\n\tisMouseMoved,\n\t// timer\n\tloop,\n\twait,\n\t// audio\n\tplay,\n\tvolume,\n\tburp,\n\taudioCtx: audio.ctx,\n\t// math\n\tTimer,\n\tLine,\n\tRect,\n\tCircle,\n\tVec2,\n\tColor,\n\tMat4,\n\tQuad,\n\tRNG,\n\trng,\n\trand,\n\trandi,\n\trandSeed,\n\tvec2,\n\trgb,\n\thsl2rgb,\n\tquad,\n\tchoose,\n\tchance,\n\tlerp,\n\tmap,\n\tmapc,\n\twave,\n\tdeg2rad,\n\trad2deg,\n\ttestAreaRect,\n\ttestAreaLine,\n\ttestAreaCircle,\n\ttestAreaPolygon,\n\ttestAreaPoint,\n\ttestAreaArea,\n\ttestLineLine,\n\ttestRectRect,\n\ttestRectLine,\n\ttestRectPoint,\n\ttestPolygonPoint,\n\ttestLinePolygon,\n\ttestPolygonPolygon,\n\ttestCircleCircle,\n\ttestCirclePoint,\n\ttestRectPolygon,\n\t// raw draw\n\tdrawSprite,\n\tdrawText,\n\tformatText,\n\tdrawRect,\n\tdrawLine,\n\tdrawLines,\n\tdrawTriangle,\n\tdrawCircle,\n\tdrawEllipse,\n\tdrawUVQuad,\n\tdrawPolygon,\n\tdrawFormattedText,\n\tpushTransform,\n\tpopTransform,\n\tpushTranslate,\n\tpushRotate: pushRotateZ,\n\tpushScale,\n\t// debug\n\tdebug,\n\t// scene\n\tscene,\n\tgo,\n\t// level\n\taddLevel,\n\t// storage\n\tgetData,\n\tsetData,\n\t// plugin\n\tplug,\n\t// char sets\n\tASCII_CHARS,\n\tCP437_CHARS,\n\t// dom\n\tcanvas: app.canvas,\n\t// misc\n\taddKaboom,\n\t// dirs\n\tLEFT: Vec2.LEFT,\n\tRIGHT: Vec2.RIGHT,\n\tUP: Vec2.UP,\n\tDOWN: Vec2.DOWN,\n\t// colors\n\tRED: Color.RED,\n\tGREEN: Color.GREEN,\n\tBLUE: Color.BLUE,\n\tYELLOW: Color.YELLOW,\n\tMAGENTA: Color.MAGENTA,\n\tCYAN: Color.CYAN,\n\tWHITE: Color.WHITE,\n\tBLACK: Color.BLACK,\n\t// deprecated\n\tkeyIsDown: deprecate(\"keyIsDown()\", \"isKeyDown()\", isKeyDown),\n\tkeyIsPressed: deprecate(\"keyIsPressed()\", \"isKeyPressed()\", isKeyPressed),\n\tkeyIsPressedRep: deprecate(\"keyIsPressedRep()\", \"isKeyPressedRepeat()\", isKeyPressedRepeat),\n\tkeyIsReleased: deprecate(\"keyIsReleased()\", \"isKeyReleased()\", isKeyReleased),\n\tmouseIsDown: deprecate(\"mouseIsDown()\", \"isMouseDown()\", isMouseDown),\n\tmouseIsClicked: deprecate(\"mouseIsClicked()\", \"isMousePressed()\", isMousePressed),\n\tmouseIsReleased: deprecate(\"mouseIsReleased()\", \"isMouseReleased()\", isMouseReleased),\n\tmouseIsMoved: deprecate(\"mouseIsMoved()\", \"isMouseMoved()\", isMouseMoved),\n\tdir: deprecate(\"dir()\", \"Vec2.fromAngle()\", Vec2.fromAngle),\n\taction: deprecate(\"action()\", \"onUpdate()\", onUpdate),\n\trender: deprecate(\"render()\", \"onDraw()\", onDraw),\n\tcollides: deprecate(\"collides()\", \"onCollide()\", onCollide),\n\tclicks: deprecate(\"clicks()\", \"onClick()\", onClick),\n\thovers: deprecate(\"hovers()\", \"onHover()\", onHover),\n\tkeyDown: deprecate(\"keyDown()\", \"onKeyDown()\", onKeyDown),\n\tkeyPress: deprecate(\"keyPress()\", \"onKeyPress()\", onKeyPress),\n\tkeyPressRep: deprecate(\"keyPressRep()\", \"onKeyPressRepeat()\", onKeyPressRepeat),\n\tkeyRelease: deprecate(\"keyRelease()\", \"onKeyRelease()\", onKeyRelease),\n\tmouseDown: deprecate(\"mouseDown()\", \"onMouseDown()\", onMouseDown),\n\tmouseClick: deprecate(\"mouseClick()\", \"onMousePress()\", onMousePress),\n\tmouseRelease: deprecate(\"mouseRelease()\", \"onMouseRelease()\", onMouseRelease),\n\tmouseMove: deprecate(\"mouseMove()\", \"onMouseMove()\", onMouseMove),\n\tcharInput: deprecate(\"charInput()\", \"onCharInput()\", onCharInput),\n\ttouchStart: deprecate(\"touchStart()\", \"onTouchStart()\", onTouchStart),\n\ttouchMove: deprecate(\"touchMove()\", \"onTouchMove()\", onTouchMove),\n\ttouchEnd: deprecate(\"touchEnd()\", \"onTouchEnd()\", onTouchEnd),\n\tfocused: deprecate(\"focused()\", \"isFocused()\", isFocused),\n\tready: deprecate(\"ready()\", \"onLoad()\", onLoad),\n};\n\nif (gopt.plugins) {\n\tgopt.plugins.forEach(plug);\n}\n\n// export everything to window if global is set\nif (gopt.global !== false) {\n\tfor (const k in ctx) {\n\t\twindow[k] = ctx[k];\n\t}\n}\n\nreturn ctx;\n\n};\n","export class IDList<T> extends Map<number, T> {\n\t_lastID: number;\n\tconstructor(...args) {\n\t\tsuper(...args);\n\t\tthis._lastID = 0;\n\t}\n\tpush(v: T): number {\n\t\tconst id = this._lastID;\n\t\tthis.set(id, v);\n\t\tthis._lastID++;\n\t\treturn id;\n\t}\n\tpushd(v: T): () => void {\n\t\tconst id = this.push(v);\n\t\treturn () => this.delete(id);\n\t}\n}\n\nexport function deepEq(o1: any, o2: any): boolean {\n\tconst t1 = typeof o1;\n\tconst t2 = typeof o2;\n\tif (t1 !== t2) {\n\t\treturn false;\n\t}\n\tif (t1 === \"object\" && t2 === \"object\") {\n\t\tconst k1 = Object.keys(o1);\n\t\tconst k2 = Object.keys(o2);\n\t\tif (k1.length !== k2.length) {\n\t\t\treturn false;\n\t\t}\n\t\tfor (const k of k1) {\n\t\t\tconst v1 = o1[k];\n\t\t\tconst v2 = o2[k];\n\t\t\tif (!(typeof v1 === \"function\" && typeof v2 === \"function\")) {\n\t\t\t\tif (!deepEq(v1, v2)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn true;\n\t}\n\treturn o1 === o2;\n}\n\nexport function downloadURL(url: string, filename: string) {\n\tconst a = document.createElement(\"a\");\n\tdocument.body.appendChild(a);\n\ta.setAttribute(\"style\", \"display: none\");\n\ta.href = url;\n\ta.download = filename;\n\ta.click();\n\tdocument.body.removeChild(a);\n}\n\nexport function downloadBlob(blob: Blob, filename: string) {\n\tconst url = URL.createObjectURL(blob);\n\tdownloadURL(url, filename);\n\tURL.revokeObjectURL(url);\n}\n\nexport function isDataURL(str: string) {\n\treturn str.match(/^data:\\w+\\/\\w+;base64,.+/);\n}\n\nexport const uid = (() => {\n\tlet id = 0;\n\treturn () => id++;\n})();\n\nconst warned = new Set();\n\nexport function deprecateMsg(oldName: string, newName: string) {\n\tif (!warned.has(oldName)) {\n\t\twarned.add(oldName);\n\t\tconsole.warn(`${oldName} is deprecated. Use ${newName} instead.`);\n\t}\n}\n\nexport const deprecate = (oldName: string, newName: string, newFunc: (...args) => any) => (...args) => {\n\tdeprecateMsg(oldName, newName);\n\treturn newFunc(...args);\n};\n","import {\n\tVec4,\n\tPoint,\n\tPolygon,\n\tArea,\n} from \"./types\";\n\nimport {\n\tdeprecateMsg,\n} from \"./utils\";\n\nexport function deg2rad(deg: number): number {\n\treturn deg * Math.PI / 180;\n}\n\nexport function rad2deg(rad: number): number {\n\treturn rad * 180 / Math.PI;\n}\n\nexport function clamp(\n\tval: number,\n\tmin: number,\n\tmax: number,\n): number {\n\tif (min > max) {\n\t\treturn clamp(val, max, min);\n\t}\n\treturn Math.min(Math.max(val, min), max);\n}\n\nexport function lerp(\n\ta: number,\n\tb: number,\n\tt: number,\n): number {\n\treturn a + (b - a) * t;\n}\n\nexport function map(\n\tv: number,\n\tl1: number,\n\th1: number,\n\tl2: number,\n\th2: number,\n): number {\n\treturn l2 + (v - l1) / (h1 - l1) * (h2 - l2);\n}\n\nexport function mapc(\n\tv: number,\n\tl1: number,\n\th1: number,\n\tl2: number,\n\th2: number,\n): number {\n\treturn clamp(map(v, l1, h1, l2, h2), l2, h2);\n}\n\nexport class Vec2 {\n\tx: number = 0;\n\ty: number = 0;\n\tconstructor(x: number = 0, y: number = x) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t}\n\tstatic fromAngle(deg: number) {\n\t\tconst angle = deg2rad(deg);\n\t\treturn new Vec2(Math.cos(angle), Math.sin(angle));\n\t}\n\tstatic LEFT = new Vec2(-1, 0);\n\tstatic RIGHT = new Vec2(1, 0);\n\tstatic UP = new Vec2(0, -1);\n\tstatic DOWN = new Vec2(0, 1);\n\tclone(): Vec2 {\n\t\treturn new Vec2(this.x, this.y);\n\t}\n\tadd(...args): Vec2 {\n\t\tconst p2 = vec2(...args);\n\t\treturn new Vec2(this.x + p2.x, this.y + p2.y);\n\t}\n\tsub(...args): Vec2 {\n\t\tconst p2 = vec2(...args);\n\t\treturn new Vec2(this.x - p2.x, this.y - p2.y);\n\t}\n\tscale(...args): Vec2 {\n\t\tconst s = vec2(...args);\n\t\treturn new Vec2(this.x * s.x, this.y * s.y);\n\t}\n\tdist(...args): number {\n\t\tconst p2 = vec2(...args);\n\t\treturn Math.sqrt(\n\t\t\t(this.x - p2.x) * (this.x - p2.x)\n\t\t\t+ (this.y - p2.y) * (this.y - p2.y)\n\t\t);\n\t}\n\tlen(): number {\n\t\treturn this.dist(new Vec2(0, 0));\n\t}\n\tunit(): Vec2 {\n\t\treturn this.scale(1 / this.len());\n\t}\n\tnormal(): Vec2 {\n\t\treturn new Vec2(this.y, -this.x);\n\t}\n\tdot(p2: Vec2): number {\n\t\treturn this.x * p2.x + this.y * p2.y;\n\t}\n\tangle(...args): number {\n\t\tconst p2 = vec2(...args);\n\t\treturn rad2deg(Math.atan2(this.y - p2.y, this.x - p2.x));\n\t}\n\tlerp(p2: Vec2, t: number): Vec2 {\n\t\treturn new Vec2(lerp(this.x, p2.x, t), lerp(this.y, p2.y, t));\n\t}\n\ttoFixed(n: number): Vec2 {\n\t\treturn new Vec2(Number(this.x.toFixed(n)), Number(this.y.toFixed(n)));\n\t}\n\teq(other: Vec2): boolean {\n\t\treturn this.x === other.x && this.y === other.y;\n\t}\n\ttoString(): string {\n\t\treturn `(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`;\n\t}\n\tstr(): string {\n\t\treturn this.toString();\n\t}\n}\n\nexport function vec2(...args): Vec2 {\n\tif (args.length === 1) {\n\t\tif (args[0] instanceof Vec2) {\n\t\t\treturn vec2(args[0].x, args[0].y);\n\t\t} else if (Array.isArray(args[0]) && args[0].length === 2) {\n\t\t\treturn vec2.apply(null, args[0]);\n\t\t}\n\t}\n\treturn new Vec2(...args);\n}\n\nexport class Vec3 {\n\tx: number = 0;\n\ty: number = 0;\n\tz: number = 0;\n\tconstructor(x: number, y: number, z: number) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.z = z;\n\t}\n\txy() {\n\t\treturn vec2(this.x, this.y);\n\t}\n}\n\nexport const vec3 = (x, y, z) => new Vec3(x, y, z);\n\nexport class Color {\n\n\tr: number = 255;\n\tg: number = 255;\n\tb: number = 255;\n\n\tconstructor(r: number, g: number, b: number) {\n\t\tthis.r = clamp(r, 0, 255);\n\t\tthis.g = clamp(g, 0, 255);\n\t\tthis.b = clamp(b, 0, 255);\n\t}\n\n\tstatic fromArray(arr: number[]) {\n\t\treturn new Color(arr[0], arr[1], arr[2])\n\t}\n\n\tstatic RED = rgb(255, 0, 0);\n\tstatic GREEN = rgb(0, 255, 0);\n\tstatic BLUE = rgb(0, 0, 255);\n\tstatic YELLOW = rgb(255, 255, 0);\n\tstatic MAGENTA = rgb(255, 0, 255);\n\tstatic CYAN = rgb(0, 255, 255);\n\tstatic WHITE = rgb(255, 255, 255);\n\tstatic BLACK = rgb(0, 0, 0);\n\n\tclone(): Color {\n\t\treturn new Color(this.r, this.g, this.b);\n\t}\n\n\tlighten(a: number): Color {\n\t\treturn new Color(this.r + a, this.g + a, this.b + a);\n\t}\n\n\tdarken(a: number): Color {\n\t\treturn this.lighten(-a);\n\t}\n\n\tinvert(): Color {\n\t\treturn new Color(255 - this.r, 255 - this.g, 255 - this.b);\n\t}\n\n\tmult(other: Color): Color {\n\t\treturn new Color(\n\t\t\tthis.r * other.r / 255,\n\t\t\tthis.g * other.g / 255,\n\t\t\tthis.b * other.b / 255,\n\t\t);\n\t}\n\n\teq(other: Color): boolean {\n\t\treturn this.r === other.r\n\t\t\t&& this.g === other.g\n\t\t\t&& this.b === other.b\n\t\t\t;\n\t}\n\n\tstr(): string {\n\t\tdeprecateMsg(\"str()\", \"toString()\");\n\t\treturn `(${this.r}, ${this.g}, ${this.b})`;\n\t}\n\n\ttoString(): string {\n\t\treturn `(${this.r}, ${this.g}, ${this.b})`;\n\t}\n\n\tstatic fromHSL(h: number, s: number, l: number) {\n\n\t\tif (s == 0){\n\t\t\treturn rgb(255 * l, 255 * l, 255 * l);\n\t\t}\n\n\t\tconst hue2rgb = (p, q, t) => {\n\t\t\tif (t < 0) t += 1;\n\t\t\tif (t > 1) t -= 1;\n\t\t\tif (t < 1 / 6) return p + (q - p) * 6 * t;\n\t\t\tif (t < 1 / 2) return q;\n\t\t\tif (t < 2 / 3) return p + (q - p) * (2/3 - t) * 6;\n\t\t\treturn p;\n\t\t}\n\n\t\tconst q = l < 0.5 ? l * (1 + s) : l + s - l * s;\n\t\tconst p = 2 * l - q;\n\t\tconst r = hue2rgb(p, q, h + 1 / 3);\n\t\tconst g = hue2rgb(p, q, h);\n\t\tconst b = hue2rgb(p, q, h - 1 / 3);\n\n\t\treturn new Color(Math.round(r * 255), Math.round(g * 255), Math.round(b * 255));\n\n\t}\n\n}\n\nexport function rgb(...args): Color {\n\tif (args.length === 0) {\n\t\treturn new Color(255, 255, 255);\n\t} else if (args.length === 1) {\n\t\tif (args[0] instanceof Color) {\n\t\t\treturn args[0].clone();\n\t\t} else if (Array.isArray(args[0]) && args[0].length === 3) {\n\t\t\treturn Color.fromArray(args[0]);\n\t\t}\n\t}\n\t// @ts-ignore\n\treturn new Color(...args);\n}\n\nexport const hsl2rgb = (h, s, l) => Color.fromHSL(h, s, l);\n\nexport class Quad {\n\tx: number = 0;\n\ty: number = 0;\n\tw: number = 1;\n\th: number = 1;\n\tconstructor(x: number, y: number, w: number, h: number) {\n\t\tthis.x = x;\n\t\tthis.y = y;\n\t\tthis.w = w;\n\t\tthis.h = h;\n\t}\n\tscale(other: Quad): Quad {\n\t\treturn new Quad(\n\t\t\tthis.x + this.w * other.x,\n\t\t\tthis.y + this.h * other.y,\n\t\t\tthis.w * other.w,\n\t\t\tthis.h * other.h\n\t\t);\n\t}\n\tclone(): Quad {\n\t\treturn new Quad(this.x, this.y, this.w, this.h);\n\t}\n\teq(other: Quad): boolean {\n\t\treturn this.x === other.x\n\t\t\t&& this.y === other.y\n\t\t\t&& this.w === other.w\n\t\t\t&& this.h === other.h;\n\t}\n\ttoString(): string {\n\t\treturn `quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`;\n\t}\n}\n\nexport function quad(x: number, y: number, w: number, h: number): Quad {\n\treturn new Quad(x, y, w, h);\n}\n\nexport class Mat4 {\n\n\tm: number[] = [\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1,\n\t];\n\n\tconstructor(m?: number[]) {\n\t\tif (m) {\n\t\t\tthis.m = m;\n\t\t}\n\t}\n\n\tclone(): Mat4 {\n\t\treturn new Mat4(this.m);\n\t};\n\n\tmult(other: Mat4): Mat4 {\n\n\t\tconst out = [];\n\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tfor (let j = 0; j < 4; j++) {\n\t\t\t\tout[i * 4 + j] =\n\t\t\t\t\tthis.m[0 * 4 + j] * other.m[i * 4 + 0] +\n\t\t\t\t\tthis.m[1 * 4 + j] * other.m[i * 4 + 1] +\n\t\t\t\t\tthis.m[2 * 4 + j] * other.m[i * 4 + 2] +\n\t\t\t\t\tthis.m[3 * 4 + j] * other.m[i * 4 + 3];\n\t\t\t}\n\t\t}\n\n\t\treturn new Mat4(out);\n\n\t}\n\n\tmultVec4(p: Vec4): Vec4 {\n\t\treturn {\n\t\t\tx: p.x * this.m[0] + p.y * this.m[4] + p.z * this.m[8] + p.w * this.m[12],\n\t\t\ty: p.x * this.m[1] + p.y * this.m[5] + p.z * this.m[9] + p.w * this.m[13],\n\t\t\tz: p.x * this.m[2] + p.y * this.m[6] + p.z * this.m[10] + p.w * this.m[14],\n\t\t\tw: p.x * this.m[3] + p.y * this.m[7] + p.z * this.m[11] + p.w * this.m[15]\n\t\t};\n\t}\n\n\tmultVec3(p: Vec3): Vec3 {\n\t\tconst p4 = this.multVec4({\n\t\t\tx: p.x,\n\t\t\ty: p.y,\n\t\t\tz: p.z,\n\t\t\tw: 1.0,\n\t\t});\n\t\treturn vec3(p4.x, p4.y, p4.z);\n\t}\n\n\tmultVec2(p: Vec2): Vec2 {\n\t\treturn vec2(\n\t\t\tp.x * this.m[0] + p.y * this.m[4] + 0 * this.m[8] + 1 * this.m[12],\n\t\t\tp.x * this.m[1] + p.y * this.m[5] + 0 * this.m[9] + 1 * this.m[13],\n\t\t);\n\t}\n\n\tstatic translate(p: Vec2): Mat4 {\n\t\treturn new Mat4([\n\t\t\t1, 0, 0, 0,\n\t\t\t0, 1, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\tp.x, p.y, 0, 1,\n\t\t]);\n\t}\n\n\tstatic scale(s: Vec2): Mat4 {\n\t\treturn new Mat4([\n\t\t\ts.x, 0, 0, 0,\n\t\t\t0, s.y, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1,\n\t\t]);\n\t}\n\n\tstatic rotateX(a: number): Mat4 {\n\t\ta = deg2rad(-a);\n\t\treturn new Mat4([\n\t\t\t1, 0, 0, 0,\n\t\t\t0, Math.cos(a), -Math.sin(a), 0,\n\t\t\t0, Math.sin(a), Math.cos(a), 0,\n\t\t\t0, 0, 0, 1,\n\t\t]);\n\t}\n\n\tstatic rotateY(a: number): Mat4 {\n\t\ta = deg2rad(-a);\n\t\treturn new Mat4([\n\t\t\tMath.cos(a), 0, Math.sin(a), 0,\n\t\t\t0, 1, 0, 0,\n\t\t\t-Math.sin(a), 0, Math.cos(a), 0,\n\t\t\t0, 0, 0, 1,\n\t\t]);\n\t}\n\n\tstatic rotateZ(a: number): Mat4 {\n\t\ta = deg2rad(-a);\n\t\treturn new Mat4([\n\t\t\tMath.cos(a), -Math.sin(a), 0, 0,\n\t\t\tMath.sin(a), Math.cos(a), 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1,\n\t\t]);\n\t}\n\n\ttranslate(p: Vec2): Mat4 {\n\t\treturn this.mult(Mat4.translate(p));\n\t}\n\n\tscale(s: Vec2): Mat4 {\n\t\treturn this.mult(Mat4.scale(s));\n\t}\n\n\trotateX(a: number): Mat4 {\n\t\treturn this.mult(Mat4.rotateX(a));\n\t}\n\n\trotateY(a: number): Mat4 {\n\t\treturn this.mult(Mat4.rotateY(a));\n\t}\n\n\trotateZ(a: number): Mat4 {\n\t\treturn this.mult(Mat4.rotateZ(a));\n\t}\n\n\tinvert(): Mat4 {\n\n\t\tconst out = [];\n\n\t\tconst f00 = this.m[10] * this.m[15] - this.m[14] * this.m[11];\n\t\tconst f01 = this.m[9] * this.m[15] - this.m[13] * this.m[11];\n\t\tconst f02 = this.m[9] * this.m[14] - this.m[13] * this.m[10];\n\t\tconst f03 = this.m[8] * this.m[15] - this.m[12] * this.m[11];\n\t\tconst f04 = this.m[8] * this.m[14] - this.m[12] * this.m[10];\n\t\tconst f05 = this.m[8] * this.m[13] - this.m[12] * this.m[9];\n\t\tconst f06 = this.m[6] * this.m[15] - this.m[14] * this.m[7];\n\t\tconst f07 = this.m[5] * this.m[15] - this.m[13] * this.m[7];\n\t\tconst f08 = this.m[5] * this.m[14] - this.m[13] * this.m[6];\n\t\tconst f09 = this.m[4] * this.m[15] - this.m[12] * this.m[7];\n\t\tconst f10 = this.m[4] * this.m[14] - this.m[12] * this.m[6];\n\t\tconst f11 = this.m[5] * this.m[15] - this.m[13] * this.m[7];\n\t\tconst f12 = this.m[4] * this.m[13] - this.m[12] * this.m[5];\n\t\tconst f13 = this.m[6] * this.m[11] - this.m[10] * this.m[7];\n\t\tconst f14 = this.m[5] * this.m[11] - this.m[9] * this.m[7];\n\t\tconst f15 = this.m[5] * this.m[10] - this.m[9] * this.m[6];\n\t\tconst f16 = this.m[4] * this.m[11] - this.m[8] * this.m[7];\n\t\tconst f17 = this.m[4] * this.m[10] - this.m[8] * this.m[6];\n\t\tconst f18 = this.m[4] * this.m[9] - this.m[8] * this.m[5];\n\n\t\tout[0] = this.m[5] * f00 - this.m[6] * f01 + this.m[7] * f02;\n\t\tout[4] = -(this.m[4] * f00 - this.m[6] * f03 + this.m[7] * f04);\n\t\tout[8] = this.m[4] * f01 - this.m[5] * f03 + this.m[7] * f05;\n\t\tout[12] = -(this.m[4] * f02 - this.m[5] * f04 + this.m[6] * f05);\n\n\t\tout[1] = -(this.m[1] * f00 - this.m[2] * f01 + this.m[3] * f02);\n\t\tout[5] = this.m[0] * f00 - this.m[2] * f03 + this.m[3] * f04;\n\t\tout[9] = -(this.m[0] * f01 - this.m[1] * f03 + this.m[3] * f05);\n\t\tout[13] = this.m[0] * f02 - this.m[1] * f04 + this.m[2] * f05;\n\n\t\tout[2] = this.m[1] * f06 - this.m[2] * f07 + this.m[3] * f08;\n\t\tout[6] = -(this.m[0] * f06 - this.m[2] * f09 + this.m[3] * f10);\n\t\tout[10] = this.m[0] * f11 - this.m[1] * f09 + this.m[3] * f12;\n\t\tout[14] = -(this.m[0] * f08 - this.m[1] * f10 + this.m[2] * f12);\n\n\t\tout[3] = -(this.m[1] * f13 - this.m[2] * f14 + this.m[3] * f15);\n\t\tout[7] = this.m[0] * f13 - this.m[2] * f16 + this.m[3] * f17;\n\t\tout[11] = -(this.m[0] * f14 - this.m[1] * f16 + this.m[3] * f18);\n\t\tout[15] = this.m[0] * f15 - this.m[1] * f17 + this.m[2] * f18;\n\n\t\tconst det =\n\t\t\tthis.m[0] * out[0] +\n\t\t\tthis.m[1] * out[4] +\n\t\t\tthis.m[2] * out[8] +\n\t\t\tthis.m[3] * out[12];\n\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tfor (let j = 0; j < 4; j++) {\n\t\t\t\tout[i * 4 + j] *= (1.0 / det);\n\t\t\t}\n\t\t}\n\n\t\treturn new Mat4(out);\n\n\t}\n\n\ttoString(): string {\n\t\treturn this.m.toString();\n\t}\n\n}\n\nexport function wave(lo: number, hi: number, t: number, f = Math.sin): number {\n\treturn lo + (f(t) + 1) / 2 * (hi - lo);\n}\n\n// basic ANSI C LCG\nconst A = 1103515245;\nconst C = 12345;\nconst M = 2147483648;\n\nexport class RNG {\n\tseed: number;\n\tconstructor(seed: number) {\n\t\tthis.seed = seed;\n\t}\n\tgen(...args) {\n\t\tif (args.length === 0) {\n\t\t\tthis.seed = (A * this.seed + C) % M;\n\t\t\treturn this.seed / M;\n\t\t} else if (args.length === 1) {\n\t\t\tif (typeof args[0] === \"number\") {\n\t\t\t\treturn this.gen(0, args[0]);\n\t\t\t} else if (args[0] instanceof Vec2) {\n\t\t\t\treturn this.gen(vec2(0, 0), args[0]);\n\t\t\t} else if (args[0] instanceof Color) {\n\t\t\t\treturn this.gen(rgb(0, 0, 0), args[0]);\n\t\t\t}\n\t\t} else if (args.length === 2) {\n\t\t\tif (typeof args[0] === \"number\" && typeof args[1] === \"number\") {\n\t\t\t\treturn (this.gen() * (args[1] - args[0])) + args[0];\n\t\t\t} else if (args[0] instanceof Vec2 && args[1] instanceof Vec2) {\n\t\t\t\treturn vec2(\n\t\t\t\t\tthis.gen(args[0].x, args[1].x),\n\t\t\t\t\tthis.gen(args[0].y, args[1].y),\n\t\t\t\t);\n\t\t\t} else if (args[0] instanceof Color && args[1] instanceof Color) {\n\t\t\t\treturn rgb(\n\t\t\t\t\tthis.gen(args[0].r, args[1].r),\n\t\t\t\t\tthis.gen(args[0].g, args[1].g),\n\t\t\t\t\tthis.gen(args[0].b, args[1].b),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n\n// TODO: let user pass seed\nconst defRNG = new RNG(Date.now());\n\nexport function rng(seed: number): RNG {\n\tdeprecateMsg(\"rng()\", \"new RNG()\");\n\treturn new RNG(seed);\n}\n\nexport function randSeed(seed?: number): number {\n\tif (seed != null) {\n\t\tdefRNG.seed = seed;\n\t}\n\treturn defRNG.seed;\n}\n\nexport function rand(...args) {\n\t// @ts-ignore\n\treturn defRNG.gen(...args);\n}\n\n// TODO: randi() to return 0 / 1?\nexport function randi(...args) {\n\treturn Math.floor(rand(...args));\n}\n\nexport function chance(p: number): boolean {\n\treturn rand() <= p;\n}\n\nexport function choose<T>(list: T[]): T {\n\treturn list[randi(list.length)];\n}\n\n// TODO: better name\nexport function testRectRect2(r1: Rect, r2: Rect): boolean {\n\treturn r1.p2.x >= r2.p1.x\n\t\t&& r1.p1.x <= r2.p2.x\n\t\t&& r1.p2.y >= r2.p1.y\n\t\t&& r1.p1.y <= r2.p2.y;\n}\n\nexport function testRectRect(r1: Rect, r2: Rect): boolean {\n\treturn r1.p2.x > r2.p1.x\n\t\t&& r1.p1.x < r2.p2.x\n\t\t&& r1.p2.y > r2.p1.y\n\t\t&& r1.p1.y < r2.p2.y;\n}\n\n// TODO: better name\nexport function testLineLineT(l1: Line, l2: Line): number | null {\n\n\tif ((l1.p1.x === l1.p2.x && l1.p1.y === l1.p2.y) || (l2.p1.x === l2.p2.x && l2.p1.y === l2.p2.y)) {\n\t\treturn null;\n\t}\n\n\tconst denom = ((l2.p2.y - l2.p1.y) * (l1.p2.x - l1.p1.x) - (l2.p2.x - l2.p1.x) * (l1.p2.y - l1.p1.y));\n\n\t// parallel\n\tif (denom === 0) {\n\t\treturn null;\n\t}\n\n\tconst ua = ((l2.p2.x - l2.p1.x) * (l1.p1.y - l2.p1.y) - (l2.p2.y - l2.p1.y) * (l1.p1.x - l2.p1.x)) / denom;\n\tconst ub = ((l1.p2.x - l1.p1.x) * (l1.p1.y - l2.p1.y) - (l1.p2.y - l1.p1.y) * (l1.p1.x - l2.p1.x)) / denom;\n\n\t// is the intersection on the segments\n\tif (ua < 0 || ua > 1 || ub < 0 || ub > 1) {\n\t\treturn null;\n\t}\n\n\treturn ua;\n\n}\n\nexport function testLineLine(l1: Line, l2: Line): Vec2 | null {\n\tconst t = testLineLineT(l1, l2);\n\tif (!t) return null;\n\treturn vec2(\n\t\tl1.p1.x + t * (l1.p2.x - l1.p1.x),\n\t\tl1.p1.y + t * (l1.p2.y - l1.p1.y),\n\t);\n}\n\nexport function testRectLine(r: Rect, l: Line): boolean {\n\tif (testRectPoint(r, l.p1) || testRectPoint(r, l.p2)) {\n\t\treturn true;\n\t}\n\treturn !!testLineLine(l, new Line(r.p1, vec2(r.p2.x, r.p1.y)))\n\t\t|| !!testLineLine(l, new Line(vec2(r.p2.x, r.p1.y), r.p2))\n\t\t|| !!testLineLine(l, new Line(r.p2, vec2(r.p1.x, r.p2.y)))\n\t\t|| !!testLineLine(l, new Line(vec2(r.p1.x, r.p2.y), r.p1));\n}\n\nexport function testRectPoint2(r: Rect, pt: Point): boolean {\n\treturn pt.x >= r.p1.x && pt.x <= r.p2.x && pt.y >= r.p1.y && pt.y <= r.p2.y;\n}\n\nexport function testRectPoint(r: Rect, pt: Point): boolean {\n\treturn pt.x > r.p1.x && pt.x < r.p2.x && pt.y > r.p1.y && pt.y < r.p2.y;\n}\n\nexport function testRectCircle(r: Rect, c: Circle): boolean {\n\tconst nx = Math.max(r.p1.x, Math.min(c.center.x, r.p2.x));\n\tconst ny = Math.max(r.p1.y, Math.min(c.center.y, r.p2.y));\n\tconst nearestPoint = vec2(nx, ny);\n\treturn nearestPoint.dist(c.center) <= c.radius;\n}\n\nexport function testRectPolygon(r: Rect, p: Polygon): boolean {\n\treturn testPolygonPolygon(p, [\n\t\tr.p1,\n\t\tvec2(r.p2.x, r.p1.y),\n\t\tr.p2,\n\t\tvec2(r.p1.x, r.p2.y),\n\t]);\n}\n\n// TODO\nexport function testLinePoint(l: Line, pt: Vec2): boolean {\n\treturn false;\n}\n\n// TODO\nexport function testLineCircle(l: Line, c: Circle): boolean {\n\treturn false;\n}\n\nexport function testLinePolygon(l: Line, p: Polygon): boolean {\n\n\t// test if line is inside\n\tif (testPolygonPoint(p, l.p1) || testPolygonPoint(p, l.p2)) {\n\t\treturn true;\n\t}\n\n\t// test each line\n\tfor (let i = 0; i < p.length; i++) {\n\t\tconst p1 = p[i];\n\t\tconst p2 = p[(i + 1) % p.length];\n\t\tif (testLineLine(l, { p1, p2 })) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n\n}\n\nexport function testCirclePoint(c: Circle, p: Point): boolean {\n\treturn c.center.dist(p) < c.radius;\n}\n\nexport function testCircleCircle(c1: Circle, c2: Circle): boolean {\n\treturn c1.center.dist(c2.center) < c1.radius + c2.radius;\n}\n\n// TODO\nexport function testCirclePolygon(c: Circle, p: Polygon): boolean {\n\treturn false;\n}\n\nexport function testPolygonPolygon(p1: Polygon, p2: Polygon): boolean {\n\tfor (let i = 0; i < p1.length; i++) {\n\t\tconst l = {\n\t\t\tp1: p1[i],\n\t\t\tp2: p1[(i + 1) % p1.length],\n\t\t};\n\t\tif (testLinePolygon(l, p2)) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}\n\n// https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html\nexport function testPolygonPoint(p: Polygon, pt: Point): boolean {\n\n\tlet c = false;\n\n\tfor (let i = 0, j = p.length - 1; i < p.length; j = i++) {\n\t\tif (\n\t\t\t((p[i].y > pt.y) != (p[j].y > pt.y))\n\t\t\t&& (pt.x < (p[j].x - p[i].x) * (pt.y - p[i].y) / (p[j].y - p[i].y) + p[i].x)\n\t\t) {\n\t\t\tc = !c;\n\t\t}\n\t}\n\n\treturn c;\n\n}\n\nexport function testPointPoint(p1: Point, p2: Point): boolean {\n\treturn p1.eq(p2);\n}\n\nexport function testAreaRect(a: Area, r: Rect): boolean {\n\tswitch (a.shape) {\n\t\tcase \"rect\": return testRectRect(r, a);\n\t\tcase \"line\": return testRectLine(r, a);\n\t\tcase \"circle\": return testRectCircle(r, a);\n\t\tcase \"polygon\": return testRectPolygon(r, a.pts);\n\t\tcase \"point\": return testRectPoint(r, a.pt);\n\t}\n\tthrow new Error(`Unknown area shape: ${(a as Area).shape}`);\n}\n\nexport function testAreaLine(a: Area, l: Line): boolean {\n\tswitch (a.shape) {\n\t\tcase \"rect\": return testRectLine(a, l);\n\t\tcase \"line\": return Boolean(testLineLine(a, l));\n\t\tcase \"circle\": return testLineCircle(l, a);\n\t\tcase \"polygon\": return testLinePolygon(l, a.pts);\n\t\tcase \"point\": return testLinePoint(l, a.pt);\n\t}\n\tthrow new Error(`Unknown area shape: ${(a as Area).shape}`);\n}\n\nexport function testAreaCircle(a: Area, c: Circle): boolean {\n\tswitch (a.shape) {\n\t\tcase \"rect\": return testRectCircle(a, c);\n\t\tcase \"line\": return testLineCircle(a, c);\n\t\tcase \"circle\": return testCircleCircle(a, c);\n\t\tcase \"polygon\": return testCirclePolygon(c, a.pts);\n\t\tcase \"point\": return testCirclePoint(c, a.pt);\n\t}\n\tthrow new Error(`Unknown area shape: ${(a as Area).shape}`);\n}\n\nexport function testAreaPolygon(a: Area, p: Polygon): boolean {\n\tswitch (a.shape) {\n\t\tcase \"rect\": return testRectPolygon(a, p);\n\t\tcase \"line\": return testLinePolygon(a, p);\n\t\tcase \"circle\": return testCirclePolygon(a, p);\n\t\tcase \"polygon\": return testPolygonPolygon(p, a.pts);\n\t\tcase \"point\": return testPolygonPoint(p, a.pt);\n\t}\n\tthrow new Error(`Unknown area shape: ${(a as Area).shape}`);\n}\n\nexport function testAreaPoint(a: Area, p: Point): boolean {\n\tswitch (a.shape) {\n\t\tcase \"rect\": return testRectPoint(a, p);\n\t\tcase \"line\": return testLinePoint(a, p);\n\t\tcase \"circle\": return testCirclePoint(a, p);\n\t\tcase \"polygon\": return testPolygonPoint(a.pts, p);\n\t\tcase \"point\": return testPointPoint(a.pt, p);\n\t}\n\tthrow new Error(`Unknown area shape: ${(a as Area).shape}`);\n}\n\nexport function testAreaArea(a1: Area, a2: Area): boolean {\n\tswitch (a2.shape) {\n\t\tcase \"rect\": return testAreaRect(a1, a2);\n\t\tcase \"line\": return testAreaLine(a1, a2);\n\t\tcase \"circle\": return testAreaCircle(a1, a2);\n\t\tcase \"polygon\": return testAreaPolygon(a1, a2.pts);\n\t\tcase \"point\": return testAreaPoint(a1, a2.pt);\n\t}\n\tthrow new Error(`Unknown area shape: ${(a2 as Area).shape}`);\n}\n\nexport function minkDiff(r1: Rect, r2: Rect): Rect {\n\treturn {\n\t\tp1: vec2(r1.p1.x - r2.p2.x, r1.p1.y - r2.p2.y),\n\t\tp2: vec2(r1.p2.x - r2.p1.x, r1.p2.y - r2.p1.y),\n\t};\n}\n\nexport class Line {\n\tp1: Vec2;\n\tp2: Vec2;\n\tconstructor(p1: Vec2, p2: Vec2) {\n\t\tthis.p1 = p1;\n\t\tthis.p2 = p2;\n\t}\n}\n\nexport class Rect {\n\tp1: Vec2;\n\tp2: Vec2;\n\tconstructor(p1: Vec2, p2: Vec2) {\n\t\tthis.p1 = p1;\n\t\tthis.p2 = p2;\n\t}\n}\n\nexport class Circle {\n\tcenter: Vec2;\n\tradius: number;\n\tconstructor(center: Vec2, radius: number) {\n\t\tthis.center = center;\n\t\tthis.radius = radius;\n\t}\n}\n","export default class FPSCounter {\n\n\tprivate buf: number[] = [];\n\tprivate timer: number = 0;\n\tfps: number = 0;\n\n\ttick(dt: number) {\n\n\t\tthis.buf.push(1 / dt);\n\t\tthis.timer += dt;\n\n\t\tif (this.timer >= 1) {\n\t\t\tthis.timer = 0;\n\t\t\tthis.fps = Math.round(this.buf.reduce((a, b) => a + b) / this.buf.length);\n\t\t\tthis.buf = [];\n\t\t}\n\n\t}\n\n}\n","export default class Timer {\n\n\ttime: number\n\taction: () => void\n\tfinished: boolean = false\n\tpaused: boolean = false\n\n\tconstructor(time: number, action: () => void) {\n\t\tthis.time = time;\n\t\tthis.action = action;\n\t}\n\n\ttick(dt: number): boolean {\n\t\tif (this.finished || this.paused) return false;\n\t\tthis.time -= dt;\n\t\tif (this.time <= 0) {\n\t\t\tthis.action();\n\t\t\tthis.finished = true;\n\t\t\tthis.time = 0;\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\treset(time) {\n\t\tthis.time = time;\n\t\tthis.finished = false;\n\t}\n\n}\n","import kaboom from \"kaboom\"\n\nkaboom()\n\nconst PIPE_GAP = height() / 2.5\n\nlet highScore = 0\n\nloadSprite(\"bg\", \"sprites/bg.png\")\nloadSprite(\"yoko\", \"sprites/yoko.png\")\nloadSprite(\"pipe\", \"sprites/pipe.png\")\n\n\nscene(\"game\", () => {\n    let score = 0\n\n    add([\n        sprite(\"bg\", {\n            width: width(),\n            height: height(),\n        })\n    ])\n\n    const scoreText = add([\n        text(score)\n    ])\n\n    const player = add([\n        sprite(\"yoko\"),\n        pos(80, 40),\n        area(),\n        scale(0.25),\n        body()\n    ])\n\n    const drawPipes = () => {\n\n        const offset = rand(-height() / 4, height() / 4)\n\n        add([\n            sprite(\"pipe\"),\n            scale(4, 6),\n            pos(width(), height() / 2 + PIPE_GAP / 2 + offset),\n            \"pipe\",\n            area(),\n            {passed: false}\n        ])\n\n        add([\n            sprite(\"pipe\", {\n                flipY: true\n            }),\n            scale(4, 6),\n            pos(width(), height() / 2 - PIPE_GAP / 2 + offset),\n            origin(\"botleft\"),\n            \"pipe\",\n            area()\n        ])\n    }\n\n    loop(2, () => {\n        drawPipes()\n    })\n\n    action(\"pipe\", (pipe) => {\n        pipe.move(-width() / 6, 0)\n\n        if (pipe.passed === false && player.pos.x > pipe.pos.x) {\n            pipe.passed = true\n            score++\n            scoreText.text = score\n        }\n    })\n\n    player.collides(\"pipe\", () => {\n        go(\"gameover\", score)\n    })\n\n    player.action(() => {\n        if (player.pos.y > height() + 30 || player.pos.y < -30) {\n            go(\"gameover\", score)\n        }\n    })\n\n    onKeyPress(\"space\", () => {\n        player.jump(800)\n    })\n})\n\nscene(\"gameover\", (score) => {\n    if (score > highScore) {\n        highScore = score\n    }\n\n    add([\n        text(\"Game over!\\n\" + \"Score: \" + score + \"\\nHigh score: \" + highScore),\n        pos(width() - width() / 2, height() - height() / 2)\n    ])\n\n    onKeyPress(\"space\", () => {\n        go(\"game\")\n    })\n})\n\ngo(\"game\")\n"]}